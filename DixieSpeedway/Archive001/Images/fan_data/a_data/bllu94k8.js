/*
HTTP Host: static.ak.fbcdn.net
Generated: July 26th 2010 1:23:57 AM PDT
Machine: 10.30.148.192
Locale: nu_ll
Path: js/3cauuvb9a3ggk4k8.pkg.js
*/

((location=='about:blank'&&(window.parent.eval_global||window.parent.eval))||(window.eval_global||window.eval))("if (window.CavalryLogger) { CavalryLogger.start_js([\"js\\\/3cauuvb9a3ggk4k8.pkg.js\"]); }\n\nvar XD={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,newResizeMethod:false,resizeTimeout:100,resizeWidth:false},init:function(a){this._opts=copy_properties(copy_properties({},this._opts),a);if(this._opts.autoResize)this._startResizeMonitor();},send:function(a){if(this._opts.channelUrl.substr(0,4)!='http')return;var g=this._opts.channelUrl+'&'+URI.implodeQuery(a),c='f'+(Math.random()*(1<<30)).toString(16).replace('.',''),b=document.body.appendChild(document.createElement('div')),f=false;b.style.position='absolute';b.style.top='-10000px';XD._callbacks[c]=function(){if(f){(function(){b.parentNode.removeChild(b);}).defer(3000);delete XD._callbacks[c];}};if(ua.ie()){var d=('<iframe '+' src=\"'+g+'\"'+' onload=\"XD._callbacks.'+c+'()\"'+'><\/iframe>');b.innerHTML='<iframe src=\"javascript:false\"><\/iframe>';f=true;(function(){b.innerHTML=d;}).defer();}else{var e=document.createElement('iframe');e.onload=XD._callbacks[c];b.appendChild(e);f=true;e.src=g;}},_computeSize:function(){var a=document.body,e=document.documentElement,h=0,f;if(this._opts.newResizeMethod){f=Math.max(Math.max(a.offsetHeight,a.scrollHeight)+a.offsetTop,Math.max(e.offsetHeight,e.scrollHeight)+e.offsetTop);}else{if(ua.ie()){f=Math.max(a.offsetHeight,a.scrollHeight)+a.offsetTop;}else f=e.offsetHeight+e.offsetTop;if(window.Dialog)f=Math.max(f,Dialog.max_bottom);}if(this._opts.resizeWidth){if(a.offsetWidth<a.scrollWidth){h=a.scrollWidth+a.offsetLeft;}else{var d=a.childNodes;for(var g=0;g<d.length;g++){var b=d[g];var c=b.offsetWidth+b.offsetLeft;if(c>h)h=c;}}if(e.clientLeft>0)h+=(e.clientLeft*2);if(e.clientTop>0)f+=(e.clientTop*2);}return {width:h,height:f};},_startResizeMonitor:function(){var b,a=document.documentElement;if(this._opts.hideOverflow)a.style.overflow='hidden';(function(){var d=this._computeSize();if(!b||(this._opts.allowShrink&&b.width!=d.width)||(!this._opts.allowShrink&&b.width<d.width)||(this._opts.allowShrink&&b.height!=d.height)||(!this._opts.allowShrink&&b.height<d.height)){b=d;var c={type:'resize',height:d.height};if(d.width&&d.width!=0)c.width=d.width;this.send(c);}}).bind(this).recur(this._opts.resizeTimeout);}};var UnverifiedXD=copy_properties({},XD);\nWidgetArbiter={_findSiblings:function(){if(WidgetArbiter._siblings)return;WidgetArbiter._siblings=[];for(var b=parent.frames.length-1;b>=0;b--)try{if(parent.frames[b]&&parent.frames[b].Arbiter&&parent.frames[b].Arbiter.inform)WidgetArbiter._siblings.push(parent.frames[b].Arbiter);}catch(a){}},inform:function(){WidgetArbiter._findSiblings();var a=$A(arguments);WidgetArbiter._siblings.each(function(b){b.inform.apply(b,a);});}};\nvar ExternalNodeConnectWidget=function(b){copy_properties(this,{widgetID:b.widgetID,widget:$(b.widgetID),viewerID:b.viewer,nodeType:b.nodeType,viewerIsAdmin:b.viewerIsAdmin&&!b.userOptedOut,adminUrl:b.adminUrl,popupOptInUri:new URI('\/connect\/uiserver.php'),nodeUri:new URI(b.nodeURL),externalUrl:b.externalURL,nodeId:b.nodeId,layout:b.layout,edgeType:b.edgeType,error:b.error,errorURI:new URI('\/home.php'),alreadyConnected:b.alreadyConnected,usingConnectLibrary:!!b.channelURL,commentWidgetMarkup:b.commentWidgetMarkup,commentWidgetOpen:false,commentWidgetVisible:false,commentWidgetExpanded:true,userProfile:null,connectStoryFbid:0,isAmbiguousText:b.isAmbiguousText,socialBar:b.socialbar,useDisconnectLink:b.useDisconnectLink,showError:b.showError,connectText:b.connectText,ref:b.ref,abtestunlike:b.abtestunlike,userOptedOut:b.userOptedOut,usingInlineCommenting:b.usingInlineCommenting,inlineCommentListenersInitialized:false,isBlocked:b.isBlocked});if(this.usingConnectLibrary)UnverifiedXD.init({autoResize:b.autoResize,channelUrl:b.channelURL});this.subscribeToSync(b);this.connectButtonSlider=DOM.find(this.widget,'div.connect_button_slider');this.connectButtonContainer=DOM.find(this.connectButtonSlider,'div.connect_button_container');this.connectButton=DOM.find(this.connectButtonContainer,'a.connect_widget_like_button');this.connectedMessage=DOM.find(this.widget,'span.connect_widget_connected_text');this.notConnectedMessage=DOM.find(this.widget,'span.connect_widget_not_connected_text');this.adminSpans=DOM.scry(this.widget,'span.connect_widget_admin_span');if(this.adminSpans.length>0){this.adminLinks=[];for(var a=0;a<this.adminSpans.length;a++)this.adminLinks[a]=DOM.find(this.adminSpans[a],'a.connect_widget_admin_option');}this.confirmationCell=DOM.find(this.widget,'div.connect_confirmation_cell');this.confirmationText=DOM.scry(this.widget,'div.connect_widget_confirmation')[0];this.textWrapper=DOM.find(this.widget,'div.connect_text_wrapper');this.textContent=DOM.find(this.widgetWrapper,'span.connect_widget_text');this.favicon=DOM.scry(this.widgetWrapper,'span.connect_widget_facebook_favicon')[0];if(b.showFaces&&b.viewer>0)this.loggedInUserPhotoDiv=DOM.find(this.widget,'div.connect_widget_logged_in_user');this.setQueryData();if(this.nodeId)this.popupOptInUri.addQueryData({connect_id:this.nodeId});this.errorSpans=DOM.scry(this.widget,'span.connect_widget_error_span');if(this.errorSpans.length>0){this.errorLinks=[];for(var a=0;a<this.errorSpans.length;a++)this.errorLinks[a]=DOM.find(this.errorSpans[a],'a.connect_widget_error_text');}if(this.confirmationText&&!this.isAmbiguousText)Event.listen(this.connectButton,'mouseenter',this.onMouseOverButton.bind(this));if(!this.isBlocked)Event.listen(this.connectButton,'click',this.connectToNodeOnClick.bind(this));Bootloader.loadComponents('mouse-extent-element',bind(this,function(){if(window.MouseExtentElement){this.mouseExtent=new MouseExtentElement(this.connectButton);this.loadTime=new Date().getTime();}}));if(this.adminLinks)for(var a=0;a<this.adminLinks.length;a++)Event.listen(this.adminLinks[a],'click',this.presentAdminPage.bind(this));if(this.errorLinks)for(var a=0;a<this.errorLinks.length;a++)Event.listen(this.errorLinks[a],'click',this.presentErrorDialog.bind(this));if(b.showCaptcha){this.showCaptcha=true;this.connectToNode(true);}};copy_properties(ExternalNodeConnectWidget,{OPT_IN_FACEBOOK_APP_ID:'127760087237610',updateLoggedInUser:function(b){var a=ExternalNodeConnectWidget.controllerManagingLogin;a.setLoggedIn(b);a.connectToNode(true);a.userOptedOut=false;delete ExternalNodeConnectWidget.controllerManagingLogin;WidgetArbiter.inform('platform\/socialplugins\/login',{user:b.user},Arbiter.BEHAVIOR_STATE);},onCommentWidgetLoaded:function(a){var b=ExternalNodeConnectWidget.self;delete ExternalNodeConnectWidget.self;b.injectCommentWidgetMarkup(a);}});copy_properties(ExternalNodeConnectWidget.prototype,{subscribeToSync:function(){},setQueryData:function(){},presentOptIn:function(){},updateWidget:function(){},setLoggedIn:function(a){this.viewerID=a.user;this.newProfilePic=a.profilePic;this.placeFormUserCheck(a.formUserCheck,a.fbDtsg);},onMouseOverButton:function(event){if(this.alreadyConnected)this.showConfirmationMessage(true);},placeFormUserCheck:function(b,a){window.Env.fb_dtsg=a;if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(b));}else DOM.appendContent(DOM.find(document,'body'),HTML(b));},syncWidgetWithServer:function(c){var b=c.getPayload();if(b.requires_login){this.updateWidget({nowConnected:false,isAdmin:false},false);this.presentOptIn();return;}var a={nowConnected:b.success&&b.already_connected,isAdmin:b.is_admin,showError:b.show_error,adminUrl:b.admin_url,userProfile:b.user_profile,connectStoryFbid:b.story_fbid,error:b.error_info};this.updateWidget(a,false);if(b.success&&this.showCaptcha){window.opener.location.reload();window.close();}},conditionallyActivateButton:function(event){this.commentButtonIsActive=this.inlineCommentInput.value.trim().length>0;},updateConnectionWithComment:function(event){Event.kill(event);if(this.commentButtonIsActive){this.postInlineComment();this.resetInlineComment();this.closeInlineComment();}},postInlineComment:function(){this.postUserComment(this.inlineCommentInput.value.trim());},resetInlineComment:function(){var a=this.inlineCommentInput.getAttribute('placeholder');this.inlineCommentInput.value=a;},showInlineComment:function(event){Event.kill(event);if(!this.inlineCommentFlyoutOpen||this.inlineCommentFlyoutVisible)return;this.inlineCommentFlyoutVisible=true;CSS.removeClass(this.inlineCommentFlyout,'hidden_elem');},hideInlineComment:function(event){Event.kill(event);if(!this.inlineCommentFlyoutOpen||!this.inlineCommentFlyoutVisible)return;this.inlineCommentFlyoutVisible=false;CSS.addClass(this.inlineCommentFlyout,'hidden_elem');},closeInlineComment:function(){CSS.addClass(this.inlineCommentFlyout,'hidden_elem');this.resetInlineComment();this.inlineCommentFlyoutVisible=false;this.inlineCommentFlyoutOpen=false;},positionInlineCommentFlyout:function(){var b=Vector2.getElementPosition(this.connectButton,'document').x;var a=Vector2.getElementDimensions(this.connectButton).x;var c=b+a+5;CSS.setStyle(this.inlineCommentFlyout,'left',c+'px');var g=Vector2.getElementPosition(this.widget,'document').x;var f=Vector2.getElementDimensions(this.widget).x;var h=g+f-c-5;CSS.setStyle(this.inlineCommentFlyout,'width',h+'px');var d=Vector2.getHiddenElementDimensions(this.inlineCommentButton,'document').x;var e=h-16-d;CSS.setStyle(this.inlineCommentInput,'width',e+'px');},postUserComment:function(a){var b={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,node_id:this.nodeId,connect_text:this.connectText,story_fbid:this.connectStoryFbid,comment:a};Bootloader.loadComponents(['async','async-postlude'],function(){new AsyncRequest().setURI(this.getCommentAjaxEndpoint()).setData(b).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();}.bind(this));this.closeCommentWidget();},closeCommentWidget:function(){if(this.commentWidgetOpen){delete this.inGracePeriod;delete this.commentWidgetIsExpanded;this.commentWidgetVisible=false;this.commentWidgetOpen=false;UnverifiedXD.send({type:'dismissEdgeCommentDialog'});}},presentAdminPage:function(){var a='_blank';window.open(this.adminUrl.toString(),a);},presentErrorDialog:function(){var c='_blank';var b='toolbar=0, status=0, width=960, height=300';var a=new URI('\/connect\/connect_to_node_error.php');a.addQueryData({title:this.error.brief,body:this.error.full});window.open(a.toString(),c,b);},syncWidgetDisplay:function(){this.syncConnectButton();var a=this.alreadyConnected;this.showElementIf(this.connectedMessage,a);this.showElementIf(this.notConnectedMessage,!a);for(var b=0;b<this.adminSpans.length;b++)this.showElementIf(this.adminSpans[b],this.viewerIsAdmin);for(var b=0;b<this.errorSpans.length;b++)this.showElementIf(this.errorSpans[b],this.error&&(this.viewerIsAdmin||this.showError));if(this.abtestunlike){if(this.layout!==\"button_count\")this.showElementIf(this.unlikeLink,this.useDisconnectLink&&a);}else{this.showElementIf(this.connectButton,!this.useDisconnectLink||!a);this.showElementIf(this.unlikeLink,this.useDisconnectLink&&a);}if(!this.loggedInUserPhotoDiv)return;if(a){this.showConfirmationMessage(true);this.slideUserPhotoIn(this.loggedInUserPhotoDiv);}else{this.showConfirmationMessage(false);this.slideUserPhotoOut(this.loggedInUserPhotoDiv);}},syncConnectButton:function(){if(this.alreadyConnected){CSS.removeClass(this.connectButton,'like_button_no_like');CSS.addClass(this.connectButton,'like_button_like');this.hideButton(true);}else{CSS.addClass(this.connectButton,'like_button_no_like');CSS.removeClass(this.connectButton,'like_button_like');this.hideButton(false);}},hideButton:function(a){if(!this.abtestunlike)return;if(this.oAnimateBlind)this.oAnimateBlind.stop();this.oAnimateBlind=animation(this.connectButtonSlider).duration(300);var e=1,d=0,b=intl_locale_is_rtl(),f=b?'marginRight':'marginLeft',g=b?'marginLeft':'marginRight';if(a){this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonContainer,f,'2px');this.oAnimateBlind=null;}.bind(this));}else{CSS.setStyle(this.connectButtonContainer,f,'0px');e=Vector2.getElementDimensions(this.connectButton).x;d=5;this.oAnimateBlind.ondone(function(){CSS.setStyle(this.connectButtonSlider,'overflow','visible');CSS.setStyle(this.connectButtonSlider,'width','auto');this.oAnimateBlind=null;}.bind(this));}this.oAnimateBlind.to('width',e).to(g,d).blind().go();if(this.layout==='button_count'){if(this.oAnimateBlindFavicon)this.oAnimateBlindFavicon.stop();var c=a?19:0;this.oAnimateBlindFavicon=animation(this.favicon).to('width',c).ondone(function(){this.oAnimateBlindFavicon=null;}.bind(this)).duration(300).go();}},showElementIf:function(a,b){if(!a)return;if(b){CSS.removeClass(a,'hidden_elem');}else CSS.addClass(a,'hidden_elem');},animateConfirmationMessageOn:function(a){var b=Math.max(24,this.confirmationCell.parentNode.clientHeight);CSS.setStyle(this.confirmationCell,'height',b+'px');CSS.addClass(this.textWrapper,'hidden_elem');CSS.removeClass(this.confirmationText,'hidden_elem');if(this.confirmationText.offsetHeight<20)CSS.addClass(this.confirmationText,'vertical_centering');return animation(this.confirmationText).from('opacity',0).to('opacity',1).duration(150).ondone(a).go();},animateConfirmationMessageOff:function(a){animation(this.confirmationText).to('opacity',0).duration(400).ondone(function(){this.confirmationText.style.opacity=null;CSS.addClass(this.confirmationText,'hidden_elem');CSS.setStyle(this.confirmationCell,'height',null);CSS.removeClass(this.textWrapper,'hidden_elem');CSS.setStyle(this.textWrapper,'opacity',0);animation(this.textWrapper).to('opacity',1).duration(150).ondone(a).go();}.bind(this)).go();},stopAnimateConfirmation:function(){var a=this.oAnimateConfirmationTracker;if(a&&a!==true){if(a instanceof animation){a.stop();}else if(!isNaN(a))clearTimeout(a);this.animateConfirmation(2);}},animateConfirmation:function(b){if(!b)if(this.oAnimateConfirmationTracker){return;}else b=0;var a=function(){this.animateConfirmation(b+1);}.bind(this);switch(b){case 0:this.oAnimateConfirmationTracker=this.animateConfirmationMessageOn(a);break;case 1:this.oAnimateConfirmationTracker=a.defer(2500);break;case 2:this.oAnimateConfirmationTracker=true;this.animateConfirmationMessageOff(a);break;default:this.oAnimateConfirmationTracker=null;break;}},showConfirmationMessage:function(a){if(this.confirmationText)if(a){this.animateConfirmation();}else this.stopAnimateConfirmation();},slideUserPhotoIn:function(b){if(!CSS.hasClass(b,'connect_widget_user_not_connected'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.removeClass(b,'connect_widget_user_not_connected');animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();},slideUserPhotoOut:function(a){if(CSS.hasClass(a,'connect_widget_user_not_connected'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.addClass(a,'connect_widget_user_not_connected');CSS.setStyle(a,'width',null);}).go();},_clickLocked:false,connectToNodeOnClick:function(event){event.kill();if(!this._clickLocked){this._clickLocked=true;setTimeout(function(){this._clickLocked=false;}.bind(this),1000);if(this.viewerID==0||this.userOptedOut){this.presentOptIn();}else this.connectToNode(!this.alreadyConnected);}},connectToNode:function(c){if(!c)if(this.commentWidgetOpen){this.closeCommentWidget();}else if(this.inlineCommentFlyoutOpen)this.closeInlineComment();this.updateWidget({nowConnected:!this.alreadyConnected,isAdmin:this.viewerIsAdmin},false);var a={href:this.externalUrl,node_type:this.nodeType,edge_type:this.edgeType,node_id:this.nodeId,show_captcha:this.showCaptcha,connect_text:this.connectText,ref:this.ref,now_connected:c};Bootloader.loadComponents(['async','async-postlude','vector'],function(){if(this.mouseExtent){sizeB=Vector2.getElementDimensions(this.connectButton);extW=MouseExtentWindow.getInstance().getMouseExtent();extB=this.mouseExtent.getMouseExtent();a.me=[sizeB.x,sizeB.y,extW.x,extW.y,extB.x,extB.y].join('|');a.dly=Math.round((new Date().getTime()-this.loadTime)\/1000);}new AsyncRequest().setURI(this.getAjaxEndpoint()).setHandler(this.syncWidgetWithServer.bind(this)).setData(a).setNectarModuleDataSafe().setNectarImpressionIdSafe().send();}.bind(this));if(this.usingConnectLibrary&&c){ExternalNodeConnectWidget.self=this;var b={type:'presentEdgeCommentDialog',masterFrameName:window.name};if(this.socialBar)b.left=parseInt(CSS.getStyle(document.getElementById('profile'),'width'),10)+1;UnverifiedXD.send(b);this.commentWidgetOpen=true;this.commentWidgetVisible=true;}else if(this.usingInlineCommenting&&c)if(!this.inlineCommentListenersInitialized){Bootloader.loadComponents(['Button','vector'],bind(this,function(){this.initializeInlineCommentListeners();this.openInlineCommentFlyout();this.positionInlineCommentFlyout();this.inlineCommentListenersInitialized=true;}));}else this.openInlineCommentFlyout();},initializeInlineCommentListeners:function(){this.inlineCommentFlyout=DOM.find(this.widget,'.connect_widget_comment_box');this.inlineCommentInput=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_textinput');this.inlineCommentButton=DOM.find(this.inlineCommentFlyout,'.connect_widget_comment_button');this.commentButtonIsActive=false;Event.listen(this.inlineCommentInput,'keyup',this.conditionallyActivateButton.bind(this));Event.listen(this.inlineCommentButton,'click',this.updateConnectionWithComment.bind(this));Event.listen(this.widget,'mouseout',this.hideInlineComment.bind(this));Event.listen(this.widget,'mouseover',this.showInlineComment.bind(this));},openInlineCommentFlyout:function(){CSS.removeClass(this.inlineCommentFlyout,'hidden_elem');this.inlineCommentFlyoutOpen=true;this.inlineCommentFlyoutVisible=true;},injectCommentWidgetMarkup:function(a){this.commentDocument=a;this.commentDocument.body.innerHTML=this.commentWidgetMarkup;this.transferCSSStyles();if(this.newProfilePic){var c=DOM.find(this.commentDocument,'img.connect_comment_widget_user_pic');c.src=this.newProfilePic;delete this.newProfilePic;}this.placeholderInputRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_placeholder_input_region');this.placeholderInput=DOM.find(this.placeholderInputRegion,'input.connect_comment_widget_placeholder_input');this.fullInputRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_full_input_region');this.fullInputTextarea=DOM.find(this.fullInputRegion,'textarea.connect_comment_widget_full_input_textarea');this.widgetButtonRegion=DOM.find(this.commentDocument,'div.connect_comment_widget_button_region');this.postToFacebookButton=DOM.find(this.widgetButtonRegion,'.connect_comment_widget_post_button input');this.cancelButton=DOM.find(this.widgetButtonRegion,'.connect_comment_widget_cancel_button input');this.defaultInputText=this.placeholderInput.value;this.placeholderInput.onfocus=this.transitionToFullInputMode.bind(this);this.fullInputTextarea.onfocus=this.removePlaceholderText.bind(this);this.fullInputTextarea.onblur=this.restorePlaceholderText.bind(this);this.postToFacebookButton.onclick=this.updateUserComment.bind(this);this.cancelButton.onclick=this.dismissCommentWidget.bind(this);var b=(!this.abtestunlike)?this.connectButton:this.textWrapper;b.onmouseout=this.hideCommentWidget.bind(this);b.onmouseover=this.showCommentWidget.bind(this);this.commentDocument.body.onmouseout=this.hideCommentWidget.bind(this);this.commentDocument.body.onmouseover=this.showCommentWidget.bind(this);this.inGracePeriod=false;},showCommentWidget:function(event){this.inGracePeriod=true;this.killCloseThread();if(this.commentWidgetOpen&&!this.commentWidgetVisible){this.commentWidgetVisible=true;CSS.removeClass(this.commentDocument.body,'hidden_elem');UnverifiedXD.send({type:'showEdgeCommentDialog'});}return false;},hideCommentWidget:function(event){this.inGracePeriod=false;if(this.commentWidgetOpen&&this.commentWidgetVisible){var a=function(){if(!this.inGracePeriod&&!this.commentWidgetIsExpanded){this.commentWidgetVisible=false;if(!this.socialBar)CSS.addClass(this.commentDocument.body,'hidden_elem');UnverifiedXD.send({type:'hideEdgeCommentDialog'});}this.inGracePeriod=false;this.killCloseThread();}.bind(this);this.closeThreadID=setTimeout(a,100);}return false;},killCloseThread:function(){if(this.closeThreadID){clearTimeout(this.closeThreadID);delete this.closeThreadID;}},transferCSSStyles:function(){var d=DOM.scry(window.document,'link');var e=DOM.scry(window.document,'style');var c=DOM.find(window.document,'html');var g=DOM.find(this.commentDocument,'html');var f=DOM.find(this.commentDocument,'head');for(var a=0;a<d.length;a++)if(d[a].rel=='stylesheet'&&d[a].href.endsWith('.css')){var b=this.commentDocument.createElement('link');b.rel=d[a].rel;b.href=d[a].href;b.type=d[a].type;f.appendChild(b);}if(window.ResourceBundler)ResourceBundler.applyCSSToDocument(this.commentDocument);g.id=c.id;g.className=c.className;this.commentDocument.body.className=window.document.body.className;},transitionToFullInputMode:function(event){this.commentWidgetIsExpanded=true;CSS.addClass(this.placeholderInputRegion,'hidden_elem');CSS.removeClass(this.fullInputRegion,'hidden_elem');CSS.removeClass(this.widgetButtonRegion,'hidden_elem');this.fullInputTextarea.focus();return false;},removePlaceholderText:function(event){if(CSS.hasClass(this.fullInputTextarea,'connect_comment_widget_disabled')){CSS.removeClass(this.fullInputTextarea,'connect_comment_widget_disabled');this.fullInputTextarea.value='';}return false;},restorePlaceholderText:function(event){if(this.fullInputTextarea.value.trim()==''){this.fullInputTextarea.value=this.defaultInputText;CSS.addClass(this.fullInputTextarea,'connect_comment_widget_disabled');}return false;},updateUserComment:function(event){var a=this.fullInputTextarea.value.trim();if(a!=''&&a!=this.defaultInputText)this.postUserComment(a);return false;},dismissCommentWidget:function(event){this.closeCommentWidget();return false;},getAjaxEndpoint:function(){return '\/ajax\/connect\/external_node_connect.php';},getCommentAjaxEndpoint:function(){return '\/ajax\/connect\/external_edge_comment.php';},updateLoggedInUser:function(b,a){ExternalNodeConnectWidget.updateLoggedInUser(b,a);}});\nfunction fbpage_set_fan_status(c,f,a,h,g,d,e){g=g?g:function(j){_fbpage_show_change_status_feedback(c,j.getPayload());};var b={fbpage_id:f,add:a,reload:h};if(e!=null)copy_properties(b,e);var i=new AsyncRequest().setURI('\/ajax\/pages\/fan_status.php').setData(b).setNectarModuleDataSafe(c).setHandler(g);if(d)i.setErrorHandler(d);i.send();return false;}function fbpage_set_favorite_status(d,e,a){var f=function(){_fbpage_show_change_status_feedback(d,this.getUserData());};var c={fbpage_id:e,add:a};var b=new AsyncRequest().setMethod('POST').setURI('\/ajax\/pages\/favorite_status.php').setData(c);new Dialog().setAsync(b).setCloseHandler(f).show();return false;}function _fbpage_show_change_status_feedback(b,a){if(!a||!b)return;if(a.reload){fbpage_reload_on_fan_status_changed(a.preserve_tab);}else fbpage_redraw_on_fan_status_changed(b,a.feedback);}function fbpage_reload_on_fan_status_changed(a){var b=URI.getRequestURI();if(a)if(!b.getQueryData().v&&window.profile_tab_controller)b.addQueryData({v:window.profile_tab_controller.currentView});goURI(b,true);}function fbpage_redraw_on_fan_status_changed(a,b){if(!b)return;var d=document.createElement('span');d.innerHTML=b;CSS.setClass(d,'fan_status_inactive');a.parentNode.replaceChild(d,a);var c=function(){if(data.can_repeat_action)d.parentNode.replaceChild(a,d);};animation(d).duration(3000).checkpoint().to('backgroundColor','#FFFFFF').duration(1000).ondone(c).go();}\nfunction ConnectWidget(g,e,a,d){copy_properties(this,{like_mode:d,profile_id:e,viewer_id:g,status:null,popup:null,busy:false,new_fan:null,user_profile:null});this.fan_hidden=[];this.fan_shown=[];var b=DOM.scry(document,'div.connections');if(b.length>0){b=b[0];this.user_profile=DOM.find(b,'div.user_profile');this.new_fan=DOM.find(b,'div.grid_item_plus');this.fan_shown.push(this.new_fan);this.fan_shown.push(DOM.find(b,'span.total_plus'));var f=DOM.scry(b,'span.total');var c=DOM.scry(b,'div.grid_item');if(c.length>1)this.fan_hidden.push(c[1]);this.fan_hidden.push(f[f.length-1]);}if(!this.like_mode){this.button=$(a);this.popup_uri=new URI('\/login.php');this.popup_uri.addQueryData({connect_id:this.profile_id,popup:true});Event.listen(this.button,'click',this.connectClickHandler.bind(this));}else Arbiter.subscribe('platform\/like\/connection',this.updateWidgetFromLike.bind(this));ConnectWidget.instances[a]=this;}ConnectWidget.instances={};ConnectWidget.is_connect=true;ConnectWidget.prototype.setLoggedIn=function(a){this.viewer_id=a;return this;};ConnectWidget.prototype.connectClickHandler=function(a){a.kill();if(this.viewer_id!=0){this.connect();}else this.popUpLogin();};ConnectWidget.prototype.connect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,true,false,this.connectDoneHandler.bind(this),this.connectErrorHandler.bind(this),this.getAsyncData());}};ConnectWidget.prototype.disconnect=function(){if(!this.busy){this.busy=true;fbpage_set_fan_status(this.button,this.profile_id,false,false,this.connectUndoneHandler.bind(this),function(){},this.getAsyncData());}};ConnectWidget.prototype.getAsyncData=function(){var a={source:'connect',is_connect:ConnectWidget.is_connect};if(ge('post_form_id'))a.post_form_id=$('post_form_id').value;if(env_get('fb_dtsg'))a.fb_dtsg=env_get('fb_dtsg');return a;};ConnectWidget.prototype.popUpLogin=function(){window.open(this.popup_uri.toString(),'_blank','toolbar=0,status=0,width=626,height=400');};ConnectWidget.prototype.updateWidgetFromLike=function(b,e){if(!e.userProfile)return;if(this.user_profile){var c=DOM.find(this.user_profile,'img');var a=DOM.find(this.user_profile,'a');var d=DOM.find(this.user_profile,'div.name');c.src=e.userProfile.pic_square;a.href=e.userProfile.profile_url;DOM.setContent(d,e.userProfile.name);}if(e.nowConnected){this.showNewFan();}else this.hideNewFan();};ConnectWidget.prototype.connectErrorHandler=function(b){if(b.error==1357001){this.viewer_id=0;this.popUpLogin();}else if(b.error==1357013){CSS.addClass(this.button,'hidden_elem');var a=$N('a',{href:DOM.find(document,'div.name_block a').href,target:'_blank'},_tx(\"Verification is needed to connect.\"));this.status=$N('span',{className:'connect_span'},a);DOM.insertAfter(this.button,this.status);}else{CSS.addClass(this.button,'hidden_elem');if(b.error==1431001){this.status=$N('span',{className:'connect_span'},_tx(\"You like this.\"));}else this.status=$N('span',{className:'connect_span'},b.getErrorSummary()+': '+b.getErrorDescription());animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);}this.busy=false;};ConnectWidget.prototype.connectDoneHandler=function(c){var b=c.getPayload();if(!b||!b.feedback)return;this.status=$N('span',{className:'connect_span'},HTML(b.feedback));var d=$N('a',{className:'undo'},_tx(\"Undo\"));Event.listen(d,'click',function(e){e.kill();this.disconnect();}.bind(this));DOM.appendContent(this.status,d);animation(this.status).from('opacity',0).to('opacity',1).go();DOM.insertAfter(this.button,this.status);CSS.addClass(this.button,'hidden_elem');if(this.new_fan!=null&&b.connect_fan_div){var a=$N('div',{},HTML(b.connect_fan_div));DOM.setContent(this.new_fan,DOM.find(a,'a'));}this.showNewFan();this.busy=false;};ConnectWidget.prototype.showNewFan=function(){this.fan_shown.forEach(function(b){if(!CSS.hasClass(b,'hidden_elem'))return;var a=CSS.getStyle(b,'width');CSS.setStyle(b,'width',0);CSS.setStyle(b,'opacity',0);CSS.removeClass(b,'hidden_elem');animation(b).to('width',a).duration(100).checkpoint().to('opacity',1).duration(400).go();});this.fan_hidden.forEach(function(a){CSS.addClass(a,'hidden_elem');});};ConnectWidget.prototype.connectUndoneHandler=function(b){var a=b.getPayload();DOM.remove(this.status);animation(this.button).from('opacity',0).to('opacity',1).go();CSS.removeClass(this.button,'hidden_elem');this.hideNewFan();this.busy=false;};ConnectWidget.prototype.hideNewFan=function(){this.fan_shown.forEach(function(a){if(CSS.hasClass(a,'hidden_elem'))return;animation(a).to('opacity',0).duration(100).checkpoint(.25).to('width',0).duration(100).ondone(function(){CSS.setStyle(a,'width',null);CSS.addClass(a,'hidden_elem');this.fan_hidden.forEach(function(b){CSS.removeClass(b,'hidden_elem');});}.bind(this)).go();}.bind(this));};ConnectWidget.loadStream=function(b,a){new AsyncRequest().setMethod('GET').setURI('\/ajax\/connect\/connect_widget.php').setData({id:b}).setReadOnly(true).setErrorHandler(bagofholding).setHandler(function(c){payload=c.getPayload();DOM.setContent($(a),HTML(payload.stream_markup));}.bind(this)).send();};ConnectWidget.loggedIn=function(c,a){if(ge('post_form_id')){DOM.replace($('post_form_id'),HTML(a));}else DOM.appendContent(DOM.find(document,'body'),HTML(a));for(var b in ConnectWidget.instances){ConnectWidget.instances[b].setLoggedIn(c);ConnectWidget.instances[b].connect();}};ConnectWidget.setIsConnect=function(a){ConnectWidget.is_connect=a;};ConnectWidget.popUpConnect=function(c){var b={id:c,captcha:true,post_form_id:$('post_form_id').value};var d=URI('\/plugins\/likebox.php').addQueryData(b);var a=window.open(d,'_blank','toolbar=0,status=0,width=640,height=480');};\nvar ExternalPageLikeWidget=function(a){a.edgeType='like';this.parent.construct(this,a);this.unactionLink=DOM.find(this.widget,'span.unlike_link');Event.listen(this.unactionLink,'click',this.connectToNodeOnClick.bind(this));};ExternalPageLikeWidget.extend('ExternalNodeConnectWidget');copy_properties(ExternalPageLikeWidget.prototype,{subscribeToSync:function(a){Arbiter.subscribe('platform\/like\/sync',function(c,b){if(b.externalUrl==a.externalURL){this.userOptedOut=false;this.updateWidget(b.opts,true);}}.bind(this));},setQueryData:function(){this.popupOptInUri.addQueryData({social_plugin:'like',external_page_url:this.externalUrl,method:'opt.inlike',display:'popup',app_id:ExternalNodeConnectWidget.OPT_IN_FACEBOOK_APP_ID});},presentOptIn:function(){var b='_blank';var a='location=1, toolbar=0, status=0, width=450, height=420';ExternalNodeConnectWidget.controllerManagingLogin=this;window.open(this.popupOptInUri.toString(),b,a);},updateWidget:function(c,b){var a=(this.alreadyConnected!=c.nowConnected);Arbiter.inform('platform\/like\/connection',c,Arbiter.BEHAVIOR_STATE);this.alreadyConnected=c.nowConnected;this.viewerIsAdmin=c.isAdmin;this.showError=c.showError;this.adminUrl=c.adminUrl;this.userProfile=c.userProfile;this.connectStoryFbid=c.connectStoryFbid;this.error=c.error;if(!c.nowConnected)this.closeCommentWidget();if(a||this.error)this.syncWidgetDisplay();if(!b)WidgetArbiter.inform('platform\/like\/sync',{externalUrl:this.externalUrl,opts:c},Arbiter.BEHAVIOR_STATE);}});\n\nif (window.Bootloader) { Bootloader.done([\"js\\\/3cauuvb9a3ggk4k8.pkg.js\"]); }")