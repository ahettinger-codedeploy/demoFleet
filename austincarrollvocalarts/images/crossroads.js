(function(){var e=function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);for(var i=e.length;i--;)if(e[i]===t)return i;return-1}function i(e,i){var s=t(e,i);-1!==s&&e.splice(s,1)}function s(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function n(e){return s(e,"RegExp")}function a(e){return s(e,"Array")}function o(e){return"function"==typeof e}function r(e){var t;return t=null===e||"null"===e?null:"true"===e?!0:"false"===e?!1:e===f||"undefined"===e?f:""===e||isNaN(e)?e:parseFloat(e)}function l(e){for(var t=e.length,i=[];t--;)i[t]=r(e[t]);return i}function d(e,t){for(var i,s,n=(e||"").replace("?","").split("&"),a=n.length,o={};a--;)i=n[a].split("="),s=t?r(i[1]):i[1],o[i[0]]="string"==typeof s?decodeURIComponent(s):s;return o}function h(){this.bypassed=new e.Signal,this.routed=new e.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function c(t,i,s,a){var o=n(t),r=a.patternLexer;this._router=a,this._pattern=t,this._paramsIds=o?null:r.getParamIds(t),this._optionalParamsIds=o?null:r.getOptionalParamsIds(t),this._matchRegexp=o?t:r.compilePattern(t,a.ignoreCase),this.matched=new e.Signal,this.switched=new e.Signal,i&&this.matched.add(i),this._priority=s||0}var u,m,f;return m=/t(.+)?/.exec("t")[1]==="",h.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new h},addRoute:function(e,t,i){var s=new c(e,t,i,this);return this._sortedInsert(s),s},removeRoute:function(e){i(this._routes,e),e._destroy()},removeAllRoutes:function(){for(var e=this.getNumRoutes();e--;)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){if(e=e||"",t=t||[],this.ignoreState||e!==this._prevMatchedRequest&&e!==this._prevBypassedRequest){var i,s=this._getMatchedRoutes(e),n=0,a=s.length;if(a)for(this._prevMatchedRequest=e,this._notifyPrevRoutes(s,e),this._prevRoutes=s;a>n;)i=s[n],i.route.matched.dispatch.apply(i.route.matched,t.concat(i.params)),i.isFirst=!n,this.routed.dispatch.apply(this.routed,t.concat([e,i])),n+=1;else this._prevBypassedRequest=e,this.bypassed.dispatch.apply(this.bypassed,t.concat([e]));this._pipeParse(e,t)}},_notifyPrevRoutes:function(e,t){for(var i,s=0;i=this._prevRoutes[s++];)i.route.switched&&this._didSwitch(i.route,e)&&i.route.switched.dispatch(t)},_didSwitch:function(e,t){for(var i,s=0;i=t[s++];)if(i.route===e)return!1;return!0},_pipeParse:function(e,t){for(var i,s=0;i=this._piped[s++];)i.parse(e,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,i=t.length;do--i;while(t[i]&&e._priority<=t[i]._priority);t.splice(i+1,0,e)},_getMatchedRoutes:function(e){for(var t,i=[],s=this._routes,n=s.length;(t=s[--n])&&((!i.length||this.greedy||t.greedy)&&t.match(e)&&i.push({route:t,params:t._getParamsArray(e)}),this.greedyEnabled||!i.length););return i},pipe:function(e){this._piped.push(e)},unpipe:function(e){i(this._piped,e)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},u=new h,u.VERSION="0.12.0",u.NORM_AS_ARRAY=function(e,t){return[t.vals_]},u.NORM_AS_OBJECT=function(e,t){return[t]},c.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t,i=this.rules,s=this._getParamsObject(e);for(t in i)if("normalize_"!==t&&i.hasOwnProperty(t)&&!this._isValidParam(e,t,s))return!1;return!0},_isValidParam:function(e,i,s){var r=this.rules[i],l=s[i],d=!1,h=i.indexOf("?")===0;return null==l&&this._optionalParamsIds&&t(this._optionalParamsIds,i)!==-1?d=!0:n(r)?(h&&(l=s[i+"_"]),d=r.test(l)):a(r)?(h&&(l=s[i+"_"]),d=this._isValidArrayRule(r,l)):o(r)&&(d=r(l,e,s)),d},_isValidArrayRule:function(e,i){if(!this._router.ignoreCase)return t(e,i)!==-1;"string"==typeof i&&(i=i.toLowerCase());for(var s,n,a=e.length;a--;)if(s=e[a],n="string"==typeof s?s.toLowerCase():s,n===i)return!0;return!1},_getParamsObject:function(e){for(var i,s,n=this._router.shouldTypecast,a=this._router.patternLexer.getParamValues(e,this._matchRegexp,n),o={},l=a.length;l--;)s=a[l],this._paramsIds&&(i=this._paramsIds[l],i.indexOf("?")===0&&s&&(o[i+"_"]=s,s=d(s,n),a[l]=s),m&&""===s&&t(this._optionalParamsIds,i)!==-1&&(s=void 0,a[l]=s),o[i]=s),o[l]=s;return o.request_=n?r(e):e,o.vals_=a,o},_getParamsArray:function(e){var t,i=this.rules?this.rules.normalize_:null;return i=i||this._router.normalizeFn,t=i&&o(i)?i(e,this._getParamsObject(e)):this._getParamsObject(e).vals_},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},h.prototype.patternLexer=function(){function e(){var e,t;for(e in m)m.hasOwnProperty(e)&&(t=m[e],t.id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function t(e,t){var i,s=[];for(e.lastIndex=0;i=e.exec(t);)s.push(i[1]);return s}function i(e){return t(u,e)}function s(e){return t(m.OP.rgx,e)}function n(e,t){return e=e||"",e&&(g===f?e=e.replace(h,""):g===v&&(e=e.replace(c,"")),e=a(e,"rgx","save"),e=e.replace(d,"\\$&"),e=a(e,"rRestore","res"),g===f&&(e="\\/?"+e)),g!==p&&(e+="\\/?"),new RegExp("^"+e+"$",t?"i":"")}function a(e,t,i){var s,n;for(n in m)m.hasOwnProperty(n)&&(s=m[n],e=e.replace(s[t],s[i]));return e}function o(e,t,i){var s=t.exec(e);return s&&(s.shift(),i&&(s=l(s))),s}function r(e,t){if("string"!=typeof e)throw new Error("Route pattern should be a string.");var i=function(e,i){var s;if(i=i.substr(0,1)==="?"?i.substr(1):i,t[i]!=null){if(typeof t[i]=="object"){var n=[];for(var a in t[i])n.push(encodeURI(a+"="+t[i][a]));s="?"+n.join("&")}else s=String(t[i]);if(e.indexOf("*")===-1&&s.indexOf("/")!==-1)throw new Error('Invalid value "'+s+'" for segment "'+e+'".')}else{if(e.indexOf("{")!==-1)throw new Error("The segment "+e+" is required.");s=""}return s};return m.OS.trail||(m.OS.trail=new RegExp("(?:"+m.OS.id+")+$")),e.replace(m.OS.rgx,m.OS.save).replace(u,i).replace(m.OS.trail,"").replace(m.OS.rRestore,"/")}var d=/[\\.+*?\^$\[\](){}\/'#]/g,h=/^\/|\/$/g,c=/\/$/g,u=/(?:\{|:)([^}:]+)(?:\}|:)/g,m={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},f=1,p=2,v=3,g=f;return e(),{strict:function(){g=p},loose:function(){g=f},legacy:function(){g=v},getParamIds:i,getOptionalParamsIds:s,getParamValues:o,compilePattern:n,interpolate:r}}(),u};"function"==typeof define&&define.amd?define(["signals"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("signals")):window.crossroads=e(window.signals)})();