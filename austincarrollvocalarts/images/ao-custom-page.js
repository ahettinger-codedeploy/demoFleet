(function(){AO.models.ContentContainer=Backbone.Model.extend({defaults:{id:null,menu_id:null,block_type:null},parse:function(t){var e={};return t.status&&t.data!=void 0&&(e.id=t.data.container.id,this.blocks=t.data.blocks),e}}),AO.models.ContentContainerSection=Backbone.Model.extend({defaults:{id:null}}),AO.models.ContentContainerRow=Backbone.Model.extend({defaults:{id:null,pageId:null,position:0},savePosition:function(t){t=t||{};var e={item:{id:this.get("id"),position:this.get("position")}};return t.data=JSON.stringify(e),t.contentType="application/json",Backbone.Model.prototype.save.call(this,{},t)}}),AO.models.ContentContainerBlock=Backbone.Model.extend({defaults:{id:null}}),AO.models.CustomPage=Backbone.Model.extend(),AO.views.pages.Custom=Backbone.View.extend({events:{},tagName:"div",className:"content-section pages",initialize:function(t){this.pageId=t.pageId,this.name=t.name||"Section",this.container=null,this.model=new AO.models.CustomPage,this.row=null,this.tpl=t.tpl||1,this.rowModels={},this.typeSelector=null,this.rowsViews={},this.initTitle()},addContentTypeSelector:function(){return this},addBlock:function(t){var e=this,n=new AO.models.ContentContainer({menu_id:this.pageId,block_type:t});n.save(null,{url:"/onepage/content_containers",success:function(n){e.rowModels[n.get("id")]=n,e.renderContent(t,n)},error:function(){}})},renderContent:function(t,e){var n=e.get("id"),i=this;this.rowsViews[n]=new AO.views.ContentRow({model:new AO.models.ContentContainerRow({id:n,pageId:i.pageId})}),this.$el.find(".ao-container").append(this.rowsViews[n].el),this.rowsViews[n].addBlock(t,e.blocks),this.container?this.container.sortable("refresh"):this.addSortable(),$("html, body").stop().animate({scrollTop:$(i.rowsViews[n].el).offset().top},1500,"easeInOutExpo"),this.hideAddRowLoading()},render:function(){var t=_.template($("#content-page-section-template-"+this.tpl).html(),{title:this.name});return this.$el.attr("id","page_"+this.pageId),this.$el.html(t),this.initAddRowBox(),this.container||this.addSortable(),this.initTitle(),this},initTitle:function(){this.$el.find(".ao-headline").length>0},loadContent:function(){var t=this;this.model.url="/onepage/content_containers/"+this.pageId,this.model.fetch({success:function(){t.renderLoadedContent()},error:function(){}})},renderLoadedContent:function(){var t=this.model.get("data"),e=t.length,n=0,i=0,o=0,s=0;for(i;e>i;i++)for(this.rowsViews[t[i].id]=new AO.views.ContentRow({model:new AO.models.ContentContainerRow({id:t[i].id})}),this.$el.find(".ao-container").append(this.rowsViews[t[i].id].el),n=t[i].blocks.length,s=t[i].num,o=0;n>o;o++)t[i].blocks[o].width_id=s,this.rowsViews[t[i].id].renderBlock(o,t[i].blocks[o].type,t[i].blocks[o]);this.initAddRowBox(),this.addSortable()},addSortable:function(){return!1},show:function(){this.$el.show()},hide:function(){this.$el.hide()},deletePage:function(){for(var t in this.rowsViews)this.rowsViews[t].destroyView();this.destroyView()},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.addRow&&this.addRow.remove(),this.remove(),Backbone.View.prototype.remove.call(this)},textareaOff:function(){for(var t in this.rowsViews)this.rowsViews[t].textareaOff!=void 0&&this.rowsViews[t].textareaOff();this.title.textareaOff()},textareaOn:function(){for(var t in this.rowsViews)this.rowsViews[t].textareaOn!=void 0&&this.rowsViews[t].textareaOn();this.title.textareaOn()},initAddRowBox:function(){return!1},showAddRowLoading:function(){this.addRow!=void 0&&(this.addRow.find("a").hide(),this.addRow.find("img").show())},hideAddRowLoading:function(){this.addRow!=void 0&&(this.addRow.find("a").show(),this.addRow.find("img").hide())},showCoord:function(t){return!1}}),AO.views.ContentTypeSelector=Backbone.View.extend({events:{"click a.text-image-content-link":"showTextImageContents","click a.media-content-link":"showMediaContents","click a.social-content-link":"showSocialContents","click a.content-type-item":"chooseContentType","click .text-image-content-types a.ao-type-text-image":"show4col","click .media-content-types a.ao-type-media-content":"showMedia4col"},initialize:function(t){this.pageId=t.pageId},show4col:function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.textTypesContainer.find("."+$(t.currentTarget).attr("data-value")).show().siblings("div").hide()},showMedia4col:function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.mediaTypesContainer.find("."+$(t.currentTarget).attr("data-value")).show().siblings("div").hide()},chooseContentType:function(t){var e=$(t.currentTarget).attr("data-type");AO.core.events.trigger("content:add:"+this.pageId,e)},showTextImageContents:function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.textTypesContainer.show(),this.mediaTypesContainer.hide(),this.socialTypesContainer.hide()},showMediaContents:function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.textTypesContainer.hide(),this.mediaTypesContainer.show(),this.socialTypesContainer.hide()},showSocialContents:function(t){$(t.currentTarget).addClass("active").siblings().removeClass("active"),this.textTypesContainer.hide(),this.mediaTypesContainer.hide(),this.socialTypesContainer.show()},render:function(){var t=_.template($("#content-type-selector-template").html());return this.$el.html(t),this.textTypesContainer=this.$el.find(".text-image-content-types"),this.mediaTypesContainer=this.$el.find(".media-content-types"),this.socialTypesContainer=this.$el.find(".social-content-types"),this}}),AO.views.ContentRow=Backbone.View.extend({tagName:"div",className:"row panel panel-default",events:{},initialize:function(){this.blocks=[],this.actions=null,this.render(),this.add_loading=this.$el.find(".content-row-loading-add-block"),this.add_block=this.$el.find(".content-row-add-block"),AO.core.events.on("content:row:after_delete_block:"+this.model.get("id"),$.proxy(this.afterDeleteBlock,this)),AO.core.events.on("content:row:update_blank_block:"+this.model.get("id"),$.proxy(this.updateBlankBlock,this))},showActions:function(){this.actions.show()},hideActions:function(){this.actions.hide()},showAddBlockLoading:function(){this.add_loading.removeClass("hidden"),this.add_block.addClass("hidden")},hideAddBlockLoading:function(){this.add_loading.addClass("hidden"),this.add_block.removeClass("hidden")},render:function(){var t=_.template($("#content-row").html()),e=this;this.$el.attr("id","page_row_"+this.model.get("id")),this.$el.html(t),this.actions=this.$el.find(".content-row-action"),AO.core.events.on("section:content:row:move:"+this.model.get("id"),$.proxy(this.move,this)),AO.core.events.on("section:content:row:before_move:"+this.model.get("id"),$.proxy(this.beforeMove,this)),AO.core.events.on("section:content:row:delete:"+this.model.get("id"),$.proxy(this.destroy,this)),this.$el.sortable({items:".block-content",handle:".ao-block-action-move",start:function(){e.beforeMoveBlock()},stop:function(t,n){var i=parseInt(n.item.index(),10),o=n.item.attr("id").split("_").pop();e.afterMoveBlock(),$.ajax({type:"POST",data:{item:{id:o,position:i-3}},url:"/onepage/content_blocks/move",success:function(t){t=$.parseJSON(t),console.log(t)}})}})},addBlock:function(t,e){if(console.log(t),"blank"==t)console.log("add blank"),this.addEmptyBlock();else{t=t.split("_");var n=t[0],i=t[1],o=0;i=void 0==i?1:parseInt(i);var s=n.charAt(0).toUpperCase()+n.slice(1);for(o;i>o;o++)this.renderBlock(o,s,e[o])}},checkAddBlockLink:function(){var t=this.$el.find(".block-content").length;t>3?this.$el.find(".content-row-add-block").hide():this.$el.find(".content-row-add-block").show()},addEmptyBlock:function(){var t=this.$el.find(".block-content").length,e=(AO.modules.helpers.lengthToWidthClass(t),AO.modules.helpers.lengthToWidthClass(t+1),new AO.models.contentBlocks.Blank({onepage_content_container_id:this.model.get("id")})),n=this;this.showAddBlockLoading(),e.save(null,{url:"/onepage/blank_content_blocks",success:function(){n.blocks.push(new AO.views.contentBlocks.Blank({model:e})),n.$el.append(n.blocks[n.blocks.length-1].render().el),n.$el.find(".block-content").each(function(){});for(var i=0;i<n.blocks.length;i++)n.blocks[i]!=void 0&&n.blocks[i].changeWidth(t+1);n.hideAddBlockLoading(),n.checkAddBlockLink()},error:function(){n.hideAddBlockLoading()}}),this.$el.sortable("refresh")},renderBlock:function(t,e,n){this.blocks[t]=new AO.views.contentBlocks[e]({model:new AO.models.contentBlocks[e](n)}),this.$el.append(this.blocks[t].render().el),this.checkAddBlockLink()},beforeMove:function(){this.textareaOff()},move:function(t){this.model.set("position",t),this.model.savePosition({url:"/onepage/content_containers/move",success:function(){},error:function(){}}),this.textareaOn()},textareaOff:function(){for(var t in this.blocks)this.blocks[t].textareaOff!=void 0&&this.blocks[t].textareaOff()},textareaOn:function(){for(var t in this.blocks)this.blocks[t].textareaOn!=void 0&&this.blocks[t].textareaOn()},deleteBlock:function(){var t=this,e=this.model.get("id");this.model.destroy({url:"/onepage/content_containers/"+e,success:function(){var e=t.blocks.length,n=0;for(n=0;e>n;n++)t.blocks[n]!=void 0&&t.blocks[n].destroyView();t.destroyView()},error:function(){}})},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind();try{this.remove()}catch(t){var e=document.getElementById("page_row_"+this.model.get("id"));e.parentNode.removeChild(e)}Backbone.View.prototype.remove.call(this)},afterDeleteBlock:function(t){var e=this,n=e.blocks.length,i=0;for(console.log("after delete"),console.log(e.blocks),i=0;n>i;i++)console.log(i),e.blocks[i]!=void 0?parseInt(t)==e.blocks[i].model.get("id")&&(console.log("delete "+t),e.blocks[i].destroyView(),e.blocks[i].removeView(),e.refreshBlocksWidth(),delete e.blocks[i]):console.log(i+" undefined");e.checkAddBlockLink()},refreshBlocksWidth:function(){var t=this.$el.find(".block-content").length,e=AO.modules.helpers.lengthToWidthClass(t+1),n=AO.modules.helpers.lengthToWidthClass(t);this.$el.find(".block-content").each(function(){$(this).removeClass(e).addClass(n)})},refreshBlocksSort:function(){},updateBlankBlock:function(t,e){for(var n=this.$el.find("#page_block_"+t),i=this.$el.find(".block-content").length,o=null,s=null,r=0;r<this.blocks.length;r++)this.blocks[r]!=void 0&&this.blocks[r].model.get("id")==t&&(o=r,s=this.blocks[r].model.get("onepage_content_container_id"),this.blocks[r].destroyView());console.log("ii "+o),null!=o?(console.log("push "+o),this.blocks[o]=new AO.views.contentBlocks[e]({el:n,model:new AO.models.contentBlocks[e]({id:t,width_id:i,onepage_content_container_id:s})}),this.blocks[o].render()):(console.log("push push"),this.blocks.push(new AO.views.contentBlocks[e]({el:n,model:new AO.models.contentBlocks[e]({id:t,width_id:i,onepage_content_container_id:s})})),this.blocks[this.blocks.length-1].render()),$.ajax({type:"POST",data:{id:t,type_name:e},url:"/onepage/text_content_blocks/change",success:function(t){t=$.parseJSON(t),console.log(t)}})},beforeMoveBlock:function(){var t=this.blocks.length;console.log("before block move");for(var e=0;t>e;e++)this.blocks[e]!=void 0&&this.blocks[e].textareaOff!=void 0&&(console.log("block move text off"),console.log(this.blocks[e].textareaOff),this.blocks[e].textareaOff())},afterMoveBlock:function(){var t=this.blocks.length;console.log("after block move");for(var e=0;t>e;e++)this.blocks[e]!=void 0&&this.blocks[e].textareaOff!=void 0&&(console.log("block move text on"),this.blocks[e].textareaOn())}})})();