(function(){AO.models.contentBlocks.Blank=Backbone.Model.extend({defaults:{id:null,onepage_content_container_id:null,width_id:1},toJSON:function(){var t=_.clone(this.attributes),e={content_block:{onepage_content_container_id:t.onepage_content_container_id}};return e},parse:function(t){return(t.status==void 0||t.status)&&t.status!=void 0&&t.status&&(t=t.data),t}}),AO.models.contentBlocks.Text=Backbone.Model.extend({defaults:{id:null,width_id:1,onepage_content_container_id:null,title:"Title here. Click to edit",text:"Text here. Click to edit. Text here. Click to edit. Text here. Click to edit."}}),AO.models.contentBlocks.Textimage=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Title here. Click to edit",text:"Text here. Click to edit. Text here. Click to edit. Text here. Click to edit.",image_style_class:"ao-image-float-left ao-iw25",image_file_name:null}}),AO.models.contentBlocks.Image=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Image title.",image_file_name:null}}),AO.models.contentBlocks.Youtubevideo=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Video title",text:"Video description",source_id:null,embed:null,video_thumb:null},videoData:function(){var t=_.clone(this.attributes),e={id:t.id,width_id:t.width_id,source_id:t.source_id,embed:t.embed,video_thumb:t.video_thumb};return e}}),AO.models.contentBlocks.Vimeovideo=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Video title",text:"Video description",source_id:null,embed:null,video_thumb:null},videoData:function(){var t=_.clone(this.attributes),e={id:t.id,width_id:t.width_id,source_id:t.source_id,embed:t.embed,video_thumb:t.video_thumb};return e}}),AO.models.contentBlocks.Soundcloudtrack=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Track title.",text:"Track description.",source_id:null,embed:null,video_thumb:null,onepage_content_container_id:null},trackData:function(){var t=_.clone(this.attributes),e={id:t.id,width_id:t.width_id,source_id:t.source_id,embed:t.embed,track_thumb:t.track_thumb};return e}}),AO.models.contentBlocks.Mixcloudtrack=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Track title.",text:"Track description.",source_id:null,embed:null,video_thumb:null,onepage_content_container_id:null},trackData:function(){var t=_.clone(this.attributes),e={id:t.id,width_id:t.width_id,source_id:t.source_id,embed:t.embed,track_thumb:t.track_thumb};return e}}),AO.models.contentBlocks.Bandcamptrack=Backbone.Model.extend({defaults:{id:null,width_id:1,title:"Track title.",text:"Track description.",source_id:null,embed:null,video_thumb:null,onepage_content_container_id:null},trackData:function(){var t=_.clone(this.attributes),e={id:t.id,width_id:t.width_id,source_id:t.source_id,embed:t.embed,track_thumb:t.track_thumb};return e}}),AO.models.contentBlockSectionTitle=Backbone.Model.extend({defaults:{title:"Section",part_of:"menu",id:null},toJSON:function(){var t=_.clone(this.attributes),e={menu:{id:t.id,title:t.title,ret_data:"item"}};return e},_save:function(){var t=this;this.save({},{url:"menu/"+t.get("id"),success:function(){},error:function(){}})}}),AO.models.OnepageConfigureParam=Backbone.Model.extend({defaults:{param:null,value:null,template_id:null},toJSON:function(){var t=_.clone(this.attributes),e={configure:{param:t.param,value:t.value,template_id:t.template_id}};return e},_save:function(t,e){this.save({},{url:"onepage/configures/update_attribute",success:function(){t()},error:function(){e()}})}}),AO.models.contentBlockBase=Backbone.Model.extend({save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.models.contentBlockTitle=AO.models.contentBlockBase.extend({defaults:{title:"Title text"}}),AO.models.contentBlockText=AO.models.contentBlockBase.extend({defaults:{text:"Title text"}}),AO.models.contentBlockImage1=AO.models.contentBlockBase.extend({defaults:{id:null,width_id:null,image_style_class:"ao-image-float-left ao-iw25",image_file_name:null}}),AO.models.contentBlockImage2=Backbone.Model.extend({defaults:{id:null,width_id:null,image_file_name:null}}),AO.models.contentBlockYoutubeVideo=Backbone.Model.extend({defaults:{id:null,width_id:null,source_id:null,embed:null,video_thumb:null},save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.models.contentBlockVimeoVideo=Backbone.Model.extend({defaults:{id:null,width_id:null,source_id:null,embed:null,video_thumb:null},save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.models.contentBlockSoundcloudTrack=Backbone.Model.extend({defaults:{id:null,width_id:null,source_id:null,embed:null,video_thumb:null},save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.models.contentBlockMixcloudTrack=Backbone.Model.extend({defaults:{id:null,width_id:null,source_id:null,embed:null,video_thumb:null},save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.models.contentBlockBandcampTrack=Backbone.Model.extend({defaults:{id:null,width_id:null,source_id:null,embed:null,video_thumb:null},save:function(t,e,i){i=i||{},e=e||{};var s={block:{}};return t?(s.block.value=this.get(t),s.block.attr=t,s.block.id=this.get("id"),i.data=JSON.stringify(s)):i.data=this.toJSON(),i.contentType="application/json",Backbone.Model.prototype.save.call(this,e,i)}}),AO.views.contentBlockText=Backbone.View.extend({events:{},initialize:function(t){var e=this;this.attr=t.attr||null,this.name=t.name||null,this.edit_mode=!1,this.text=this.$el.find(".ao-editable-text"),this.editor=this.$el.find(".ao-text-editor"),this.edit=this.$el.find(".edit-overlay"),this.empty=this.$el.find(".empty-overlay"),setTimeout(function(){e.textarea=e.$el.find("textarea").tinymce(AO.tinyMCEoptions),e.showEmpty()},100)},save:function(){var t=this.textarea.html(),e=t.length,i=this,s=this.model.get("id");this.text.html(t),this.hideEditor(),this.model.set(this.attr,t),typeof this.model._save=="function"?this.model._save():this.model.save(this.attr,{},{url:"onepage/"+i.name+"_content_blocks/"+s,success:function(){},error:function(){}}),e>0?(this.text.show(),this.empty.hide()):(this.text.hide(),this.empty.show())},showEmpty:function(){var t=this.text.html(),e=0;void 0!=t&&(e=t.replace(/^\s+|\s+$/gm,"").length),0==e&&(this.text.hide(),this.empty.show())},cancel:function(){this.hideEditor(),this.showEmpty()},clear:function(){this.textarea.html("")},showEditor:function(t){t.preventDefault();var e=this;this.editor.show(),this.text.hide(),this.edit.hide(),this.textarea==null?setTimeout(function(){e.textarea=e.$el.find("textarea").tinymce(AO.tinyMCEoptions),e.textarea.html(e.text.html())},100):this.textarea.html(this.text.html()),this.edit_mode=!0,this.empty.hide()},hideEditor:function(){this.editor.hide(),this.text.show(),this.edit.show(),this.edit_mode=!1},showEditLink:function(t){t.preventDefault(),this.edit_mode||this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.edit.hide()},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind()},textareaOff:function(){this.hideEditor(),this.edit.hide(),this.textarea&&this.textarea.tinymce().remove(),this.textarea=null},textareaOn:function(){var t=this;setTimeout(function(){t.textarea=t.$el.find("textarea").tinymce(AO.tinyMCEoptions),t.showEmpty()},100)}}),AO.views.contentBlockImage1=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","mousedown .upload-file-image":"editModeOn"},initialize:function(t){var e=this,i=this.model.get("id");this.edit_mode=!1,this.name=t.name||null,this.allowEditPFEl=this.$el.find(".ao-allow-edit-position-size"),this.edit=this.$el.find(".edit-overlay"),this.editImgSizeEl=this.$el.find(".ao-edit-img-size"),this.editImgSizeMinusEl=this.$el.find(".ao-edit-img-size-minus"),this.editImgSizeMinusEl.click(function(){e.changeImageWidth("-")}),this.editImgSizePlusEl=this.$el.find(".ao-edit-img-size-plus"),this.editImgSizePlusEl.click(function(){e.changeImageWidth("+")}),this.editImgFloatEl=this.$el.find(".ao-edit-img-float"),this.editImgFloatLeftEl=this.$el.find(".ao-edit-img-float-left"),this.editImgFloatLeftEl.click($.proxy(this.setLeftFloat,this)),this.editImgFloatRightEl=this.$el.find(".ao-edit-img-float-right"),this.editImgFloatRightEl.click($.proxy(this.setRightFloat,this)),this.$el.hasClass("ao-image-float-left")?this.editImgFloatLeftEl.hide():this.editImgFloatRightEl.hide(),this.img1000=this.$el.find(".ao-img-w1000"),this.img500=this.$el.find(".ao-img-w500"),this.img250=this.$el.find(".ao-img-w250"),this.img150=this.$el.find(".ao-img-w150"),this.formEl=this.$el.find(".upload_image"),this.bar=this.$el.find(".bar"),this.percent=this.$el.find(".percent"),this.progressBar=this.$el.find(".progress"),this.formEl.ajaxForm({url:"onepage/"+e.name+"_content_blocks/"+i,type:"PUT",beforeSend:function(){var t="0%";e.bar.width(t),e.percent.html(t),e.formEl.hide(),e.progressBar.show()},uploadProgress:function(t,i,s,a){var n=a+"%";e.bar.width(n),e.percent.html(n)},success:function(t){var i="100%";e.bar.width(i),e.percent.html(i),e.edit_mode=!1;var s="",a="",n="",o="";t=$.parseJSON(t),t.status&&(s="/system/onepage_content_block/image/"+t.data.id+"/size1000x/"+t.data.image_file_name+"?hash="+Math.random(),a="/system/onepage_content_block/image/"+t.data.id+"/size500x/"+t.data.image_file_name+"?hash="+Math.random(),n="/system/onepage_content_block/image/"+t.data.id+"/size250x/"+t.data.image_file_name+"?hash="+Math.random(),o="/system/onepage_content_block/image/"+t.data.id+"/size150x/"+t.data.image_file_name+"?hash="+Math.random(),e.img1000.attr("src",s),e.img500.attr("src",a),e.img250.attr("src",n),e.img150.attr("src",o))},complete:function(){e.formEl.show(),e.progressBar.hide(),e.edit_mode=!1}}),this.formEl.find(".upload-file-image").change(function(){e.edit_mode=!0,e.formEl.submit()})},editModeOn:function(){this.edit_mode=!0},changeImageWidth:function(t){var e=parseInt(this.$el.attr("data-image-width"),10),i="ao-iw"+e,s="ao-iw"+e;e="+"==t?this.plusImageSize(e):this.minusImageSize(e),s="ao-iw"+e,i!=s&&(this.$el.removeClass(i).addClass(s),this.$el.attr("data-image-width",e)),this.saveImageStyle()},minusImageSize:function(t){return 35==t?(t=25,this.editImgSizePlusEl.show()):25==t&&(t=15,this.editImgSizeMinusEl.hide()),t},plusImageSize:function(t){return 25==t?(t=35,this.editImgSizePlusEl.hide()):15==t&&(t=25,this.editImgSizeMinusEl.show()),t},setLeftFloat:function(){this.editImgFloatLeftEl.hide(),this.editImgFloatRightEl.show(),this.$el.removeClass("ao-image-float-right").addClass("ao-image-float-left"),this.saveImageStyle()},setRightFloat:function(){this.editImgFloatLeftEl.show(),this.editImgFloatRightEl.hide(),this.$el.removeClass("ao-image-float-left").addClass("ao-image-float-right"),this.saveImageStyle()},showEditPf:function(){this.allowEditPFEl.is(":visible")?(this.editImgFloatEl.show(),this.editImgSizeEl.show()):(this.editImgFloatEl.hide(),this.editImgSizeEl.hide())},showEditLink:function(t){t.preventDefault(),this.edit_mode||this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.edit.hide()},saveImageStyle:function(){var t="ao-image-float-left",e=parseInt(this.$el.attr("data-image-width"),10),i="ao-iw"+e,s="",a=this.model.get("id"),n=this;this.$el.hasClass("ao-image-float-right")&&(t="ao-image-float-right"),s=t+" "+i,this.model.set("image_style_class",s),this.model.save("image_style_class",{},{url:"onepage/"+n.name+"_content_blocks/"+a,success:function(){},error:function(){}})},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind()}}),AO.views.contentBlockImage2=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink"},initialize:function(t){var e=this,i=this.model.get("id");this.edit_mode=!1,this.name=t.name||null,this.edit=this.$el.find(".edit-overlay"),this.img1000=this.$el.find(".ao-img-w1000"),this.img500=this.$el.find(".ao-img-w500"),this.img250=this.$el.find(".ao-img-w250"),this.img150=this.$el.find(".ao-img-w150"),this.formEl=this.$el.find(".upload_image"),this.bar=this.$el.find(".bar"),this.percent=this.$el.find(".percent"),this.progressBar=this.$el.find(".progress"),this.formEl.ajaxForm({url:"onepage/"+e.name+"_content_blocks/"+i,type:"PUT",beforeSend:function(){var t="0%";e.bar.width(t),e.percent.html(t),e.formEl.hide(),e.progressBar.show()},uploadProgress:function(t,i,s,a){var n=a+"%";e.bar.width(n),e.percent.html(n)},success:function(t){var i="100%";e.bar.width(i),e.percent.html(i),e.edit_mode=!1;var s="",a="",n="",o="";t=$.parseJSON(t),t.status&&(s="/system/onepage_content_block/image/"+t.data.id+"/size1000x/"+t.data.image_file_name+"?hash="+Math.random(),a="/system/onepage_content_block/image/"+t.data.id+"/size500x/"+t.data.image_file_name+"?hash="+Math.random(),n="/system/onepage_content_block/image/"+t.data.id+"/size250x/"+t.data.image_file_name+"?hash="+Math.random(),o="/system/onepage_content_block/image/"+t.data.id+"/size150x/"+t.data.image_file_name+"?hash="+Math.random(),e.img1000.attr("src",s),e.img500.attr("src",a),e.img250.attr("src",n),e.img150.attr("src",o))},complete:function(){e.formEl.show(),e.progressBar.hide(),e.edit_mode=!1}}),this.formEl.find(".upload-file-image").change(function(){e.edit_mode=!0,e.formEl.submit()})},showEditLink:function(t){t.preventDefault(),this.edit_mode||this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.edit.hide()},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind()}}),AO.views.contentBlockYoutubeVideo=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","click .play-overlay":"showEmbed"},initialize:function(){var t=this;this.edit=this.$el.find(".edit-overlay"),this.form=this.$el.find("form"),this.iframe=this.$el.find(".ao-video-iframe"),this.thumb=this.$el.find(".ao-video-thumb"),this.play=this.$el.find(".play-overlay"),this.form.submit(function(){return t.submitForm(),!1})},showEditLink:function(t){t.preventDefault(),this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.edit.hide()},showEmbed:function(){var t=this.model.get("embed");t&&(this.iframe.html(t).show(),this.thumb.hide(),this.play.hide())},submitForm:function(){var t=this.form.find("input[type=text]").val(),e="",i=this.model.get("id");return t=this.youtubeParser(t),t&&(e='<iframe  src="//www.youtube.com/embed/'+t+'" frameborder="0" allowfullscreen></iframe>',this.iframe.html(e).show(),this.thumb.hide(),this.play.hide(),this.model.set("source_id",t),this.model.save("source_id",{},{url:"onepage/youtube_video_content_blocks/"+i,success:function(){},error:function(){}})),!1},youtubeParser:function(t){var e=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,i=t.match(e);return i&&i[7].length==11?i[7]:null},destroyView:function(){this.iframe.empty(),this.undelegateEvents(),this.$el.removeData().unbind()}}),AO.views.contentBlockVimeoVideo=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","click .play-overlay":"showEmbed"},initialize:function(){var t=this;this.edit=this.$el.find(".edit-overlay"),this.form=this.$el.find("form"),this.iframe=this.$el.find(".ao-video-iframe"),this.thumb=this.$el.find(".ao-video-thumb"),this.play=this.$el.find(".play-overlay"),this.form.submit(function(){return t.submitForm(),!1})},showEditLink:function(t){t.preventDefault(),this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.edit.hide()},showEmbed:function(){var t=this.model.get("embed");t&&(this.iframe.html(t).show(),this.thumb.hide(),this.play.hide())},submitForm:function(){var t=this.form.find("input[type=text]").val(),e="",i=this.model.get("id");return t=this.vimeoParser(t),t&&(e='<iframe src="//player.vimeo.com/video/'+t+'"  frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>',this.iframe.html(e).show(),this.thumb.hide(),this.play.hide(),this.model.set("source_id",t),this.model.save("source_id",{},{url:"onepage/vimeo_video_content_blocks/"+i,success:function(){},error:function(){}})),!1},vimeoParser:function(t){var e=/http:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,i=t.match(e);return i?i[2]:null},destroyView:function(){this.iframe.empty(),this.undelegateEvents(),this.$el.removeData().unbind()}}),AO.views.contentBlockSoundcloudTrack=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","click .play-overlay":"showEmbed","focus form input[type=text]":"onEditMode","blur form input[type=text]":"offEditMode"},initialize:function(){var t=this;this.edit=this.$el.find(".edit-overlay"),this.form=this.$el.find("form"),this.iframe=this.$el.find(".ao-soundcloudtrack-iframe"),this.thumb=this.$el.find(".ao-soundcloudtrack-thumb"),this.play=this.$el.find(".play-overlay"),this.editMode=!1,this.form.submit(function(){return t.submitForm(),!1}),AO.core.events.on("soundcloud:iframe:load",$.proxy(this.showEmbed,this))},showEditLink:function(t){t.preventDefault(),this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.editMode||this.edit.hide()},showEmbed:function(){var t=this.model.get("embed"),e=166;t&&(t=t.replace("auto_play=true","auto_play=false"),this.iframe.html(t).show(),this.thumb.hide(),this.play.hide(),e=this.iframe.find("iframe").attr("height"),this.iframe.css("height",e+"px"))},onEditMode:function(){this.editMode=!0},offEditMode:function(){this.editMode=!1},submitForm:function(){var t=this.form.find("input[type=text]").val(),e=this.soundcloudParser(t),i="",s=this.model.get("id");return"object"==typeof e&&(i=this.soundcloudIframe(e),this.iframe.html(i).show(),console.log(e.height),this.iframe.css("height",e.height+"px"),this.thumb.hide(),this.play.hide(),this.model.set("source_id",this.soundcloudSource(e)),this.model.save("source_id",{},{url:"onepage/soundcloud_track_content_blocks/"+s,success:function(){},error:function(){}})),!1},soundcloudParser:function(t){var e={height:0,playlists:!1,tracks:!1,source_id:null,color:null,visual:!1},i=/^<iframe.*(height)=\"(\d{1,10})\".*?url=.*soundcloud\.com\/(tracks|playlists)\/(\d+)&amp;((color)=([a-zA-Z0-9]{1,6})|).*((visual)=(\w{1,5})|(show_reposts)=(\w{1,5}))"><\/iframe>$/i,s=t.match(i);if(s.length>1)for(var a=0;a<s.length;a++)s[a]=="height"&&(e.height=s[a+1]),s[a]=="playlists"&&(e.playlists=!0,e.source_id=s[a+1]),s[a]=="tracks"&&(e.tracks=!0,e.source_id=s[a+1]),s[a]=="color"&&(e.color=s[a+1]),s[a]=="visual"&&(e.visual=!0);else e=!1;return e},soundcloudSource:function(t){var e="";return e+="height="+t.height+"&",t.playlists?e+="playlists="+t.source_id+"&":t.tracks&&(e+="tracks="+t.source_id+"&"),t.color!=null&&(e+="color="+t.color+"&"),t.visual&&(e+="visual=true&"),e},soundcloudIframe:function(t){var e=t.height,i="",s="",a="",n="";return t.color!=null&&(i="color="+t.color+"&amp;"),t.visual&&(s="&amp;visual=true"),t.playlists?a="playlists/"+t.source_id:t.tracks&&(a="tracks/"+t.source_id),n='<iframe width="100%" height="'+e+'" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/'+a+"&amp;"+i+"auto_play=true&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false"+s+'"></iframe>'},soundcloudParser1:function(t){var e=t.split("color"),i=/<iframe[^>]*\ssrc="[^"]*\?url=([^&]*\/api.soundcloud.com\/tracks\/(\d+)[^&]*)&/;e.length>1&&(i=/<iframe[^>]*\ssrc="[^"]*\?url=([^&]*\/api.soundcloud.com\/tracks\/(\d+)[^&]*)*[\&\w\;\=]+color=([\w\d]+)/);var s=t.match(i),a=[];return s&&s[2].length>1?(a.push(s[2]),s[3]!=void 0&&s[3].length>1&&a.push(s[3]),a):a},destroyView:function(){this.iframe.empty(),this.undelegateEvents(),this.$el.removeData().unbind()},changeWidth:function(t){console.log(t),console.log(this.$el.find(".ao-soundcloudtrack-thumb img").attr("src"));var e=this.$el.find(".ao-soundcloudtrack-thumb img").attr("src"),i=e.substring(e.length-4,e.length),s=e.substring(0,e.length-5),a=s+t+i;this.$el.find(".ao-soundcloudtrack-thumb img").attr("src",a)}}),AO.views.contentBlockMixcloudTrack=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","click .play-overlay":"showEmbed","focus form input[type=text]":"onEditMode","blur form input[type=text]":"offEditMode"},initialize:function(){var t=this;this.edit=this.$el.find(".edit-overlay"),this.form=this.$el.find("form"),this.iframe=this.$el.find(".ao-mixcloudtrack-iframe"),this.thumb=this.$el.find(".ao-mixcloudtrack-thumb"),this.play=this.$el.find(".play-overlay"),this.editMode=!1,this.form.submit(function(){return t.submitForm(),!1}),this.model.get("embed")&&setTimeout(function(){},100),AO.core.events.on("mixcloud:iframe:load",$.proxy(this.showEmbed,this))},showEditLink:function(t){t.preventDefault(),this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.editMode||this.edit.hide()},showEmbed:function(){var t=this.model.get("embed"),e=166;t&&(this.iframe.html(t).show(),this.thumb.hide(),this.play.hide(),e=this.iframe.find("iframe").attr("height"),this.iframe.css("height",e+"px"))},onEditMode:function(){this.editMode=!0},offEditMode:function(){this.editMode=!1},submitForm:function(){var t=this.form.find("input[type=text]").val(),e=this.mixcloudParser(t),i="",s=this.model.get("id");return"object"==typeof e&&(i=this.mixcloudIframe(e),this.iframe.html(i).show(),console.log(e.height),this.iframe.css("height",e.height+"px"),this.thumb.hide(),this.play.hide(),this.model.set("source_id",this.mixcloudSource(e)),this.model.save("source_id",{},{url:"onepage/mixcloud_track_content_blocks/"+s,success:function(){},error:function(){}})),!1},mixcloudParser:function(t){var e={height:0,source_id:null},i=/^<iframe.*((height)=\"(\d{1,6})\").*(src)=\".*?feed=(.*)\"\s.*<\/iframe>.*$/i,s=t.match(i);if(s&&s.length>1)for(var a=0;a<s.length;a++)s[a]=="height"&&(e.height=s[a+1]),s[a]=="src"&&(e.source_id=s[a+1]);else e=!1;return e},mixcloudSource:function(t){var e="height="+t.height+"+src="+t.source_id;return e},mixcloudIframe:function(t){var e='<iframe width="100%" height="'+t.height+'" src="//www.mixcloud.com/widget/iframe/?feed='+t.source_id+'" frameborder="0"></iframe>';return e},mixcloudParser1:function(t){var e=t.split("color"),i=/<iframe[^>]*\ssrc="[^"]*\?url=([^&]*\/api.soundcloud.com\/tracks\/(\d+)[^&]*)&/;e.length>1&&(i=/<iframe[^>]*\ssrc="[^"]*\?url=([^&]*\/api.soundcloud.com\/tracks\/(\d+)[^&]*)*[\&\w\;\=]+color=([\w\d]+)/);var s=t.match(i),a=[];return s&&s[2].length>1?(a.push(s[2]),s[3]!=void 0&&s[3].length>1&&a.push(s[3]),a):a},destroyView:function(){this.iframe.empty(),this.undelegateEvents(),this.$el.removeData().unbind()},changeWidth:function(t){console.log(t),console.log(this.$el.find(".ao-mixcloudtrack-thumb img").attr("src"));var e=this.$el.find(".ao-mixcloudtrack-thumb img").attr("src"),i=e.substring(e.length-4,e.length),s=e.substring(0,e.length-5),a=s+t+i;this.$el.find(".ao-mixcloudtrack-thumb img").attr("src",a)}}),AO.views.contentBlockBandcampTrack=Backbone.View.extend({events:{mouseenter:"showEditLink",mouseleave:"hideEditLink","click .play-overlay":"showEmbed","focus form input[type=text]":"onEditMode","blur form input[type=text]":"offEditMode"},initialize:function(){var t=this;this.edit=this.$el.find(".edit-overlay"),this.form=this.$el.find("form"),this.iframe=this.$el.find(".ao-bandcamptrack-iframe"),this.thumb=this.$el.find(".ao-bandcamptrack-thumb"),this.play=this.$el.find(".play-overlay"),this.editMode=!1,this.form.submit(function(){return t.submitForm(),!1}),this.model.get("embed")&&setTimeout(function(){},100),AO.core.events.on("bandcamp:iframe:load",$.proxy(this.showEmbed,this))},showEditLink:function(t){t.preventDefault(),this.edit.show()},hideEditLink:function(t){t.preventDefault(),this.editMode||this.edit.hide()},showEmbed:function(){var t=this.model.get("embed");t&&(this.iframe.html(t).show(),this.thumb.hide(),this.play.hide(),this.resizeIframe())},onEditMode:function(){this.editMode=!0},offEditMode:function(){this.editMode=!1},submitForm:function(){var t=this.form.find("input[type=text]").val(),e=this.bandcampParser(t),i="",s=this.model.get("id");return"object"==typeof e&&(i=this.bandcampIframe(e),this.iframe.html(i).show(),this.resizeIframe(),this.thumb.hide(),this.play.hide(),this.model.set("source_id",this.bandcampSource(e)),this.model.save("source_id",{},{url:"onepage/bandcamp_track_content_blocks/"+s,success:function(){},error:function(){}})),!1},resizeIframe:function(){var t=0,e=0,t=parseInt(this.iframe.width()),i=parseFloat(this.iframe.find("iframe").attr("data-wh"));t>700&&(t=700),e=0==i?this.iframe.find("iframe").attr("data-h"):parseInt(t/i),this.iframe.css("height",e+"px"),this.iframe.find("iframe").css("height",e+"px")},bandcampParser:function(t){var e={height:0,width:0,width_unit:null,source_id:null,href:null,artist:""},i=/^<iframe.*((width):\s(\d{1,4})(.{1,1})).*((height):\s(\d{1,4})).*(src)=\"(.*)\"\s.*><a\s(href)=\"(.*)\">(.*)<\/a>.*<\/iframe>.*$/i,s=t.match(i);if(s&&s.length>1)for(var a=0;a<s.length;a++)s[a]=="width"&&(e.width=s[a+1],e.width_unit=s[a+2]),s[a]=="height"&&(e.height=s[a+1]),s[a]=="src"&&(e.source_id=s[a+1]),s[a]=="href"&&(e.href=s[a+1],e.artist=s[a+2]);else e=!1;return e},bandcampSource:function(t){var e="width="+t.width+"+width_unit="+t.width_unit+"+height="+t.height+"+src="+t.source_id+"+href="+t.href+"+artist="+t.artist;return e},bandcampIframe:function(t){var e=Math.round(parseFloat(t.width)/parseFloat(t.height)*100)/100,i='<iframe data-wh="'+e+'" style="border: 0; width: 100%; height: '+t.height+'px;" src="'+t.source_id+'" seamless><a href="'+t.href+'">'+t.artist+"</a></iframe>";return i},destroyView:function(){this.iframe.empty(),this.undelegateEvents(),this.$el.removeData().unbind()},changeWidth:function(t){var e=this.$el.find(".ao-bandcamptrack-thumb img").attr("src"),i=e.substring(e.length-4,e.length),s=e.substring(0,e.length-5),a=s+t+i;this.$el.find(".ao-bandcamptrack-thumb img").attr("src",a)}}),AO.views.contentBlocks.Blank=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete","change .ao-select-type":"selectType","click .ao-accept-select":"accept"},tagName:"div",className:"block-content",initialize:function(){},render:function(){var t=_.template($("#content-empty").html(),{});this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(t);var e=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(e),this.select=this.$el.find(".ao-select-type"),this.accept=this.$el.find(".ao-accept-select"),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},destroyView:function(){this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},selectType:function(){var t=this.select.val();"Blank"==t?this.accept.addClass("hidden"):this.accept.removeClass("hidden")},accept:function(){var t=this.select.val();AO.core.events.trigger("content:row:update_blank_block:"+this.model.get("onepage_content_container_id"),this.model.get("id"),t)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)}}),AO.views.contentBlocks.Text=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-text").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"text",attr:"title",el:this.$el.find(".ao-text-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"text",attr:"text",el:this.$el.find(".ao-text-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})}}),AO.views.contentBlocks.Textimage=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-text-image").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"text_image",attr:"title",el:this.$el.find(".ao-textimage-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"text_image",attr:"text",el:this.$el.find(".ao-textimage-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.image=new AO.views.contentBlockImage1({name:"text_image",el:this.$el.find(".ao-textimage-image-container"),model:new AO.models.contentBlockImage1({id:t,width_id:this.model.get("width_id")})}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.image.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));
this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}}),AO.views.contentBlocks.Image=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-image").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"image",attr:"title",el:this.$el.find(".ao-image-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.image=new AO.views.contentBlockImage2({name:"image",el:this.$el.find(".ao-image-image-container"),model:new AO.models.contentBlockImage2({id:t,width_id:this.model.get("width_id")})}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.image.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff()},textareaOn:function(){this.title.textareaOn()}}),AO.views.contentBlocks.Youtubevideo=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-youtubevideo").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"youtube_video",attr:"title",el:this.$el.find(".ao-youtubevideo-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"youtube_video",attr:"text",el:this.$el.find(".ao-youtubevideo-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.video=new AO.views.contentBlockYoutubeVideo({el:this.$el.find(".ao-youtubevideo-source"),model:new AO.models.contentBlockYoutubeVideo(this.model.videoData())}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.video.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}}),AO.views.contentBlocks.Vimeovideo=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-vimeovideo").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"vimeo_video",attr:"title",el:this.$el.find(".ao-vimeovideo-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"vimeo_video",attr:"text",el:this.$el.find(".ao-vimeovideo-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.video=new AO.views.contentBlockVimeoVideo({el:this.$el.find(".ao-vimeovideo-source"),model:new AO.models.contentBlockVimeoVideo(this.model.videoData())}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.video.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e)},"delete":function(){var t=this;this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id"))},error:function(){}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}}),AO.views.contentBlocks.Soundcloudtrack=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-soundcloudtrack").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"soundcloud_track",attr:"title",el:this.$el.find(".ao-soundcloudtrack-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"soundcloud_track",attr:"text",el:this.$el.find(".ao-soundcloudtrack-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.video=new AO.views.contentBlockSoundcloudTrack({el:this.$el.find(".ao-soundcloudtrack-source"),model:new AO.models.contentBlockSoundcloudTrack(this.model.trackData())}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.video.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e),this.video.changeWidth(t)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}}),AO.views.contentBlocks.Mixcloudtrack=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-mixcloudtrack").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"mixcloud_track",attr:"title",el:this.$el.find(".ao-mixcloudtrack-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"mixcloud_track",attr:"text",el:this.$el.find(".ao-mixcloudtrack-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.video=new AO.views.contentBlockMixcloudTrack({el:this.$el.find(".ao-mixcloudtrack-source"),model:new AO.models.contentBlockMixcloudTrack(this.model.trackData())}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.video.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e),this.video.changeWidth(t)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}}),AO.views.contentBlocks.Bandcamptrack=Backbone.View.extend({events:{"click .ao-block-action-delete":"delete"},tagName:"div",className:"block-content",render:function(){var t=this.model.get("id"),e=_.template($("#content-bandcamptrack").html(),this.model.toJSON()),i=this.$el.attr("id");void 0==i&&this.$el.attr("id","page_block_"+this.model.get("id")),this.$el.html(e);var s=AO.modules.helpers.widthClass(this.model.get("width_id"));return this.$el.addClass(s),this.title=new AO.views.contentBlockText({name:"bandcamp_track",attr:"title",el:this.$el.find(".ao-bandcamptrack-title-container"),model:new AO.models.contentBlockTitle({id:t,width_id:this.model.get("width_id")})}),this.text=new AO.views.contentBlockText({name:"bandcamp_track",attr:"text",el:this.$el.find(".ao-bandcamptrack-text-container"),model:new AO.models.contentBlockText({id:t,width_id:this.model.get("width_id")})}),this.video=new AO.views.contentBlockBandcampTrack({el:this.$el.find(".ao-bandcamptrack-source"),model:new AO.models.contentBlockBandcampTrack(this.model.trackData())}),this.delete_block=this.$el.find(".ao-block-action-delete"),this.move_block=this.$el.find(".ao-block-action-move"),this.delete_loading=this.$el.find(".ao-block-action-loading"),this},showDeleteBlockLoading:function(){this.delete_block.addClass("hidden"),this.move_block.addClass("hidden"),this.delete_loading.removeClass("hidden")},hideDeleteBlockLoading:function(){this.delete_block.removeClass("hidden"),this.move_block.removeClass("hidden"),this.delete_loading.addClass("hidden")},destroyView:function(){this.title.destroyView(),this.text.destroyView(),this.video.destroyView(),this.undelegateEvents(),this.$el.removeData().unbind()},removeView:function(){this.remove(),Backbone.View.prototype.remove.call(this)},changeWidth:function(t){var e=AO.modules.helpers.widthClass(t),i=AO.modules.helpers.widthClass(this.model.get("width_id"));this.model.set("width_id",t),this.$el.removeClass(i).addClass(e),this.video.changeWidth(t)},"delete":function(){var t=this;this.showDeleteBlockLoading(),this.model.destroy({url:"/onepage/content_blocks/"+t.model.get("id"),success:function(){AO.core.events.trigger("content:row:after_delete_block:"+t.model.get("onepage_content_container_id"),t.model.get("id")),t.hideDeleteBlockLoading()},error:function(){t.hideDeleteBlockLoading()}})},textareaOff:function(){this.title.textareaOff(),this.text.textareaOff()},textareaOn:function(){this.title.textareaOn(),this.text.textareaOn()}})})();