(function(){AO.models.TopMenuItem=Backbone.Model.extend({defaults:{id:1,name:"Name",position:1,status:!0,asset:"#!/top-page",menu_type:"page"}}),AO.views.TopMenuItemsList=Backbone.View.extend({initialize:function(){var t=this;this.items={},this.$el.find("li.page-scroll").each(function(){var e=$(this).attr("data-menu-item-id");t.items[e]=new AO.views.TopMenuItem({el:$(this)}),t.items[e].init()}),AO.core.events.on("top_menu:add:new:item",$.proxy(this.addNewItem,this)),AO.core.events.on("top_menu:move:item",$.proxy(this.move,this))},addNewItem:function(t){var e=new AO.models.TopMenuItem(t);this.items[e.get("id")]=new AO.views.TopMenuItem({model:e}),this.$el.append(this.items[e.get("id")].render().el),this.items[e.get("id")].init(),AO.core.events.trigger("window:resize")},move:function(t,e,i){var s=null,n=null;this.$el.find("li.page-scroll").each(function(){var i=parseInt($(this).attr("data-menu-item-id"),10);e==i?n=$(this):t==i&&(s=$(this))}),s&&n&&(1==i?s.insertBefore(n):s.insertAfter(n)),AO.core.events.trigger("window:resize")}}),AO.views.TopMenuItem=Backbone.View.extend({tagName:"li",className:"page-scroll",initialize:function(){},init:function(){this.menuItemId=this.$el.attr("data-menu-item-id"),this.nameEl=this.$el.find("a"),AO.core.events.on("top_menu:item:edit:name:"+this.menuItemId,$.proxy(this.editName,this)),AO.core.events.on("top_menu:item:edit:url:"+this.menuItemId,$.proxy(this.editUrl,this)),AO.core.events.on("top_menu:item:move:"+this.menuItemId,$.proxy(this.moveItem,this)),AO.core.events.on("top_menu:item:hide:"+this.menuItemId,$.proxy(this.hideItem,this)),AO.core.events.on("top_menu:item:delete:"+this.menuItemId,$.proxy(this.deleteItem,this))},render:function(){this.$el.attr("data-menu-item-id",this.model.get("id"));var t=_.template($("#top_menu_item_template").html(),this.model.toJSON());return AO.tplId==3&&this.$el.addClass("menu-item scroll"),this.$el.html(t),AO.tplId==5&&this.$el.find("a").addClass("smoothScroll").prepend('<span class="glyphicon glyphicon-file"></span>'),this},editName:function(t){this.nameEl.contents().filter(function(){return this.nodeType==3}).each(function(){this.textContent=t}),AO.core.events.trigger("window:resize")},editUrl:function(t){this.nameEl.attr("href",t)},hideItem:function(){this.$el.is(":visible")?this.$el.hide():this.$el.removeClass("display_none").show(),AO.core.events.trigger("window:resize")},deleteItem:function(){this.undelegateEvents(),this.$el.removeData().unbind(),this.remove(),Backbone.View.prototype.remove.call(this),AO.core.events.trigger("window:resize")}}),AO.views.TopMenu=Backbone.View.extend({el:$("#top_menu"),initialize:function(){var t=this;this.moreLinkEl=this.$el.find("#top_menu_dropdown_more_link"),this.moreMenuEl=this.$el.find("#top_menu_dropdown_more_menu"),this.navbarMenuEl=this.$el.find("#top_menu_navbar"),this.ddMenuEl=this.$el.find("#top_menu_dropdown"),this.navbarMenuEl.find("li:visible:last").each(function(){$(this).offset().top>$(this).parent().offset().top&&(t.navbarMenuEl.addClass("more"),t.moreLinkEl.show())}),this.moreList=new AO.views.TopMenuItemsList({el:this.moreMenuEl}),this.navList=new AO.views.TopMenuItemsList({el:this.navbarMenuEl}),AO.core.events.on("window:resize",$.proxy(this.resize,this)),AO.core.events.on("menu:dropdown",$.proxy(this.dropdown,this)),this.ddMenuEl.on("show.bs.dropdown",function(){AO.core.events.trigger("menu:dropdown")}),$(window).on("resize",$.proxy(this.resize,this))},dropdown:function(){var t=this;t.moreMenuEl.find("li").addClass("hidden"),t.navbarMenuEl.find("li").each(function(){var e=$(this);e.offset().top>e.parent().offset().top&&t.moreMenuEl.find('li a[href="'+e.find(">a").attr("href")+'"]').parent().removeClass("hidden")})},resize:function(){var t=this;this.navbarMenuEl.removeClass("more"),this.moreLinkEl.hide(),this.navbarMenuEl.find("li:visible:last").each(function(){var e=$(this);e.offset().top>e.parent().offset().top&&(t.navbarMenuEl.addClass("more"),t.moreLinkEl.show())})}})})();