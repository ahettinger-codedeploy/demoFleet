(function(){AO.views.StylesEditor.Main=Backbone.View.extend({initialize:function(){this.menu=new AO.views.StylesEditorContentStyler({el:this.$el.find("#top_menu_style_editor"),model:new AO.models.ContentStyle({title:"Menu",name:"menu"}),show_sizer:!0,show_selecter:!0,style_for:"menu",sizer_attr:{val:18,max:26,min:16,step:1},sizerCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","menu-font-size",t),AO.core.events.trigger("window:resize")},selecterCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","menu-font-family",t),AO.core.events.trigger("window:resize")}}),this.heading=new AO.views.StylesEditorContentStyler({el:this.$el.find("#content_heading_style_editor"),model:new AO.models.ContentStyle({title:"Heading",name:"head"}),show_sizer:!0,show_selecter:!0,style_for:"head",sizer_attr:{val:36,max:40,min:20,step:1},sizerCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","head-font-size",t)},selecterCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","head-font-family",t)}}),this.title=new AO.views.StylesEditorContentStyler({el:this.$el.find("#content_title_style_editor"),model:new AO.models.ContentStyle({title:"Title",name:"title"}),show_sizer:!0,show_selecter:!0,style_for:"title",sizer_attr:{val:30,max:30,min:14,step:1},sizerCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","title-font-size",t)},selecterCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","title-font-family",t)}}),this.text=new AO.views.StylesEditorContentStyler({el:this.$el.find("#content_text_style_editor"),model:new AO.models.ContentStyle({title:"Text",name:"text"}),show_sizer:!0,show_selecter:!0,style_for:"text",sizer_attr:{val:14,max:20,min:8,step:1},sizerCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","text-font-size",t)},selecterCallback:function(t){AO.core.events.trigger("page_manager:section:set:font-style","text-font-family",t)}}),AO.core.events.trigger("page_manager:init:custom_styles")}}),AO.models.ContentStyle=Backbone.Model.extend({defaults:{title:"Title",name:"title",size:null,font:null},toTplJSON:function(){return _.clone(this.attributes)},toJSON:function(){var t=_.clone(this.attributes),e={configure:{}};return e.configure[t.name+"_size"]=t.size,e.configure[t.name+"_font"]=t.font,e}}),AO.views.StylesEditorContentStyler=Backbone.View.extend({events:{"click .ao-cse-action-save":"save","click .ao-cse-action-cancel":"cancel"},initialize:function(t){this.show_sizer=t.show_sizer||!1,this.show_selecter=t.show_selecter||!1,this.style_for=t.style_for||"text",this.sizer_attr=t.sizer_attr||{val:14,max:20,min:8,step:1},this.sizerCallback=t.sizerCallback||function(){},this.selecterCallback=t.selecterCallback||function(){},AO.core.events.on("style_editor:content_styler:set:"+this.style_for+":size",$.proxy(this.initSizeValue,this)),AO.core.events.on("style_editor:content_styler:set:"+this.style_for+":font",$.proxy(this.initFontValue,this)),this.sizer=null,this.selecter=null,this.saved_value={size:null,font:null},this.render()},render:function(){var t=this,e=_.template($("#content_style_editor").html(),this.model.toTplJSON());this.$el.html(e),this.actions=this.$el.find(".ao-cse-actions"),this.show_sizer&&(this.sizer=new AO.views.StylesEditor.Sizer({el:this.$el.find(".ao-size-selecter"),model:new AO.models.StyleEditorSizer(t.sizer_attr),callback:t.sizerCallback,callback2:$.proxy(t.sizerCallback2,t)}),this.saved_value.size=this.sizer.getValue()),this.show_selecter&&(this.selecter=new AO.views.StylesEditor.Selecter({el:this.$el.find(".ao-font-selecter"),model:new AO.models.StyleEditorSelecter({fonts:AO.fonts.text}),callback:t.selecterCallback,callback2:$.proxy(t.selecterCallback2,t)}),this.saved_value.font=this.selecter.getValue())},showActions:function(){this.actions.show()},hideActions:function(){this.actions.hide()},sizerCallback2:function(){this.showActions()},selecterCallback2:function(){this.showActions()},save:function(){var t=null,e=null,n=this;this.show_sizer&&(t=this.sizer.getValue()),this.show_selecter&&(e=this.selecter.getValue()),this.model.set({size:t,font:e}),this.model.save(null,{url:"/onepage/configures",success:function(){n.hideActions(),n.setSaved()},error:function(){}})},setSaved:function(){this.saved_value.size=this.model.get("size"),this.saved_value.font=this.model.get("font")},cancel:function(){this.show_sizer&&(this.sizer.setValue(this.saved_value.size),AO.core.events.trigger("page_manager:section:set:font-style",this.model.get("name")+"-font-size",this.saved_value.size)),this.show_selecter&&(this.selecter.setValue(this.saved_value.font),AO.core.events.trigger("page_manager:section:set:font-style",this.model.get("name")+"-font-family",this.saved_value.font)),this.hideActions()},initSizeValue:function(t){this.saved_value.size=t,this.sizer.setValue(t)},initFontValue:function(t){this.saved_value.font=t,this.selecter.setValue(t)}}),AO.models.StyleEditorSizer=Backbone.Model.extend({defaults:{label:"Font Size",val:14,max:100,min:1,step:1}}),AO.models.StyleEditorSelecter=Backbone.Model.extend({defaults:{fonts:[],val:"arial"}}),AO.views.StylesEditor.Sizer=Backbone.View.extend({rpt:200,label:"Sizer",val:null,interval:null,events:{"mousedown .sizer-next":"startUpStep","mousedown .sizer-prev":"startDownStep","mouseup .sizer-next":"stopUpStep","mouseout .sizer-next":"stopUpStep","mouseup .sizer-prev":"stopDownStep","mouseout .sizer-prev":"stopDownStep"},initialize:function(t){this.render(),this.callback=t.callback||function(){},this.callback2=t.callback2||function(){},this.val=this.$el.find(".sizer-value"),this.val.val(this.model.get("val"))},downStep:function(){var t=parseInt(this.val.val(),10)-parseInt(this.model.get("step"),10);this.validate(t)&&(this.model.set({val:t},{validate:!0}),this.val.val(t),this.callback(t),this.callback2(t))},upStep:function(){var t=parseInt(this.val.val(),10)+parseInt(this.model.get("step"),10);this.validate(t)&&(this.model.set({val:t},{validate:!0}),this.val.val(t),this.callback(t),this.callback2(t))},startDownStep:function(){var t=this;t.downStep(),this.interval=setInterval(function(){t.downStep()},this.rpt)},startUpStep:function(){var t=this;t.upStep(),this.interval=setInterval(function(){t.upStep()},this.rpt)},stopDownStep:function(){clearInterval(this.interval)},stopUpStep:function(){clearInterval(this.interval)},render:function(){var t=_.template($("#content_style_editor_sizer_template").html(),this.model.toJSON());this.$el.html(t)},validate:function(t){var e=!1,n=this.model.get("max"),i=this.model.get("min");return!isNaN(t)&&t>=i&&n>=t&&(e=!0),e},getValue:function(){return this.model.get("val")},setValue:function(t){this.model.set("val",t),this.val.val(t)}}),AO.views.StylesEditor.Selecter=Backbone.View.extend({label:"Font Family",val:null,events:{"change .selecter-value":"change"},initialize:function(t){this.callback=t.callback||function(){},this.callback2=t.callback2||function(){},this.render(),this.val=this.$el.find(".selecter-value")},change:function(t){var e=$(t.currentTarget),n=e.val();this.val.val(n),this.model.set("val",n),this.callback(n),this.callback2(n)},render:function(){var t=this,e={label:this.label,options:t.options1()},n=_.template($("#content_style_editor_selecter_template").html(),e);this.$el.html(n)},options1:function(){var t=this.model.get("fonts"),e=this.model.get("val"),n=!1,i="selected='selected'",o=t.length,s="",a=0;for(a=0;o>a;a++)t[a][1]==e&&(n=!1);for(n&&(t.push([e,e]),o=t.length),a=0;o>a;a++)s+='<option value="'+t[a][0]+'" '+(t[a][1]==e?i:"")+">"+t[a][1]+"</option>";return s},getValue:function(){return this.model.get("val")},setValue:function(t){this.model.set("val",t),this.val.val(t)}})})();