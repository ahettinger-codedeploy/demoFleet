(function(){AO.models.musics=Backbone.Model.extend({defaults:{cur_track:{},cur_num:0,cur_id:null}}),AO.views.pages.Musics=Backbone.View.extend({events:{"click #playlist ul li a.track-play":"playCurrent","click #jp_container_1 ul.jp-controls li a.jp-next":"playNext","click #jp_container_1 ul.jp-controls li a.jp-previous":"playPrev","click .ao-music-track-action .ao-music-track-action-edit":"editTrack","click .ao-music-track-action .ao-music-track-action-delete":"deleteTrack","click .ao-add-new-music-track-link":"showCreateForm"},initialize:function(){if(this.playlist=this.$el.find("#playlist ul"),this.tracksCount=this.playlist.find("li").length,this.tracksCount>0){var t=this.$el.find("#playlist ul li:first-child"),e={title:t.find(".name_song").text(),mp3:t.find(".mp_mp3").text()};this.model=new AO.models.musics({cur_track:e,cur_num:1})}else this.model=new AO.models.musics;this.model.on("change:cur_track",this.playTrack,this),this.playPause=$("#bg_musics"),this.render()},render:function(){var t="#jquery_jplayer_1",e=this,n={solution:"html, flash",swfPath:"/assets/onepage/bootstrap/share",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!1,toggleDuration:!0};return this.myAndroidFix=new jPlayerAndroidFix(t,e.model.get("cur_track"),n,$.proxy(this.playNext,this),this.playPause),this},playTrack:function(){var t=this.model.get("cur_track"),e=this.model.get("cur_id");this.myAndroidFix.setMedia(t).play(),this.playsIncrement(e)},playNext:function(){var t=this.model.get("cur_num")+1;t>this.tracksCount&&(t=1);var e=this.playlist.find(".song_"+t);e.addClass("active").siblings().removeClass("active");var n={title:e.find(".name_song").text(),mp3:e.find(".mp_mp3").text()};this.model.set({cur_track:n,cur_num:t,cur_id:e.attr("data-id")})},playPrev:function(){var t=this.model.get("cur_num")-1;1>t&&(t=this.tracksCount);var e=this.playlist.find(".song_"+t);e.addClass("active").siblings().removeClass("active");var n={title:e.find(".name_song").text(),mp3:e.find(".mp_mp3").text()};this.model.set({cur_track:n,cur_num:t,cur_id:e.attr("data-id")})},playCurrent:function(t){var e=$(t.currentTarget),n=e.parents("li");n.addClass("active").siblings().removeClass("active");var i={title:n.find(".name_song").text(),mp3:n.find(".mp_mp3").text()},o=n.attr("data-num")-0;this.model.set({cur_track:i,cur_num:o,cur_id:n.attr("data-id")})},playsIncrement:function(t){return $.ajax({type:"GET",url:"/plays_increment?music_id="+t+"&hash="+Math.random(),success:function(){},error:function(){}}),1}})})();