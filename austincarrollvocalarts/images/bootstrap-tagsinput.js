!function(t){"use strict";function e(e,i){this.itemsArray=[],this.$element=t(e),this.$element.hide(),this.isSelect="SELECT"===e.tagName,this.multiple=this.isSelect&&e.hasAttribute("multiple"),this.objectItems=i&&i.itemValue,this.placeholderText=e.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=t('<div class="bootstrap-tagsinput"></div>'),this.$input=t('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var s=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+s+" !important;",this.build(i)}function i(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(t){return t[i]}}}function s(t,e){if("function"!=typeof t[e]){var i=t[e];t[e]=function(){return i}}}function a(t){return t?l.text(t).html():""}function o(t){var e=0;if(document.selection){t.focus();var i=document.selection.createRange();i.moveStart("character",-t.value.length),e=i.text.length}else(t.selectionStart||"0"==t.selectionStart)&&(e=t.selectionStart);return e}function n(e,i){var s=!1;return t.each(i,function(t,i){if("number"==typeof i&&e.which===i)return s=!0,!1;if(e.which===i.which){var a=!i.hasOwnProperty("altKey")||e.altKey===i.altKey,o=!i.hasOwnProperty("shiftKey")||e.shiftKey===i.shiftKey,n=!i.hasOwnProperty("ctrlKey")||e.ctrlKey===i.ctrlKey;if(a&&o&&n)return s=!0,!1}}),s}var r={tagClass:function(){return"label label-info"},itemValue:function(t){return t?t.toString():t},itemText:function(t){return this.itemValue(t)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(t,e){e.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};e.prototype={constructor:e,add:function(e,i){var s=this;if(!(s.options.maxTags&&s.itemsArray.length>=s.options.maxTags||e!==!1&&!e)){if("string"==typeof e&&s.options.trimValue&&(e=t.trim(e)),"object"==typeof e&&!s.objectItems)throw"Can't add objects when itemValue option is not set";if(!e.toString().match(/^\s*$/)){if(s.isSelect&&!s.multiple&&s.itemsArray.length>0&&s.remove(s.itemsArray[0]),"string"==typeof e&&"INPUT"===this.$element[0].tagName){var o=e.split(",");if(o.length>1){for(var n=0;n<o.length;n++)this.add(o[n],!0);return void(i||s.pushVal())}}var r=s.options.itemValue(e),l=s.options.itemText(e),h=s.options.tagClass(e),c=t.grep(s.itemsArray,function(t){return s.options.itemValue(t)===r})[0];if(!c||s.options.allowDuplicates){if(!(s.items().toString().length+e.length+1>s.options.maxInputLength)){var u=t.Event("beforeItemAdd",{item:e,cancel:!1});if(s.$element.trigger(u),!u.cancel){s.itemsArray.push(e);var d=t('<span class="tag '+a(h)+'">'+a(l)+'<span data-role="remove"></span></span>');if(d.data("item",e),s.findInputWrapper().before(d),d.after(" "),s.isSelect&&!t('option[value="'+encodeURIComponent(r)+'"]',s.$element)[0]){var p=t("<option selected>"+a(l)+"</option>");p.data("item",e),p.attr("value",r),s.$element.append(p)}i||s.pushVal(),(s.options.maxTags===s.itemsArray.length||s.items().toString().length===s.options.maxInputLength)&&s.$container.addClass("bootstrap-tagsinput-max"),s.$element.trigger(t.Event("itemAdded",{item:e}))}}}else if(s.options.onTagExists){var f=t(".tag",s.$container).filter(function(){return t(this).data("item")===c});s.options.onTagExists(e,f)}}}},remove:function(e,i){var s=this;if(s.objectItems&&(e="object"==typeof e?t.grep(s.itemsArray,function(t){return s.options.itemValue(t)==s.options.itemValue(e)}):t.grep(s.itemsArray,function(t){return s.options.itemValue(t)==e}),e=e[e.length-1]),e){var a=t.Event("beforeItemRemove",{item:e,cancel:!1});if(s.$element.trigger(a),a.cancel)return;t(".tag",s.$container).filter(function(){return t(this).data("item")===e}).remove(),t("option",s.$element).filter(function(){return t(this).data("item")===e}).remove(),-1!==t.inArray(e,s.itemsArray)&&s.itemsArray.splice(t.inArray(e,s.itemsArray),1)}i||s.pushVal(),s.options.maxTags>s.itemsArray.length&&s.$container.removeClass("bootstrap-tagsinput-max"),s.$element.trigger(t.Event("itemRemoved",{item:e}))},removeAll:function(){var e=this;for(t(".tag",e.$container).remove(),t("option",e.$element).remove();e.itemsArray.length>0;)e.itemsArray.pop();e.pushVal()},refresh:function(){var e=this;t(".tag",e.$container).each(function(){var i=t(this),s=i.data("item"),o=e.options.itemValue(s),n=e.options.itemText(s),r=e.options.tagClass(s);if(i.attr("class",null),i.addClass("tag "+a(r)),i.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=a(n),e.isSelect){var l=t("option",e.$element).filter(function(){return t(this).data("item")===s});l.attr("value",o)}})},items:function(){return this.itemsArray},pushVal:function(){var e=this,i=t.map(e.items(),function(t){return e.options.itemValue(t).toString()});e.$element.val(i,!0).trigger("change")},build:function(e){var a=this;if(a.options=t.extend({},r,e),a.objectItems&&(a.options.freeInput=!1),i(a.options,"itemValue"),i(a.options,"itemText"),s(a.options,"tagClass"),a.options.typeahead){var l=a.options.typeahead||{};s(l,"source"),a.$input.typeahead(t.extend({},l,{source:function(e,i){function s(t){for(var e=[],s=0;s<t.length;s++){var n=a.options.itemText(t[s]);o[n]=t[s],e.push(n)}i(e)}this.map={};var o=this.map,n=l.source(e);t.isFunction(n.success)?n.success(s):t.isFunction(n.then)?n.then(s):t.when(n).then(s)},updater:function(t){a.add(this.map[t])},matcher:function(t){return-1!==t.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(t){return t.sort()},highlighter:function(t){var e=new RegExp("("+this.query+")","gi");return t.replace(e,"<strong>$1</strong>")}}))}if(a.options.typeaheadjs){var h=a.options.typeaheadjs||{};a.$input.typeahead(null,h).on("typeahead:selected",t.proxy(function(t,e){a.add(h.valueKey?e[h.valueKey]:e),a.$input.typeahead("val","")},a))}a.$container.on("click",t.proxy(function(){a.$element.attr("disabled")||a.$input.removeAttr("disabled"),a.$input.focus()},a)),a.options.addOnBlur&&a.options.freeInput&&a.$input.on("focusout",t.proxy(function(){0===t(".typeahead, .twitter-typeahead",a.$container).length&&(a.add(a.$input.val()),a.$input.val(""))},a)),a.$container.on("keydown","input",t.proxy(function(e){var i=t(e.target),s=a.findInputWrapper();if(a.$element.attr("disabled"))return void a.$input.attr("disabled","disabled");switch(e.which){case 8:if(0===o(i[0])){var n=s.prev();n&&a.remove(n.data("item"))}break;case 46:if(0===o(i[0])){var r=s.next();r&&a.remove(r.data("item"))}break;case 37:var l=s.prev();0===i.val().length&&l[0]&&(l.before(s),i.focus());break;case 39:var h=s.next();0===i.val().length&&h[0]&&(h.after(s),i.focus())}var c=i.val().length;Math.ceil(c/5),i.attr("size",Math.max(this.inputSize,i.val().length))},a)),a.$container.on("keypress","input",t.proxy(function(e){var i=t(e.target);if(a.$element.attr("disabled"))return void a.$input.attr("disabled","disabled");var s=i.val(),o=a.options.maxChars&&s.length>=a.options.maxChars;a.options.freeInput&&(n(e,a.options.confirmKeys)||o)&&(a.add(o?s.substr(0,a.options.maxChars):s),i.val(""),e.preventDefault());var r=i.val().length;Math.ceil(r/5),i.attr("size",Math.max(this.inputSize,i.val().length))},a)),a.$container.on("click","[data-role=remove]",t.proxy(function(e){a.$element.attr("disabled")||a.remove(t(e.target).closest(".tag").data("item"))},a)),a.options.itemValue===r.itemValue&&("INPUT"===a.$element[0].tagName?a.add(a.$element.val()):t("option",a.$element).each(function(){a.add(t(this).attr("value"),!0)}))},destroy:function(){var t=this;t.$container.off("keypress","input"),t.$container.off("click","[role=remove]"),t.$container.remove(),t.$element.removeData("tagsinput"),t.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var e=this.$input[0],i=this.$container[0];e&&e.parentNode!==i;)e=e.parentNode;return t(e)}},t.fn.tagsinput=function(i,s){var a=[];return this.each(function(){var o=t(this).data("tagsinput");if(o)if(i||s){if(void 0!==o[i]){var n=o[i](s);void 0!==n&&a.push(n)}}else a.push(o);else o=new e(this,i),t(this).data("tagsinput",o),a.push(o),"SELECT"===this.tagName&&t("option",t(this)).attr("selected","selected"),t(this).val(t(this).val())}),"string"==typeof i?a.length>1?a:a[0]:a},t.fn.tagsinput.Constructor=e;var l=t("<div />");t(function(){t("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);