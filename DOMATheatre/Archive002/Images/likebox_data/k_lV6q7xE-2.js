/*1330319010,169776321*/

if (window.CavalryLogger) { CavalryLogger.start_js(["lNjIe"]); }

__e("PhotoTagApproval",["array-extensions","event-extensions","Arbiter","css","copyProperties","DOM","Parent","PhotosConst","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('css'),i=b('copyProperties'),j=b('DOM'),k=b('Parent'),l=b('PhotosConst'),m=b('ge');function n(o){if(o===l.VIEWER_SNOWLIFT){o=a.PhotoSnowlift&&a.PhotoSnowlift.getInstance();}else if(o===l.VIEWER_PERMALINK)o=a.PhotoPermalink&&a.PhotoPermalink.getInstance();this.viewer=o;this.units=[];this.currentUnit=0;var p=o.getVersionConst();if(p==l.VIEWER_SNOWLIFT){this._root=m('fbPhotoSnowliftTagApproval');}else this._root=m('fbPhotoPageTagApproval');g.subscribe(o.getEventString('DATA_CHANGE'),this.restartTagApproval.bind(this));Event.listen(this._root,'click',this.handleClick.bind(this));Event.listen(this._root,'mousemove',function(q){this.hiliteCurrentPendingTag();Event.kill(q);}.bind(this));this.restartTagApproval();}i(n.prototype,{handleClick:function(event){var o=event.getTarget();if(h.hasClass(o,'nextPager')&&h.hasClass(o,'enabled')){this.showNextUnit();}else if(h.hasClass(o,'prevPager')&&h.hasClass(o,'enabled')){this.showPrevUnit();}else if(k.byClass(o,'fbPhotoApprovalPendingButtons')){var p=this.units[this.currentUnit],q=this.getTagNameID(p);if(q){var r=k.byClass(o,'approve');g.inform('PhotoTagApproval.UPDATE_TAG_BOX',{id:q,approve:r,version:this.viewer.getVersionConst()});}this.removeSelectedUnit.bind(this).defer();}return true;},loadUnits:function(o){this.units=j.scry(this._root,'div.fbPhotoApprovalUnit');if(this.units.length){h.show(this._root);this.showUnit(o);h.conditionClass(this._root,'hidePagers',this.units.length==1);}else{h.hide(this._root);g.inform('PhotoTagApproval.HILITE_TAG',{tag:null,version:this.viewer.getVersionConst()});}},restartTagApproval:function(){this.loadUnits(0);},removeSelectedUnit:function(){var o=this.units[this.currentUnit];j.remove(o);this.loadUnits(this.currentUnit);},showNextUnit:function(){this.showUnit(this.currentUnit+1);},showPrevUnit:function(){this.showUnit(this.currentUnit-1);},getTagNameID:function(o){var p=o.id.indexOf(':');return o.id.slice(p+1);},showUnit:function(o){this.units.forEach(h.hide);this.currentUnit=(o+this.units.length)%this.units.length;var p=this.units[this.currentUnit];h.show(p);this.hiliteCurrentPendingTag();h.conditionClass(j.find(this._root,'a.prevPager'),'enabled',this.currentUnit>0);h.conditionClass(j.find(this._root,'a.nextPager'),'enabled',this.currentUnit<this.units.length-1);},hiliteCurrentPendingTag:function(){var o=this.units[this.currentUnit],p=this.getTagNameID(o);g.inform('PhotoTagApproval.HILITE_TAG',{tag:p,version:this.viewer.getVersionConst()});}});e.exports=n;});
__e("WebSearchDataSource",["Class","SearchDataSource","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('SearchDataSource'),i=b('copyProperties');function j(k){this.parent.construct(this,k);}g.extend(j,h);i(j.prototype,{shouldFetchMoreResults:function(k){var l=[],m=k.length;for(var n=0;n<m;++n)if(k[n].type!='web')l.push(k[n]);return this.parent.shouldFetchMoreResults(l);},filterQueryResults:function(k,l){return this.parent.filterQueryResults(k,l.filter(function(m){return m.indexOf('web')==-1;}));}});e.exports=j;});