/*1330508666,169775559*/

if (window.CavalryLogger) { CavalryLogger.start_js(["J8KDE"]); }

var FriendListMenu={init:function(a){Menu.register(a,false);var b=DOM.find(a,'.FriendListCreateTrigger'),c=DOM.find(a,'.CreateListInputItem'),d=DOM.find(c,'.createListInput');Menu.subscribe('select',function(e,f){if(f.item==b){CSS.addClass(a,'FriendListMenuCreate');Input.focus(d);}});Event.listen(d,'blur',function(e){if(Input.isEmpty(d))CSS.removeClass(a,'FriendListMenuCreate');});Event.listen(d,'keydown',function(e){if(Event.getKeyCode(e)==KEYS.RETURN&&/[^\s]/.test(d.value))new AsyncRequest().setURI('/ajax/friends/lists/create.php').setData({name:d.value,id:a.id}).setHandler(function(){Input.reset(d);CSS.removeClass(a,'FriendListMenuCreate');}).send();});Arbiter.subscribe('friend-list/new',function(e,f){var g=HTML(f.new_li).getRootNode();DOM.insertBefore(g,b);var h=DOM.find(g,'input');if(f.id===a.id){Menu.focusItem(g);Menu.inform('select',{menu:Parent.byClass(g,'uiMenu'),item:g});}else Menu.toggleItem(g);});}};
var RestrictedFriendListEducation=(function(){var a,b;function c(d,e){if(e.flid==a)if(d=='FriendListHovercard/add'){if(b)return;b=true;new AsyncRequest().setURI('/ajax/friends/lists/restricted_edu.php').setData({target:e.uid,flid:e.flid}).send();}else if(d=='RestrictedListNUX/okay')new AsyncRequest().setURI('/ajax/friends/lists/nux_log.php').setData(e).send();return true;}return {init:function(d){a=d;Arbiter.subscribe(['FriendListHovercard/add','RestrictedListNUX/okay'],c);}};})();
__e("Token",["css-core","DataStore","DOM","copyProperties","tx"],function(a,b,c,d,e,f){var g=b("css-core"),h=b("DataStore"),i=b("DOM"),j=b("copyProperties"),k=b("tx");function l(m,n){this.info=m;this.paramName=n;}j(l.prototype,{getInfo:function(){return this.info;},getText:function(){return this.info.text;},getValue:function(){return this.info.uid;},isFreeform:function(){return !!this.info.freeform;},getElement:function(){if(!this.element)this.setElement(this.createElement());return this.element;},setElement:function(m){h.set(m,'Token',this);this.element=m;return this;},isRemovable:function(){return g.hasClass(this.element,'removable');},createElement:function(){var m=this.paramName,n=this.getText(),o=this.getValue(),p=i.$N('a',{href:'#',title:k._("Remove {item}",{item:n}),className:'remove uiCloseButton uiCloseButtonSmall'}),q=i.$N('input',{type:'hidden',value:o,name:m+'[]',autocomplete:'off'}),r=i.$N('input',{type:'hidden',value:n,name:'text_'+m+'[]',autocomplete:'off'}),s=i.$N('span',{title:n,className:'removable uiToken'},[n,q,r,p]);return s;}});e.exports=l;});
__e("Tokenizer",["array-extensions","event-extensions","ArbiterMixin","Class","css","DataStore","DOM","Input","Keys","ObjectUtils","Parent","Token","ua","copyProperties"],function(a,b,c,d,e,f){b("array-extensions");b("event-extensions");var g=b("ArbiterMixin"),h=b("Class"),i=b("css"),j=b("DataStore"),k=b("DOM"),l=b("Input"),m=b("Keys"),n=b("ObjectUtils"),o=b("Parent"),p=b("Token"),q=b("ua"),r=b("copyProperties");function s(t,u){this.element=t;this.typeahead=u;this.input=u.getCore().getElement();j.set(this.element,'Tokenizer',this);}s.getInstance=function(t){var u=o.byClass(t,'uiTokenizer');return u?j.get(u,'Tokenizer'):null;};h.mixin(s,g,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(t,u,v,w){this.init=bagofholding;this.tokenarea=t;this.paramName=u;this.placeholder=this.input.getAttribute('data-placeholder')||'';r(this,w||{});this.initEvents();this.initTypeahead();this.reset(v);this.initBehaviors();Arbiter.inform('Tokenizer/init',this,Arbiter.BEHAVIOR_PERSISTENT);},reset:function(t){this.tokens=[];this.unique={};if(t){this.populate(t);}else k.empty(this.tokenarea);this.updateTokenarea();},populate:function(t){var u=[];this.tokens=this.getTokenElements().map(function(v,w){var x=t[w];u.push(this._tokenKey(x));return this.createToken(x,v);},this);this.unique=n.createFrom(u,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){for(var t in (this.behaviors||{})){var u=window.TokenizerBehaviors&&TokenizerBehaviors[t];u.call(null,this,this.behaviors[t]);}},initTypeahead:function(){var t=this.typeahead.getCore();t.resetOnSelect=true;t.setValueOnSelect=false;t.preventFocusChangeOnTab=true;if(this.inline){var u=this.typeahead.getView();i.addClass(u.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(v,w){var x=w.selected;if('uid' in x){this.updateInput();this.addToken(this.createToken(x));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var t=this.handleEvents.bind(this),u=q.firefox()<4?'keypress':'keydown';Event.listen(this.tokenarea,{click:t,keydown:t});Event.listen(this.input,'paste',this.paste.bind(this));Event.listen(this.input,u,this.keydown.bind(this));},handleEvents:function(event){var t=event.getTarget(),u=t&&this.getTokenElementFromTarget(t);if(!u)return;if(event.type!='keydown'||Event.getKeyCode(event)==m.RETURN)this.processEvents(event,t,u);},processEvents:function(event,t,u){if(o.byClass(t,'remove')){var v=u.nextSibling;v=v&&k.scry(u.nextSibling,'.remove')[0];var w=this.getTokenFromElement(u);w=this.addTokenData(w,t);this.removeToken(w);this.focusOnTokenRemoval(event,v);event.kill();}},focusOnTokenRemoval:function(event,t){l.focus(event.type=='keydown'&&t||this.input);},addTokenData:function(t,u){return t;},keydown:function(event){this.inform('keydown',{event:event});var t=Event.getKeyCode(event),u=this.input;if(this.inline&&t==m.BACKSPACE&&l.isEmpty(u)){var v=this.getLastToken();if(v&&v.isRemovable())this.removeToken(v);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){l.focus(this.input);},updateInput:function(t){if(!this.inline)return;var u=this.input;setTimeout(function(){u.size=u.value.length||1;if(t)u.value=u.value;},20);},updatePlaceholder:function(){if(!this.inline||this.stickyPlaceholder)return;var t=!this.tokens.length;this.input.size=t?this.placeholder.length*2||1:1;l.setPlaceholder(this.input,t?this.placeholder:'');},getToken:function(t){return this.unique[t]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return k.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(t){return o.byClass(t,'uiToken');},getTokenFromElement:function(t){return j.get(t,'Token');},getTokenValues:function(){return this.tokens.map(function(t){return t.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(t,u){var v=this.getToken(this._tokenKey(t));v=v||new p(t,this.paramName);u&&v.setElement(u);return v;},addToken:function(t){if(this.hasMaxTokens())return;var u=this._tokenKey(t.getInfo());if(u in this.unique)return;this.unique[u]=t;this.tokens.push(t);this.insertToken(t);this.updateTokenarea();this.inform('addToken',t);Arbiter.inform('Form/change',{node:this.element});},insertToken:function(t){k.appendContent(this.tokenarea,t.getElement());},removeToken:function(t){if(!t)return;var u=this.tokens.indexOf(t);if(u<0)return;this.tokens.splice(this.tokens.indexOf(t),1);delete this.unique[this._tokenKey(t.getInfo())];k.remove(t.getElement());this.updateTokenarea();this.inform('removeToken',t);Arbiter.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var t=this.typeahead.getCore(),u=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=t.getExclusions());t.setExclusions(u.concat(this._exclusions));}t.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();},updateTokenareaVisibility:function(){i.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(t){return t.uid+(t.freeform?':':'');}});e.exports=s;});
__e("Photocrop2",["array-extensions","event-extensions","css","DOM","Vector","copyProperties"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('css'),h=b('DOM'),i=b('Vector'),j=b('copyProperties');function k(l,m){this.photo=l;j(this,j({target:this.photo.parentNode,width:200,height:200,min_width:100,min_height:100,center_x:(this.photo.offsetWidth||200)/2,center_y:(this.photo.offsetHeight||200)/2},m));var n=this.center_x-this.width/2,o=this.center_y-this.height/2;this.box=[o,n+this.width,o+this.height,n];g.addClass(this.target,'photocrop');['bg','wrapper','viewport'].forEach(function(p){this[p]=h.create('div');g.addClass(this[p],p);}.bind(this));this.highlight=h.create('img',{src:l.src});g.addClass(this.highlight,'highlight');this.target.appendChild(this.bg);this.target.appendChild(this.wrapper);this.wrapper.appendChild(this.highlight);this.wrapper.appendChild(this.viewport);['ne','nw','sw','se'].forEach(function(p){var q=h.create('div');g.addClass(q,p);this.viewport.appendChild(q);}.bind(this));Event.listen(this.viewport,{mousedown:this.mousedown.bind(this),dragstart:Event.kill,selectstart:Event.kill,click:Event.stop});Event.listen(document,{mousemove:this.mousemove.bind(this),mouseup:this.mouseup.bind(this)});[this.bg,this.wrapper].forEach(function(p){p.style.width=l.offsetWidth+'px';p.style.height=l.offsetHeight+'px';p.style.top=l.offsetTop+'px';p.style.left=l.offsetLeft+'px';});this.redraw();}k.prototype.redraw=function(){this.highlight.style.clip="rect("+this.box.join("px ")+"px)";this.viewport.style.top=this.box[0]+"px";this.viewport.style.left=this.box[3]+"px";this.viewport.style.height=(this.box[2]-this.box[0])+"px";this.viewport.style.width=(this.box[1]-this.box[3])+"px";};k.prototype.done=function(){[this.bg,this.wrapper].forEach(h.remove);g.removeClass(this.target,'photocrop');var l=this.box.map(Math.round);return {x:Math.max(l[3],0),y:Math.max(l[0],0),width:l[1]-Math.max(l[3],0),height:l[2]-Math.max(l[0],0)};};k.prototype.mousedown=function(l){this.mouseTarget=l.getTarget();this.pos=i.getEventPosition(l);g.addClass(document.body,'draggingMode');return false;};k.prototype.mousemove=function(l){if(!this.mouseTarget)return;var m=i.getEventPosition(l).sub(this.pos);function n(t,u,v){return Math.max(t,Math.min(v,u));}var o=this.box,p=this.min_width,q=this.min_height,r=this.wrapper.offsetWidth,s=this.wrapper.offsetHeight;if(this.mouseTarget==this.viewport){m.x=n(-o[3],m.x,r-o[1]);m.y=n(-o[0],m.y,s-o[2]);o[0]+=m.y;o[1]+=m.x;o[2]+=m.y;o[3]+=m.x;}else if(g.hasClass(this.mouseTarget,'ne')){o[1]+=m.x=n(o[3]+p-o[1],m.x,r-o[1]);o[0]+=m.y=n(-o[0],m.y,o[2]-q-o[0]);}else if(g.hasClass(this.mouseTarget,'nw')){o[3]+=m.x=n(-o[3],m.x,o[1]-p-o[3]);o[0]+=m.y=n(-o[0],m.y,o[2]-q-o[0]);}else if(g.hasClass(this.mouseTarget,'se')){o[1]+=m.x=n(o[3]+p-o[1],m.x,r-o[1]);o[2]+=m.y=n(o[0]+q-o[2],m.y,s-o[2]);}else if(g.hasClass(this.mouseTarget,'sw')){o[3]+=m.x=n(-o[3],m.x,o[1]-p-o[3]);o[2]+=m.y=n(o[0]+q-o[2],m.y,s-o[2]);}this.redraw();this.pos=this.pos.add(m);return false;};k.prototype.mouseup=function(l){this.mouseTarget=null;g.removeClass(document.body,'draggingMode');};e.exports=k;});
__e("PhotosTaggingWaterfall",["AsyncSignal","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncSignal'),h=b('copyProperties');function i(j){i._queueName=j||i._queueName;}h(i,{BEGIN:"begin",TAG_FACE:"tag_face",ADD_NAME:"add_name",TAG_CONFIRMED:"tag_confirmed",FINISH:"finish",TYPE_NAME:'type_name',SELECT_NAME:'select_name',_queueName:null,sendSignal:function(j,k){new g('/ajax/photos/tag_waterfall.php',{data:JSON.stringify(j)}).setHandler(k).send();}});e.exports=i;});
__e("PhotoPermalink",["array-extensions","event-extensions","function-extensions","Arbiter","ArrayUtils","AsyncRequest","bootloader","css","Class","DOM","KeyEventController","Keys","PageTransitions","Parent","PhotosConst","PhotoSessionLog","PhotoStreamCache","PhotoViewer","PhotosUtils","ua","Vector","$","copyProperties","ge","goURI"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArrayUtils'),i=b('AsyncRequest'),j=b('bootloader'),k=b('css'),l=b('Class'),m=b('DOM'),n=b('KeyEventController'),o=b('Keys'),p=b('PageTransitions'),q=b('Parent'),r=b('PhotosConst'),s=b('PhotoSessionLog'),t=b('PhotoStreamCache'),u=b('PhotoViewer'),v=b('PhotosUtils'),w=b('ua'),x=b('Vector'),y=b('$'),z=b('copyProperties'),aa=b('ge'),ba=b('goURI');function ca(){this.parent.construct(this);}z(ca,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_DATA:'image',MIN_TAG_DISTANCE:80,_instance:null,getInstance:function(){if(!ca._instance)ca._instance=new ca();return ca._instance;},addPhotoFbids:function(da,ea,fa){ca.getInstance().addPhotoFbids(da,ea,fa);},saveTagsFromPayload:function(da){ca.getInstance().saveTagsFromPayload(da);},setErrorBoxContent:function(da){ca.getInstance().setErrorBoxContent(da);},storeFromData:function(da){ca.getInstance().storeFromData(da);},swapData:function(){ca.getInstance().swapData();},updateTotalCount:function(da,ea,fa){ca.getInstance().updateTotalCount(da,ea,fa);}});l.extend(ca,u);z(ca.prototype,{init:function(){this.stream=new t();this.stream.init(r.VIEWER_PERMALINK);this.reset();this.root=y('fbPhotoPageContainer');this.header=y('fbPhotoPageHeader');this.stageWrapper=aa('photoborder');this.videoStage=m.find(this.stageWrapper,'div.videoStage');this.buttonActions=m.find(this.root,'div.stageButtons');this.feedback=aa('fbPhotoPageFeedback');this.image=aa('fbPhotoImage');this.errorBox=aa('fbPhotoPageError');this.actionList=aa('fbPhotoPageActions');this.loadingStates={image:false,html:false};this.unhiliteTimer=null;this.pageHandlers=[Event.listen(this.root,'mouseout',this.mouseOutListener.bind(this)),Event.listen(this.root,'mousemove',this.mouseMoveListener.bind(this)),Event.listen(this.stageWrapper,'click',this.stageClickListener.bind(this)),Event.listen(this.stageWrapper,'dragstart',this.killDrag.bind(this)),Event.listen(this.stageWrapper,'selectstart',this.killDrag.bind(this)),Event.listen(this.buttonActions,'click',this.buttonListener.bind(this)),Event.listen(this.actionList,'click',this.rotateListener.bind(this)),Event.listen(this.feedback,'click',function(event){if(q.byClass(event.getTarget(),'like_link'))k.toggleClass(m.find(this.buttonActions,'div.likeCommentGroup'),'viewerLikesThis');}.bind(this))];p.registerHandler(this.transitionHandler.bind(this));n.registerKey('LEFT',this.goNav.bind(this));n.registerKey('RIGHT',this.goNav.bind(this));s.initLogging(s.PERMALINK);g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));},getEventPrefix:function(){return 'PhotoPermalink';},getSourceString:function(){return 'permalink';},getVersionConst:function(){return r.VIEWER_PERMALINK;},saveTagComplete:function(da){this.saveTagsFromPayload(da.getPayload());},saveTagsFromPayload:function(da){this.storeFromData(da);if('data' in da&&this.stream.getCursor() in da.data)this.swapData();},goNav:function(event){var da=Event.getKeyCode(event)||event.getTarget();if(this.theaterModeOn())return true;var ea=event.type==='click'&&q.byClass(da,'stageWrapper')&&!q.byClass(da,'tagBoxPending')&&!q.byClass(da,'tagBoxPendingResponse');if(ea&&k.hasClass(this.root,'taggingMode'))return false;if(da==o.LEFT){this.page(-1);}else if(da==o.RIGHT||ea)this.page(1);return false;},theaterModeOn:function(){return k.hasClass(document.documentElement,'theaterMode');},pagerClick:function(da){if(this.theaterModeOn())return true;if(da=='prev'){this.page(-1);}else if(da=='next')this.page(1);return false;},setLoadingState:function(da,ea){switch(da){case ca.STATE_IMAGE_DATA:this.loadingStates[da]=ea;k.conditionClass(this.root,'imageLoading',ea);break;case ca.STATE_HTML:this.loadingStates[da]=ea;k.conditionClass(this.root,'dataLoading',ea);break;}},checkState:function(da){if(da!=ca.STATE_ERROR&&!this.loadingStates[da])return;switch(da){case ca.STATE_IMAGE_DATA:var ea=this.stream.getCurrentImageData();if(ea){if(ea.url){this.switchImage(ea.url,true);}else if(ea.video)this.switchVideo(ea.video,true);this.setLoadingState(da,false);}break;case ca.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(da,false);}break;default:if(this.stream.errorInCurrent()){k.hide(this.image);k.show(this.errorBox);}break;}},reHilitePendingTag:function(){var da=aa(this.hilitedTag);if(da&&k.hasClass(da,'showPendingTagName'))return;var ea=m.scry(this.root,'div.tagsWrapper div.showPendingTagName')[0];if(ea)this.switchHilitedTags(ea.id);},page:function(da){if(!this.stream.isValidMovement(da))return;this.unhiliteAllTags();var ea=this.getVideoOnStage();if(ea)this.switchVideo(ea,false);g.inform('PhotoPermalink.PAGE');this.recacheData();this.stream.moveCursor(da);k.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(ca.STATE_HTML,true);k.show(this.errorBox);}else{var fa=this.stream.getCurrentImageData();if(fa){if(fa.url){this.switchImage(fa.url,true);}else if(fa.video)this.switchVideo(fa.video,true);ba(fa.info.permalink);}else{this.waitForLoadCount++;this.setLoadingState(ca.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(ca.STATE_HTML,true);}},transitionHandler:function(da){if(da.getPath()=='/photo.php')if(da.getQueryData().permPage){p.transitionComplete();return true;}else if(!this.theaterModeOn()&&da.getQueryData().makeprofile&&da.getQueryData().fbid==this.stream.getCursor()&&!this.getVideoOnStage()){j.loadModules(['PhotoCropper'],function(ea){ea.start();});p.transitionComplete();return true;}},recacheData:function(da){if(!this.loadingStates.html){var ea=this.stream.getCurrentHtml();for(var fa in ea){ea[fa]=h.createFrom(y(fa).childNodes);if(da!==true&&fa!=='fbPhotoPageHeader')m.empty(y(fa));}}},getCurrentPhotoInfo:function(){var da=this.stream.getCurrentImageData();return da&&da.info;},getVideoOnStage:function(){var da=this.stream.getCurrentImageData();return da&&da.video;},switchImage:function(da,ea){k.hide(this.image);k.hide(this.errorBox);var fa=this.stream&&this.stream.getCurrentImageData();if(fa)s.addPhotoView(fa.info);var ga=m.create('img',{id:'fbPhotoImage',className:'fbPhotoImage',alt:'',src:da});m.replace(this.image,ga);this.image=ga;if(ea)this.stream.preloadImages();},switchVideo:function(da,ea){var fa='swf_'+da;if(ea){k.addClass(this.stageWrapper,'showVideo');this.videoStage.id=da;if(window[fa]&&!aa(fa))window[fa].write(da);}else{this.videoStage.id='fbPageVideoStage';window[fa].addVariable('video_autoplay',0);m.empty(this.videoStage);k.removeClass(this.stageWrapper,'showVideo');}},swapData:function(){if(this.dataLoadTimer){this.setLoadingState(ca.STATE_HTML,true);clearTimeout(this.dataLoadTimer);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,true),100);return;}var da,ea=this.stream.getCurrentHtml();if(ea){for(var fa in ea){da=aa(fa);da&&m.setContent(da,ea[fa]);}g.inform('PhotoPermalink.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);this.position=this.stream.getCursor();this.setLoadingState(ca.STATE_HTML,false);this.dataLoadTimer=setTimeout(this.clearTimer.bind(this,false),100);}this.adjustForNewData();},clearTimer:function(da){this.dataLoadTimer=false;da&&this.swapData();},adjustForNewData:function(){if(!this.image)return;var da=m.scry(this.stageWrapper,'div.tagsWrapper')[0],ea=x.getElementDimensions(this.image);if(da){k.setStyle(da,'width',ea.x+'px');k.setStyle(da,'height',ea.y+'px');if(w.ie()<=7){var fa=m.scry(this.root,'div.tagContainer')[0];if(fa)k.conditionClass(da,'ie7VerticalFix',x.getElementDimensions(fa).y>ea.y);}}},fetchInitBucket:function(da){if(!this.stream.isLoaded())return;this.stream.fetch(da,true);},addPhotoFbids:function(da,ea,fa){var ga=this.stream.getCursor()===null;this.stream.attachToFbidsList(da,ea,fa);if(fa&&ga)this.page(0);},storeFromResponse:function(da){this.storeFromData(da.getPayload());},storeFromData:function(da){var ea=this.stream.storeToCache(da);if('init' in da){s.setPhotoSet(this.stream.getPhotoSet());s.setLogFbids(true);s.addPhotoView(this.stream.getCurrentImageData().info);}if('error' in ea){this.checkState(ca.STATE_ERROR);return;}if('image' in ea)this.checkState(ca.STATE_IMAGE_DATA);if('data' in ea)this.checkState(ca.STATE_HTML);},setErrorBoxContent:function(da){m.setContent(this.errorBox,da);},updateTotalCount:function(da,ea,fa){var ga=aa('fbPhotoPagePositionAndCount');ga&&m.setContent(ga,fa);this.stream.setTotalCount(da);this.stream.setFirstCursorIndex(ea);},buttonListener:function(event){var da=event.getTarget();if(q.byClass(da,'likeButton')){m.find(y('fbPhotoPageFeedback'),'button.like_link').click();}else if(q.byClass(da,'commentButton')){m.find(this.root,'div.commentBox textarea').focus();this.root.scrollTop=this.root.scrollHeight;}},rotateListener:function(event){var da=event.getTarget();if(q.byClass(da,'rotateRight')){this.rotate('right');}else if(q.byClass(da,'rotateLeft'))this.rotate('left');},stageClickListener:function(event){var da=event.getTarget();if(q.byClass(da,'fbPhotoTagApprovalBox')){return true;}else if(q.byClass(da,'videoStage')){return true;}else this.goNav(event);},rotate:function(da){var ea=this.stream.getCursor();if(this.getVideoOnStage()){var fa=(da=='left')?270:90;j.loadModules(['VideoRotate'],function(ha){new ha(ea,this.actionList).motionRotate(fa);}.bind(this));return;}var ga={fbid:ea,cs_ver:r.VIEWER_PERMALINK,set:this.stream.getPhotoSet()};ga[da]=1;this.setLoadingState(ca.STATE_IMAGE_DATA,true);k.hide(this.image);new i('/ajax/photos/photo/rotate/').setMethod('POST').setAllowCrossPageTransition(true).setReadOnly(false).setData(ga).setHandler(this.storeResponseForRotate.bind(this,ea)).send();},storeResponseForRotate:function(da,ea){this.storeFromResponse(ea);var fa=this.stream.getImageData(da);fa.url=ea.getPayload().new_urls[r.SIZE_NORMAL];fa.dimensions=x.deserialize(ea.getPayload().dimensions);if(da==this.stream.getCursor()){this.setLoadingState(ca.STATE_IMAGE_DATA,false);this.switchImage(this.stream.getCurrentImageData().url);this.swapData();}},mouseOutListener:function(event){var da=event.getTarget(),ea=event.getRelatedTarget(),fa=q.byClass(da,'stageActions'),ga=q.byClass(da,'stageWrapper'),ha=q.byClass(ea,'stageActions'),ia=q.byClass(ea,'stageWrapper'),ja=(!ia&&(ga&&!ha)||(fa&&!ia));if(ja)this.unhiliteAllTags(true);},mouseMoveListener:function(event){var da=event.getTarget();if(!q.byClass(da,'stageActions')&&!q.byClass(da,'stageWrapper'))return;this.hiliteTagsOnMouseMove(event);},unhiliteAllTags:function(da,event){m.scry(this.stageWrapper,'div.tagsWrapper div.hover').forEach(function(ea){if(da&&k.hasClass(ea,'tagBoxPending'))return;k.removeClass(ea,'hover');});if(da)return;if(this.unhiliteTimer!==null){clearTimeout(this.unhiliteTimer);this.unhiliteTimer=null;}this.hilitedTag=null;},switchHilitedTags:function(da,ea){this.unhiliteAllTags();var fa=aa(da);if(fa){this.hilitedTag=da;k.addClass(fa,'hover');if(k.hasClass(fa,'tagBoxPending')&&!k.hasClass(fa,'showPendingTagName')&&ea===true){m.scry(this.stageWrapper,'div.tagsWrapper div.showPendingTagName').forEach(function(ga){k.removeClass(ga,'showPendingTagName');});k.addClass(fa,'showPendingTagName');}}},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.unhiliteTimer!==null)return;var da=event.getTarget();if(q.byClass(da,'fbPhotoPageTagApproval'))return;var ea=q.byClass(da,'tagBoxPending'),fa=(this.hilitedTag&&k.hasClass(y(this.hilitedTag),'tagBoxPending')),ga=((!this.hilitedTag&&ea)||(!fa&&ea));if(ga){this.switchHilitedTags(ea.id);return;}if(ea&&(ea.id==this.hilitedTag))return;var ha=250,ia=aa('fbPhotoImage'),ja=x.getEventPosition(event),ka=x.getElementPosition(ia),la=x.getElementDimensions(ia),ma=this.stream.getCurrentExtraData().tagRects,na=v.getNearestBox(ja,ka,la,1,ca.MIN_TAG_DISTANCE,ma);if(!na){if(!fa){this.unhiliteAllTags();this.reHilitePendingTag();}return;}var oa=null;if(fa){var pa={};pa[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];oa=v.getNearestBox(ja,ka,la,1,ca.MIN_TAG_DISTANCE,pa);}if(oa!==null&&fa)return;if(this.hilitedTag!=na)if(fa){this.unhiliteTimer=this.unhiliteAllTags.bind(this,false,event).defer(ha);}else this.switchHilitedTags(na);},updateTagBox:function(da,ea){this.unhiliteAllTags();var fa=aa(da);if(!fa)return;k.addClass(fa,'tagBox');k.addClass(fa,'tagBoxPendingResponse');k.removeClass(fa,'tagBoxPending');k.hide(m.find(fa,'span.tagForm'));if(ea){k.show(m.find(fa,'span.tagApproved'));}else k.show(m.find(fa,'span.tagIgnored'));},killDrag:function(){if(k.hasClass(this.root,'taggingMode'))return false;},reset:function(){while(this.pageHandlers&&this.pageHandlers.length)this.pageHandlers.pop().remove();n.getInstance().resetHandlers();},onHiliteTag:function(da,ea){if(ea.version!=r.VIEWER_PERMALINK)return;var fa=ea.tag;if(fa){this.switchHilitedTags(fa,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(da,ea){if(ea.version==r.VIEWER_PERMALINK)this.updateTagBox(ea.id,ea.approve);}});e.exports=a.PhotoPermalink||ca;});
__e("PhotoCropper",["event-extensions","function-extensions","Arbiter","bootloader","css","DOM","Form","Photocrop2","PhotoPermalink","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('bootloader'),i=b('css'),j=b('DOM'),k=b('Form'),l=b('Photocrop2'),m=b('PhotoPermalink'),n=b('copyProperties'),o={init:function(p,q){if(this.photocrop)this.destroy();this.root=p;this.options=q||{};this.actionLinks=j.find(this.root,'div.fbPhotosPhotoActions');var r=j.scry(this.actionLinks,'a.fbPhotoActionsCrop');if(r.length===0)return;var s=this.start.bind(this),t=j.find(r[0],'.startCropping');Event.listen(t,'click',function(){h.loadComponents('photocrop2',s);return false;});g.subscribe('PhotoPermalink.PAGE',this.destroy.bind(this),g.SUBSCRIBE_NEW);},start:function(){if(this.photocrop)return;this.cropLink=j.find(this.actionLinks,'a.fbPhotoActionsCrop');i.addClass(this.cropLink,'croppingModeOn');if(i.hasClass(this.cropLink,'profileAlbum')){this.reuseProfilePic.bind(this).defer();return false;}i.addClass(this.root,'croppingMode');var p=j.find(this.root,'img.fbPhotoImage'),q=j.find(this.root,'a.doneCroppingLink'),r=j.find(this.root,'a.cancelCroppingLink'),s=j.find(this.cropLink,'.doneCropping');this.wrapper=j.create('div');i.addClass(this.wrapper,'stageCropper');j.find(this.root,'.stageWrapper').appendChild(this.wrapper);this.wrapper.style.marginTop=p.parentNode.style.marginTop;Event.listen(this.wrapper,'click',this.cancelAndStopEvent.bind(this));Event.listen(q,'click',this.done.bind(this));Event.listen(r,'click',this.cancelAndStopEvent.bind(this));Event.listen(s,'click',this.done.bind(this));var t={target:this.wrapper,min_width:this.options.min_width},u=(function(){this.photocrop=new l(p,t);}).bind(this);if(p.complete){u();}else Event.listen(p,'load',u);return false;},done:function(){var p=m.getInstance().getCurrentPhotoInfo(),q=this.getProfilePicTarget(p).id,r=this.destroy(),s=n({pid:p.pid,owner:p.owner,id:q,'return':'profile.php?id='+q,error_return:'photo.php?pid='+p.pid+'&id='+p.owner},r);k.post('/crop_profile_pic.php',s);return false;},cancelAndStopEvent:function(){this.destroy();return false;},destroy:function(){if(this.photocrop){i.removeClass(this.cropLink,'croppingModeOn');i.removeClass(this.root,'croppingMode');j.remove(this.wrapper);var p=this.photocrop.done();this.photocrop=null;return p;}},reuseProfilePic:function(){var p=m.getInstance().getCurrentPhotoInfo(),q=this.getProfilePicTarget(p),r=n({pid:p.pid,owner:p.owner,id:q.id,type:q.type,profile_pic_id:q.id});k.post('/pic_upload.php',r);return false;},getProfilePicTarget:function(p){if(i.hasClass(this.cropLink,'makePageProfile'))return {id:p.owner,type:'object'};return {id:this.options.uid,type:'profile'};}};e.exports=a.PhotoCropper||o;});
__e("legacy:fb-photos-permalink-cropper",["PhotoCropper"],function(a,b,c,d){a.PhotoCropper=b('PhotoCropper');},3);
__e("PhotoTagger",["event-extensions","Arbiter","AsyncRequest","css","DOM","ErrorDialog","Input","Keys","Parent","PhotosConst","PhotosTaggingWaterfall","Vector","copyProperties","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('css'),j=b('DOM'),k=b('ErrorDialog'),l=b('Input'),m=b('Keys'),n=b('Parent'),o=b('PhotosConst'),p=b('PhotosTaggingWaterfall'),q=b('Vector'),r=b('copyProperties'),s=b('userAction');function t(u){if(u===o.VIEWER_SNOWLIFT){u=a.PhotoSnowlift&&a.PhotoSnowlift.getInstance();}else if(u===o.VIEWER_PERMALINK)u=a.PhotoPermalink&&a.PhotoPermalink.getInstance();this.viewer=u;this.version=u.getVersionConst();t.instances[this.version]=this;}t.instances={};t.getInstance=function(u){return t.instances[u];};r(t.prototype,{TAG_BOX_SIZE:100,datasources:{},photoData:{},elemNames:{6:{addTagLink:'div.fbPhotosPhotoOwnerButtons',overlayActions:'div.snowliftOverlayBar'}},init:function(u,v){this.setupUserActionLogging();this.root=this.viewer.getRoot();this.tagger=u;this.tokenizer=v;this._qn=null;this.typeahead=v.getTypeahead();this.clickState=j.find(this.root,'div.stageActions');this.faceBox=j.find(this.tagger,'div.faceBox');this.newTagBox=j.find(this.clickState,'div.newTagBox');this.addTagLink=j.find(this.root,this.elemNames[this.version].addTagLink);this.overlayActions=j.find(this.root,this.elemNames[this.version].overlayActions);this.setupHandlers();this.hideNewTagTimer=null;this.fetchTaggingSuggestions({owner:this.photoData.owner});this.setDataSource(this.typeahead.getData());return this;},setupUserActionLogging:function(){this.ua=s('tagging').set_namespace(this.viewer.getSourceString()).set_ua_id('tagging').add_event('init');},logUserActionEvent:function(u){this.ua.add_event(u);},fetchTaggingSuggestions:function(u){this.logUserActionEvent('sugg_fetch');new h().setURI('/ajax/photos/photo/tags/tags_init.php').setData(u).setOption('retries',1).setAllowCrossPageTransition(true).setHandler(function(w){this.typeahead.getView().setSuggestions(w.getPayload().taggees);this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();var v=this.typeahead.subscribe('bootstrap',function(w,x){if(x&&!x.bootstrapping){this.updateWithSuggestions();this.typeahead.unsubscribe(v);this.typeahead.subscribe('focus',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('removeToken',this.updateWithSuggestions.bind(this));this.tokenizer.subscribe('addToken',this.addSuggestion.bind(this));this.typeahead.subscribe('respond',function(y,z){if(z&&!z.results.length)this.updateWithSuggestions();}.bind(this));}}.bind(this));},setupHandlers:function(){this.handlers=[Event.listen(this.clickState,'click',this.addTag.bind(this)),Event.listen(window,'resize',this.hideTagger.bind(this)),Event.listen(this.addTagLink,'click',this.checkActions.bind(this)),Event.listen(this.overlayActions,'click',this.checkActions.bind(this))];Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)===m.ESC)if(this.taggingMode)this.deactivateTagging();}.bind(this));this.subscriptions=[g.subscribe(this.viewer.getEventString('PAGE'),this.restartTagging.bind(this)),g.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.setPhotoData.bind(this)),g.subscribe(this.viewer.getEventString('CLOSE'),this.deactivateTagging.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));},updateWithSuggestions:function(u,v){var w=this.typeahead.getData().buildUids(' ',this.typeahead.getView().getSuggestions(),this.typeahead.getCore().getExclusions());if(!w.length)return;var x=this.typeahead.getData().respond('',w);for(var y=0;y<x.length;y++)x[y].index=-1000+y;},addSuggestion:function(u,v){var w=v.info&&v.info.uid;if(w)this.typeahead.getView().addSuggestion(w);},setQueueName:function(u){this._qn=u;return this;},_sendWaterfallLogSignal:function(u){p.sendSignal({qn:this._qn,source:this.viewer.getSourceString(),step:u,pid:this.photoData.pid});},_bumpQueueName:function(){if(this._qn)this._qn+=1;},activateTagging:function(){this.logUserActionEvent('activate');g.inform('PhotoTagger.ACTIVATE_TAGGING');if(this.getDataSource()){this.dataSourceFetched(this.getDataSource());}else new h('/ajax/photos/photo/tags/fetch_datasource.php').setData({fbid:this.photoData.fbid,version:this.version}).send();},restartTagging:function(){this.hideNewTag();this.hideTagger();if(this.taggingMode===true)this.activateTagging();},getDataSource:function(){return this.datasources[this.getDataSourceKey()];},getDataSourceKey:function(){if(this.photoData.ownertype=='user'&&!this.photoData.obj_id)return 'friends';return this.photoData.obj_id||this.photoData.owner;},setDataSource:function(u){if(this.typeahead.getData()!=u)this.typeahead.swapData(u);this.datasources[this.getDataSourceKey()]=u;},dataSourceFetched:function(u){this.taggingMode=true;i.addClass(this.root,'taggingMode');this._bumpQueueName();this._sendWaterfallLogSignal(p.BEGIN);this.setDataSource(u);},deactivateTagging:function(){this.logUserActionEvent('deactivate');if(this.taggingMode===true)this._sendWaterfallLogSignal(p.FINISH);this.taggingMode=false;this.hideNewTag();this.hideTagger();i.removeClass(this.root,'taggingMode');},checkActions:function(event){var u=event.getTarget();if(n.byClass(u,'fbPhotosPhotoActionsTag'))this.taggingMode?this.deactivateTagging():this.activateTagging();},hideTagger:function(){i.hide(this.tagger);},showTagger:function(){i.show(this.tagger);var u=j.find(this.tagger,'input.textInput');l.reset(u);u.focus();this.updateWithSuggestions();this.hideNewTag();},showNewTag:function(u){if(!this.newTagBox)return;j.setContent(j.find(this.newTagBox,'div.tagName'),j.create('span',null,u));i.show(this.newTagBox);this.hideNewTagTimer=setTimeout(this.hideNewTag.bind(this),3000);},hideNewTag:function(){if(!this.newTagBox)return;if(this.hideNewTagTimer!==null){clearTimeout(this.hideNewTagTimer);this.hideNewTagTimer=null;}i.hide(this.newTagBox);},getTaggerPositioningOrigin:function(){return q.getElementPosition(this.clickState,'document');},addTag:function(event){var u=event.getTarget(),v=n.byClass(u,'fbPhotosPhotoButtons');if(!this.taggingMode||(v&&u!==v)||n.byClass(u,'fbPhotosPhotoActions')||n.byClass(u,'photoTagTypeahead'))return;var w=this.viewer.getImage(),x=q.getEventPosition(event),y=this.calcTaggerPosition(w,x);this.calcClickPoint(w,x);if(!y){this.hideTagger();return;}y.setElementPosition(this.tagger);if(this.newTagBox)y.setElementPosition(this.newTagBox);this.showTagger();this._sendWaterfallLogSignal(p.TAG_FACE);},calcTaggerPosition:function(u,v){var w=q.getElementPosition(u),x=q.getElementDimensions(u),y=new q(this.TAG_BOX_SIZE/2,this.TAG_BOX_SIZE/2),z=v.sub(w);for(var aa in z){if(v[aa]<w[aa]||v[aa]>w[aa]+x[aa])return null;if(z[aa]<(this.TAG_BOX_SIZE/2)){y[aa]=z[aa];}else if(x[aa]<z[aa]+(this.TAG_BOX_SIZE/2))y[aa]=this.TAG_BOX_SIZE-(x[aa]-z[aa]);}var ba=v.sub(this.getTaggerPositioningOrigin());return ba.sub(y.x,y.y);},calcClickPoint:function(u,v){var w=q.getElementDimensions(u),x=q.getElementPosition(u),y=v.sub(x);this.clickPoint={x:y.x/w.x,y:y.y/w.y};},saveTag:function(u,v){var w=this.getTaggingData('add',v.isFreeform()?'':v.getValue(),v.getText());w.x=this.clickPoint.x*100;w.y=this.clickPoint.y*100;this.logUserActionEvent('save');new h().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(w).setAllowCrossPageTransition(true).setHandler(function(x){this.tagsChangeHandler(x);this.logUserActionEvent('save_done');}.bind(this)).setErrorHandler(this.checkError.bind(this,v)).send();this.showNewTag(v.getText());this.hideTagger();},getTaggingData:function(u,v,w){return {cs_ver:this.version,pid:this.photoData.pid,id:this.photoData.owner,subject:v,name:w,action:u,source:this.viewer.getSourceString(),qn:this._qn,position:this.getPosition()};},getPosition:function(){return this.viewer.getPosition();},tagsChangeHandler:function(u){this.viewer.saveTagComplete(u);},checkError:function(u,v){if(v.getPayload()&&v.getPayload().clear_tag){u.already_untagged=true;this.tokenizer.removeToken(u);}k.showAsyncError(v);},removeTag:function(u,v,w){if(v.already_untagged)return;var x='remove';if(j.scry(v.element,'a.pending')[0])x='retract';if(v.blockUser)x='remove_block';this.logUserActionEvent('save');new h().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData(x,v.isFreeform()?'':v.getInfo().uid,v.getInfo().text)).setHandler(function(y){this.tagsChangeHandler(y);this.logUserActionEvent('save_done');w&&w();}.bind(this)).setAllowCrossPageTransition(true).send();},removeTagByID:function(u,v,w){var x=this.tokenizer.tokens;for(var y=0;y<x.length;y++)if(x[y].info.uid==v)return this.removeTag(null,x[y],w);},removeTagByIDFromHovercardLink:function(u,v,w){this.removeTagByID(u,v,function(){if(window.Hovercard)Hovercard.contains(w)&&Hovercard.hide(true);});},setPhotoData:function(u,v){this.photoData=v;return this;},markTagAsSpam:function(u,v){new h().setURI('/ajax/photo_tagging_ajax.php').setMethod('POST').setData(this.getTaggingData('mark_as_spam',v,null)).send();}});e.exports=t;});
__e("legacy:PhotoTagger",["PhotoTagger"],function(a,b,c,d){a.PhotoTagger=b('PhotoTagger');},3);
__e("legacy:fb-photos-permalink-js",["PhotoPermalink"],function(a,b,c,d){a.PhotoPermalink=b('PhotoPermalink');},3);
function PhotoPermalinkTagger(a){this.parent.construct(this,PhotoPermalink.getInstance());this.photoData=a;}Class.extend(PhotoPermalinkTagger,'PhotoTagger');copy_properties(PhotoPermalinkTagger.prototype,{elemNames:{0:{addTagLink:'div.fbPhotosPhotoActions',overlayActions:'div.fbPhotosPhotoButtons'}},setupHandlers:function(){var a=$('imagestage'),b=$('fbPhotoPageTagBoxes');this.handlers=[Event.listen(this.clickState,'click',this.addTag.bind(this)),Event.listen(a,'click',this.addTag.bind(this)),Event.listen(b,'click',this.addTag.bind(this)),Event.listen(this.addTagLink,'click',this.checkActions.bind(this)),Event.listen(this.overlayActions,'click',this.checkActions.bind(this))];this.subscriptions=[Arbiter.subscribe('PhotoPermalink.PAGE',this.restartTagging.bind(this)),Arbiter.subscribe('PhotoPermalink.DATA_CHANGE',this.setPhotoData.bind(this))];this.tokenizer.subscribe('addToken',this.saveTag.bind(this));this.tokenizer.subscribe('removeToken',this.removeTag.bind(this));this.tokenizer.subscribe('markTagAsSpam',this.markTagAsSpam.bind(this));},setDataForTokenizer:function(){this.tokenizer.setup(null,this.photoData);return this;}});
__e("PhotoTags",["array-extensions","event-extensions","Arbiter","css","DOM","Parent","PhotosConst","copyProperties","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('css'),i=b('DOM'),j=b('Parent'),k=b('PhotosConst'),l=b('copyProperties'),m=b('ge');function n(o,p,q){this.tagTargets=o;this.tagBox=p;this.version=q||k.VIEWER_PERMALINK;this.handlers=[];this.tagTargets.forEach(function(r){this.handlers.push(Event.listen(r,{mouseover:this.showTag.bind(this),mouseout:this.hideTags.bind(this)}));}.bind(this));this.subscriptions=[];if(this.version==k.VIEWER_SNOWLIFT)this.subscriptions.push(g.subscribe("PhotoSnowlift.PAGE",this.hideTags.bind(this)));}l(n.prototype,{showTag:function(event){var o=event.getTarget(),p=h.hasClass(o,'taggee'),q=h.hasClass(o,'uiProfilePhotoMedium'),r=null;if(p){r=o.getAttribute('data-tag');}else if(q){var s=j.byTag(o,'a');r=s&&s.getAttribute('data-tag');}var t=this.version==k.VIEWER_PERMALINK?'perm:tag:'+r:'tag:'+r,u=t&&m(t);if(u){h.addClass(u,'showTag');h.addClass(this.tagBox,'showingTag');}},hideTags:function(){h.removeClass(this.tagBox,'showingTag');i.scry(this.tagBox,'div.showTag').forEach(function(o){h.removeClass(o,'showTag');});},destroy:function(){for(var o in this.handlers)this.handlers[o].remove();this.subscriptions.forEach(g.unsubscribe.bind(g));}});e.exports=n;});
__e("TagToken",["Class","DOM","Token","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('Token'),j=b('copyProperties');function k(l){this.parent.construct(this,l,'tag');}g.extend(k,i);j(k.prototype,{createElement:function(){var l=this.isFreeform(),m=h.create('span',{className:'separator'},', '),n=h.create(l?'span':'a',{className:'taggee','data-tag':this.getValue()},this.getText());if(!l)n.href=this.getInfo().path;return h.create('span',{className:'tagItem'},[m,n]);}});e.exports=k;});
__e("TagTokenizer",["Arbiter","Class","css","DOM","Input","Parent","PhotosConst","TagToken","Tokenizer","copyProperties","ge","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('css'),j=b('DOM'),k=b('Input'),l=b('Parent'),m=b('PhotosConst'),n=b('TagToken'),o=b('Tokenizer'),p=b('copyProperties'),q=b('ge'),r=b('tx');function s(t,u,v,w){this.parent.construct(this,v,w);if(t===m.VIEWER_SNOWLIFT){t=a.PhotoSnowlift&&a.PhotoSnowlift.getInstance();}else if(t===m.VIEWER_PERMALINK)t=a.PhotoPermalink&&a.PhotoPermalink.getInstance();this.viewer=t;this.appphoto=u;g.subscribe(this.viewer.getEventString('DATA_CHANGE'),this.setup.bind(this),g.SUBSCRIBE_NEW);g.subscribe('PhotoInlineEditor.CANCEL_INLINE_EDITING',this.updateTokenareaVisibility.bind(this),g.SUBSCRIBE_NEW);}h.extend(s,o);p(s.prototype,{setup:function(t,u){this.appphoto=u.byapp;this.byowner=u.isowner;return this.reset();},reset:function(){var t=this.getTokenElements().map(this.getTokenDataFromTag.bind(this));this.withTagKeys={};var u=this.getWithTagTokenElements().map(function(v){return this._tokenKey(this.getTokenDataFromTag(v));}.bind(this));this.withTagKeys=Object.from(u);k.reset(this.input);return this.parent.reset(t);},processEvents:function(event,t,u){if(l.byClass(t,'remove')){var v=this.getTokenFromElement(u);v=this.addTokenData(v,t);this.removeToken(v);event.kill();}},insertToken:function(t){return null;},removeToken:function(t){if(this.appphoto){return this.replaceToken(t);}else{this.inform('removeToken',t);g.inform('Form/change',{node:this.element});}},addTokenData:function(t,u){if(l.byClass(u,'blockuser'))t.blockUser=true;return t;},getTokenDataFromTag:function(t){return {uid:j.find(t,'input').value,text:j.getText(j.find(t,'.taggee'))};},getTokenElementFromTarget:function(t){return l.byClass(t,'tagItem');},getTokenElements:function(){return j.scry(this.tokenarea,'span.tagItem').filter(this.filterNonTokenElements.bind(this));},getWithTagTokenElements:function(){return j.scry(this.tokenarea,'span.withTagItem');},filterNonTokenElements:function(t){return !i.hasClass(t,'markasspam')&&!i.hasClass(t,'reported')&&!i.hasClass(t,'withTagItem');},createToken:function(t,u){var v=this.getToken(this._tokenKey(t));v=v||new n(t);u&&v.setElement(u);return v;},updateTokenareaVisibility:function(){var t=this.getTokenElements().filter(function(v){return i.shown(v);}),u=this.getWithTagTokenElements();i.conditionShow(this.tokenarea,t.length!==0||u.length!==0);},replaceToken:function(t){if(!t)return;var u=this.tokens.indexOf(t);if(u<0)return;this.tokens.splice(this.tokens.indexOf(t),1);delete this.unique[this._tokenKey(t.getInfo())];var v=q('tagspam'+t.getValue());v&&j.remove(v);var w=[' [',"Tag Removed.",' '];w.push(j.create('a',{onclick:this.markAsSpam.bind(this,t.getValue())},"Mark tag as spam"));w.push('] ');var x=j.create('span',{className:'fbPhotosTaglistTag tagItem markasspam',id:'tagspam'+t.getValue()},w);j.replace(t.getElement(),x);this.updateTokenarea();this.inform('removeToken',t);g.inform('Form/change',{node:this.element});},markAsSpam:function(t){var u=q('tagspam'+t),v=[' [',"Tag Reported",'] '],w=j.create('span',{className:'fbPhotosTaglistTag tagItem reported',id:'tagspam'+t},v);j.replace(u,w);this.inform('markTagAsSpam',t);}});e.exports=s;});
__e("TagTypeaheadView",["Class","TypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('TypeaheadView'),i=b('copyProperties');function j(k,l){this.parent.construct(this,k,l);this.hintText=l.hintText;this.origAutoSelect=l.autoSelect;this.setSuggestions(l.suggestions);}g.extend(j,h);i(j.prototype,{buildResults:function(k){if(!this.value)k.unshift({subtext:this.hintText,type:'hintText'});var l=this.parent.buildResults(k);if(!this.value)k.shift();return l;},render:function(k,l,m){this.autoSelect=this.origAutoSelect&&k.length;this.disableAutoSelect=k.length===0;this.parent.render(k,l,m);},getItems:function(){var k=this.parent.getItems();if(!this.value)k.shift();return k;},getSuggestions:function(){return this.suggestions;},setSuggestions:function(k){this.suggestions=k||[];this.visible=!!this.suggestions;},addSuggestion:function(k){this.suggestions.unshift(k);}});e.exports=j;});
__e("StickyPlaceholderInput",["event-extensions","css-core","DOM","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('css-core'),h=b('DOM'),i=b('Parent'),j=h.$N;function k(o){return i.byClass(o,'uiStickyPlaceholderInput');}function l(o){return h.scry(o,'.placeholder')[0];}function m(o){o=o||window.event;var p=o.target||o.srcElement;if(h.isNodeOfType(p,['input','textarea'])){var q=k(p);if(q){var r=o.type;(function(){if(r=='keydown'&&p.value.length)g.removeClass(q,'uiStickyPlaceholderEmptyInput');if((r=='blur'||r=='focusout')&&!p.value.length)g.addClass(q,'uiStickyPlaceholderEmptyInput');}).defer();}}}var n={init:function(){n.init=bagofholding;Event.listen(document.documentElement,'keydown',m);if(document.documentElement.addEventListener){document.documentElement.addEventListener('blur',m,true);}else Event.listen(document.documentElement,'focusout',m);},registerInput:function(o){n.init();var p=o.getAttribute('placeholder')||'';if(p.length)if(document.activeElement===o){var q=Event.listen(o,'blur',function(){n.manipulateInput(o,p);q.remove();});}else n.manipulateInput(o,p);},manipulateInput:function(o,p){var q=j('div',{className:'placeholder',ariaHidden:true},p),r=j('div',{className:'uiStickyPlaceholderInput'},q);if(h.isNodeOfType(o,'textarea'))g.addClass(r,'uiStickyPlaceholderTextarea');Event.listen(q,'click',function(){o.focus();});if(o.value===p)o.value='';g.removeClass(o,'DOMControl_placeholder');o.setAttribute('placeholder','');h.replace(o,r);h.appendContent(r,o);g.conditionClass(r,'uiStickyPlaceholderEmptyInput',!o.value.length);},setPlaceholderText:function(o,p){var q=k(o),r=l(q);r&&h.setContent(r,p);},getPlaceholderText:function(o){var p=k(o),q=l(p);return q&&h.getText(q);},update:function(o){var p=k(o);if(p)g.conditionClass(p,'uiStickyPlaceholderEmptyInput',!o.value.length);},getVisibleText:function(o){var p=k(o);if(g.hasClass(p,'uiStickyPlaceholderEmptyInput')){var q=l(p);return q&&h.getText(q);}else return o.value;}};e.exports=n;});
__e("legacy:StickyPlaceholderInput",["StickyPlaceholderInput"],function(a,b,c,d){a.StickyPlaceholderInput=b('StickyPlaceholderInput');},3);
__e("legacy:Tokenizer",["Tokenizer"],function(a,b,c,d){a.Tokenizer=b('Tokenizer');},3);
add_properties('TokenizerBehaviors',{freeform:function(a,b){var c=b.tokenize_on_blur!==false,d=b.tokenize_on_paste!==false,e=b.matcher&&new RegExp(b.matcher,'i');function f(event){var g=Input.getValue(a.getInput()).trim();if(g&&(!e||e.test(g))){var h={uid:g,text:g,freeform:true};a.addToken(a.createToken(h));if(event){a.getTypeahead().getCore().afterSelect();event.kill();}}}a.subscribe('keydown',function(g,h){var event=h.event,i=Event.getKeyCode(event);if(i==KEYS.COMMA||i==KEYS.RETURN){var j=a.getTypeahead().getView();if(j.getSelection()){j.select();event.kill();}else f(event);}});a.subscribe('paste',function(g,h){if(d)f.bind(null,h.event).defer(20);});a.subscribe('blur',function(g,h){if(c)f();a.getTypeahead().getCore().reset();});}});
add_properties('TypeaheadBehaviors',{hintText:function(a){a.getCore().resetOnKeyup=false;}});
add_properties('TypeaheadBehaviors',{requireSelection:function(a){var b=a.getCore(),c=b.getElement().form;function d(){!b.getHiddenValue()&&b.reset();}d();b.subscribe('blur',d);c&&Event.listen(c,'submit',d);}});