var scrollQueue=[];var since_id;var max_id;var activityParams;var activityScrollI;var currDomain;var tmOffst;var trackToOpenId;var currentlyOpenId=null;var openTrackI;var mostRecentSong;var colorscheme;var recentPlayedI;var currentCallSign;var mediaUrl;var trackOpenHeight=150;var hoverInterval=350;var trackClosedHeigt=25;var trackPadding=5;var activityScrollPlaying=true;var activityScrollH=80;var curActivityScrollH=activityScrollH;var openTrackH=trackOpenHeight+trackPadding;var trackH=trackClosedHeigt+trackPadding;var vOrderKey="vOrder";var trackOpenOk=true;var delayNextOpenI=0;var pendingTrackId=0;(function(A){jQuery.fn.prettyDate=function(){return this.each(function(){var B=prettyDate(this.title);if(B){jQuery(this).text(B)}})};jQuery.fn.formatRank=function(){return this.each(function(){var B="#"+(Number(this.title)+1);jQuery(this).text(B)})};jQuery.fn.cleanTime=function(){return this.each(function(){var D=new Date(Number(this.title));var B=D.getTime();var C=D.getTimezoneOffset()*60000;var I=B+C;var F=new Date(I+tmOffst);if(F){var J=F.getHours();var H=J>11?"pm":"am";J=J==0?12:J;J=J>12?(J-12):J;var G=F.getMinutes();mnStr=G<10?("0"+G):(""+G);var E=J+":"+mnStr+H;jQuery(this).text(E)}})};jQuery.fn.expandingTracks=function(){return this.each(function(){$this=A(this);$this.bind("mouseover",function(){queueToOpen(A(this).attr("id"))});$this.bind("mouseout",function(){cancelOpen()})})}})(jQuery);function onScrollIncreased(){}function onScrolledNext(){}function checkActivityClose(){}function checkActivityOpen(){}function pauseActivityScroll(){activityScrollPlaying=false}function unpauseActivityScroll(){if(!activityScrollPlaying){activityScrollPlaying=true;scrollInNext()}}function scrollInNext(){if(activityScrollPlaying){if(scrollQueue.length>0){var A=scrollQueue.pop();$("#scroll_content").prepend(A);onScrolledNext();$("#scroll_content").css("top",-($("#scroll_content .buzz:first-child").height()));$("#scroll_content .buzz:first-child .created").prettyDate();$("#scroll_content").animate({top:0},1000,"easeInOutQuad").animate({opacity:1},3500,scrollInNext)}else{onScrollIncreased();activityScrollI=setInterval(loadRecentActivity,20000)}}}function loadRecentActivity(){if(activityScrollI){clearInterval(activityScrollI)}$.get("/api/activity/",activityParams,function(data){$(".created").prettyDate();var res_obj=eval("("+data+")");if(res_obj.since_id>0){since_id=res_obj.since_id;activityParams.since_id=since_id}scrollQueue=res_obj.activity;scrollInNext()})}function prettyDate(D){var B=new Date(D),C=(((new Date()).getTime()-B.getTime())/1000),A=Math.floor(C/86400);if(isNaN(A)||A<0||A>=31){return }return A==0&&(C<60&&"just now"||C<120&&"1 minute ago"||C<3600&&Math.floor(C/60)+" minutes ago"||C<7200&&"1 hour ago"||C<86400&&Math.floor(C/3600)+" hours ago")||A==1&&"Yesterday"||A<7&&A+" days ago"||A<31&&Math.ceil(A/7)+" weeks ago"}function delayNextOpen(){trackOpenOk=false;if(delayNextOpenI){clearInterval(delayNextOpenI)}delayNextOpenI=setInterval(function(){trackOpenOk=true;queueToOpen(0)},3*hoverInterval)}function queueToOpen(A){if(A||pendingTrackId){if(!A){A=pendingTrackId}if(openTrackI){clearInterval(openTrackI)}if(trackOpenOk){pendingTrackId=0;openTrackI=setInterval(doOpen,hoverInterval);trackToOpenId=A}else{pendingTrackId=A}}}function cancelOpen(){pendingTrackId=0;if(openTrackI){clearInterval(openTrackI)}}function closeCurrentlyOpen(){if(openTrackI){clearInterval(openTrackI)}if(currentlyOpenId!=null){var A=$("#"+currentlyOpenId);A.removeClass("open");A.animate({height:trackClosedHeigt},"normal","easeOutExpo");A.expandingTracks()}}function doOpen(){closeCurrentlyOpen();var B=checkActivityClose();currentlyOpenId=trackToOpenId;var F=$("#"+currentlyOpenId);F.unbind("mouseover").unbind("mouseout");var D=Math.floor(trackH*0.8),A=getTrackVOrder(F[0]),E=A*trackH,C=tracksH+B;tct=$("#trackscontainer").offset().top,tst=$("#tracks").offset().top,ttDelta=C-openTrackH-D-E+tct;if(ttDelta>tst){if(A>0){ttDelta=D-trackH*A+tct;if(ttDelta<tst){ttDelta=null}}else{if(tst<tct){ttDelta=tct}else{ttDelta=null}}}if(isNaN(ttDelta)){}else{$("#tracks").offset({top:ttDelta})}F.animate({height:trackOpenHeight},"normal","easeOutExpo",function(){F.addClass("open");var J=F.hasClass("hasBeenOpened");if(!J){F.addClass("hasBeenOpened");var I="http://"+currDomain+F.find(".songName").attr("href");var G="dark";if(colorscheme=="light"){G="light"}var H='<fb:like href="'+I+'" layout="button_count" show_faces="false" colorscheme="'+G+'"></fb:like>';F.find(".fblike").html(H);FB.XFBML.parse(document.getElementById(F.find(".fblike").attr("id")))}});delayNextOpen()}function assignTrackVOrder(){$(".track").each(function(A,B){$.data(B,vOrderKey,A)})}function getTrackVOrder(A){return $.data(A,vOrderKey)}function loadRecentlyPlayed(){if(recentPlayedI){clearTimeout(recentPlayedI)}if(mostRecentSong){$.get("/hour/since/"+currentCallSign+"/"+mostRecentSong+"/?x="+(new Date().getTime()),function(D){var B=jQuery.parseJSON(D);var F=false;if(B){if(B.length>0){mostRecentSong=B[0].playedAt;var C='<div class="newblock" style="display:none;">';for(var A=0;A<B.length;A++){if(!B[A].coverArtUrl){B[A].coverArtUrl=mediaUrl+"img/defaultcover170.jpg"}C+='<div id="trk_'+B[A].playedAt+'" class="track">                                 <div class="top">                                     <div class="songinfo">                                         <a class="songName" href="/music/'+B[A].artistSlug+"/_/"+B[A].trackSlug+'/" title="'+B[A].trackName+'">'+B[A].trackName+'</a>                                         <br/>                                         <a class="artistName" href="/music/'+B[A].artistSlug+'/" title="'+B[A].artistName+'">'+B[A].artistName+'</a>                                     </div>                                     <div class="timestamp" title="'+B[A].playedAt+'"></div>                                 </div>                                 <div class="column">                                     <a href="/onair/?act=na#'+B[A].playedAt+'"><img src="'+B[A].coverArtUrl+'"/></a>                                 </div>                                 <div class="column actions">                                 <a class="play" href="/onair/?act=play#'+B[A].playedAt+'"><span class="icon">&nbsp;</span>PLAY CLIP</a><br/><br/>                                 <a class="save" href="/onair/?act=save#'+B[A].playedAt+'"><span class="icon">&nbsp;</span>SAVE TO PLAYLIST</a><br/><br/>                                 <span id="fb_'+B[A].playedAt+'" class="fblike"></span>                                 </div>                             </div> '}C+="</div>";var E=$("#tracks").prepend(C);E.find(".newblock").show("slow");E.find(".track").expandingTracks();E.find(".timestamp").cleanTime();assignTrackVOrder();onResize();if(trackOpenOk){trackToOpenId="trk_"+B[0].playedAt;doOpen()}F=true;recentPlayedI=setTimeout("loadRecentlyPlayed()",30000*4)}}if(!F){recentPlayedI=setTimeout("loadRecentlyPlayed()",30000)}})}else{}};