function str_repeat(e,t){for(var n=[];t>0;n[--t]=e);return n.join("")}function sprintf(){for(var e,t,n,i,o,r=0,s=arguments[r++],a=[],l="";s;){if(t=/^[^\x25]+/.exec(s))a.push(t[0]);else if(t=/^\x25{2}/.exec(s))a.push("%");else{if(!(t=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(s)))throw"Oops ?!";if(null==(e=arguments[t[1]||r++])||void 0==e)throw"Too few arguments.";if(/[^s]/.test(t[7])&&"number"!=typeof e)throw"Expecting number but found "+typeof e;switch(t[7]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e);break;case"e":e=t[6]?e.toExponential(t[6]):e.toExponential();break;case"f":e=t[6]?parseFloat(e).toFixed(t[6]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&t[6]?e.substring(0,t[6]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(t[7])&&t[2]&&e>=0?"+"+e:e,i=t[3]?"0"==t[3]?"0":t[3].charAt(1):" ",o=t[5]-String(e).length-l.length,n=t[5]?str_repeat(i,o):"",a.push(l+(t[4]?e+n:n+e))}s=s.substring(t[0].length)}return a.join("")}!function(){var e,t=this,n=t.Backbone,i=[],o=i.push,r=i.slice,s=i.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="1.0.0";var a=t._;a||"undefined"==typeof require||(a=require("underscore")),e.$=t.jQuery||t.Zepto||t.ender||t.$,e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var l=e.Events={on:function(e,t,n){if(!d(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var i=this._events[e]||(this._events[e]=[]);return i.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!d(this,"once",e,[t,n])||!t)return this;var i=this,o=a.once(function(){i.off(e,o),t.apply(this,arguments)});return o._callback=t,this.on(e,o,n)},off:function(e,t,n){var i,o,r,s,l,c,u,h;if(!this._events||!d(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;for(s=e?[e]:a.keys(this._events),l=0,c=s.length;c>l;l++)if(e=s[l],r=this._events[e]){if(this._events[e]=i=[],t||n)for(u=0,h=r.length;h>u;u++)o=r[u],(t&&t!==o.callback&&t!==o.callback._callback||n&&n!==o.context)&&i.push(o);i.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=r.call(arguments,1);if(!d(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&u(n,t),i&&u(i,arguments),this},stopListening:function(e,t,n){var i=this._listeners;if(!i)return this;var o=!t&&!n;"object"==typeof t&&(n=this),e&&((i={})[e._listenerId]=e);for(var r in i)i[r].off(t,n,this),o&&delete this._listeners[r];return this}},c=/\s+/,d=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var o in n)e[t].apply(e,[o,n[o]].concat(i));return!1}if(c.test(n)){for(var r=n.split(c),s=0,a=r.length;a>s;s++)e[t].apply(e,[r[s]].concat(i));return!1}return!0},u=function(e,t){var n,i=-1,o=e.length,r=t[0],s=t[1],a=t[2];switch(t.length){case 0:for(;++i<o;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,s,a);return;default:for(;++i<o;)(n=e[i]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};a.each(h,function(e,t){l[t]=function(t,n,i){var o=this._listeners||(this._listeners={}),r=t._listenerId||(t._listenerId=a.uniqueId("l"));return o[r]=t,"object"==typeof n&&(i=this),t[e](n,i,this),this}}),l.bind=l.on,l.unbind=l.off,a.extend(e,l);var p=e.Model=function(e,t){var n,i=e||{};t||(t={}),this.cid=a.uniqueId("c"),this.attributes={},a.extend(this,a.pick(t,f)),t.parse&&(i=this.parse(i,t)||{}),(n=a.result(this,"defaults"))&&(i=a.defaults({},i,n)),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)},f=["url","urlRoot","collection"];a.extend(p.prototype,l,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return a.clone(this.attributes)},sync:function(){return e.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return a.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,n){var i,o,r,s,l,c,d,u;if(null==e)return this;if("object"==typeof e?(o=e,n=t):(o={})[e]=t,n||(n={}),!this._validate(o,n))return!1;r=n.unset,l=n.silent,s=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=a.clone(this.attributes),this.changed={}),u=this.attributes,d=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]);for(i in o)t=o[i],a.isEqual(u[i],t)||s.push(i),a.isEqual(d[i],t)?delete this.changed[i]:this.changed[i]=t,r?delete u[i]:u[i]=t;if(!l){s.length&&(this._pending=!0);for(var h=0,p=s.length;p>h;h++)this.trigger("change:"+s[h],this,u[s[h]],n)}if(c)return this;if(!l)for(;this._pending;)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,a.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,a.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!a.isEmpty(this.changed):a.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?a.clone(this.changed):!1;var t,n=!1,i=this._changing?this._previousAttributes:this.attributes;for(var o in e)a.isEqual(i[o],t=e[o])||((n||(n={}))[o]=t);return n},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return a.clone(this._previousAttributes)},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=this,n=e.success;return e.success=function(i){return t.set(t.parse(i,e),e)?(n&&n(t,i,e),t.trigger("sync",t,i,e),void 0):!1},R(this,e),this.sync("read",this,e)},save:function(e,t,n){var i,o,r,s=this.attributes;if(null==e||"object"==typeof e?(i=e,n=t):(i={})[e]=t,!(!i||n&&n.wait||this.set(i,n)))return!1;if(n=a.extend({validate:!0},n),!this._validate(i,n))return!1;i&&n.wait&&(this.attributes=a.extend({},s,i)),void 0===n.parse&&(n.parse=!0);var l=this,c=n.success;return n.success=function(e){l.attributes=s;var t=l.parse(e,n);return n.wait&&(t=a.extend(i||{},t)),a.isObject(t)&&!l.set(t,n)?!1:(c&&c(l,e,n),l.trigger("sync",l,e,n),void 0)},R(this,n),o=this.isNew()?"create":n.patch?"patch":"update","patch"===o&&(n.attrs=i),r=this.sync(o,this,n),i&&n.wait&&(this.attributes=s),r},destroy:function(e){e=e?a.clone(e):{};var t=this,n=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(o){(e.wait||t.isNew())&&i(),n&&n(t,o,e),t.isNew()||t.trigger("sync",t,o,e)},this.isNew())return e.success(),!1;R(this,e);var o=this.sync("delete",this,e);return e.wait||i(),o},url:function(){var e=a.result(this,"urlRoot")||a.result(this.collection,"url")||O();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},a.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=a.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,a.extend(t||{},{validationError:n})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];a.each(m,function(e){p.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.attributes),a[e].apply(a,t)}});var g=e.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,a.extend({silent:!0},t))},v={add:!0,remove:!0,merge:!0},y={add:!0,merge:!1,remove:!1};a.extend(g.prototype,l,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return e.sync.apply(this,arguments)},add:function(e,t){return this.set(e,a.defaults(t||{},y))},remove:function(e,t){e=a.isArray(e)?e.slice():[e],t||(t={});var n,i,o,r;for(n=0,i=e.length;i>n;n++)r=this.get(e[n]),r&&(delete this._byId[r.id],delete this._byId[r.cid],o=this.indexOf(r),this.models.splice(o,1),this.length--,t.silent||(t.index=o,r.trigger("remove",r,this,t)),this._removeReference(r));return this},set:function(e,t){t=a.defaults(t||{},v),t.parse&&(e=this.parse(e,t)),a.isArray(e)||(e=e?[e]:[]);var n,i,r,l,c,d=t.at,u=this.comparator&&null==d&&t.sort!==!1,h=a.isString(this.comparator)?this.comparator:null,p=[],f=[],m={};for(n=0,i=e.length;i>n;n++)(r=this._prepareModel(e[n],t))&&((l=this.get(r))?(t.remove&&(m[l.cid]=!0),t.merge&&(l.set(r.attributes,t),u&&!c&&l.hasChanged(h)&&(c=!0))):t.add&&(p.push(r),r.on("all",this._onModelEvent,this),this._byId[r.cid]=r,null!=r.id&&(this._byId[r.id]=r)));if(t.remove){for(n=0,i=this.length;i>n;++n)m[(r=this.models[n]).cid]||f.push(r);f.length&&this.remove(f,t)}if(p.length&&(u&&(c=!0),this.length+=p.length,null!=d?s.apply(this.models,[d,0].concat(p)):o.apply(this.models,p)),c&&this.sort({silent:!0}),t.silent)return this;for(n=0,i=p.length;i>n;n++)(r=p[n]).trigger("add",r,this,t);return c&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),this.add(e,a.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,a.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return a.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),a.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(a.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,n){t||(t=this.comparator);var i=a.isFunction(t)?t:function(e){return e.get(t)};return a.sortedIndex(this.models,e,i,n)},pluck:function(e){return a.invoke(this.models,"get",e)},fetch:function(e){e=e?a.clone(e):{},void 0===e.parse&&(e.parse=!0);var t=e.success,n=this;return e.success=function(i){var o=e.reset?"reset":"set";n[o](i,e),t&&t(n,i,e),n.trigger("sync",n,i,e)},R(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?a.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,i=t.success;return t.success=function(o){t.wait&&n.add(e,t),i&&i(e,o,t)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];a.each(b,function(e){g.prototype[e]=function(){var t=r.call(arguments);return t.unshift(this.models),a[e].apply(a,t)}});var w=["groupBy","countBy","sortBy"];a.each(w,function(e){g.prototype[e]=function(t,n){var i=a.isFunction(t)?t:function(e){return e.get(t)};return a[e](this.models,i,n)}});var _=e.View=function(e){this.cid=a.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},C=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];a.extend(_.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(t,n){return this.$el&&this.undelegateEvents(),this.$el=t instanceof e.$?t:e.$(t),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=a.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];if(a.isFunction(n)||(n=this[e[t]]),n){var i=t.match(C),o=i[1],r=i[2];n=a.bind(n,this),o+=".delegateEvents"+this.cid,""===r?this.$el.on(o,n):this.$el.on(o,r,n)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=a.extend({},a.result(this,"options"),e)),a.extend(this,a.pick(e,x)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(a.result(this,"el"),!1);else{var t=a.extend({},a.result(this,"attributes"));this.id&&(t.id=a.result(this,"id")),this.className&&(t["class"]=a.result(this,"className"));var n=e.$("<"+a.result(this,"tagName")+">").attr(t);this.setElement(n,!1)}}}),e.sync=function(t,n,i){var o=S[t];a.defaults(i||(i={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var r={type:o,dataType:"json"};if(i.url||(r.url=a.result(n,"url")||O()),null!=i.data||!n||"create"!==t&&"update"!==t&&"patch"!==t||(r.contentType="application/json",r.data=JSON.stringify(i.attrs||n.toJSON(i))),i.emulateJSON&&(r.contentType="application/x-www-form-urlencoded",r.data=r.data?{model:r.data}:{}),i.emulateHTTP&&("PUT"===o||"DELETE"===o||"PATCH"===o)){r.type="POST",i.emulateJSON&&(r.data._method=o);var s=i.beforeSend;i.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",o),s?s.apply(this,arguments):void 0}}"GET"===r.type||i.emulateJSON||(r.processData=!1),"PATCH"!==r.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(r.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=i.xhr=e.ajax(a.extend(r,i));return n.trigger("request",n,l,i),l};var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var E=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,T=/(\(\?)?:\w+/g,P=/\*\w+/g,A=/[\-{}\[\]+?.,\\\^$|#\s]/g;a.extend(E.prototype,l,{initialize:function(){},route:function(t,n,i){a.isRegExp(t)||(t=this._routeToRegExp(t)),a.isFunction(n)&&(i=n,n=""),i||(i=this[n]);var o=this;return e.history.route(t,function(r){var s=o._extractParameters(t,r);i&&i.apply(o,s),o.trigger.apply(o,["route:"+n].concat(s)),o.trigger("route",n,s),e.history.trigger("route",o,n,s)}),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes){this.routes=a.result(this,"routes");for(var e,t=a.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(A,"\\$&").replace(k,"(?:$1)?").replace(T,function(e,t){return t?e:"([^/]+)"}).replace(P,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return a.map(n,function(e){return e?decodeURIComponent(e):null})}});var D=e.History=function(){this.handlers=[],a.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},M=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,F=/msie [\w.]+/,W=/\/$/;D.started=!1,a.extend(D.prototype,l,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(W,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(t){if(D.started)throw new Error("Backbone.history has already been started");D.started=!0,this.options=a.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,o=F.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(I,"/"),o&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!o?e.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var r=this.location,s=r.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&r.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+r.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),D.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=a.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return n},navigate:function(e,t){if(!D.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),e.history=new D;var N=function(e,t){var n,i=this;n=e&&a.has(e,"constructor")?e.constructor:function(){return i.apply(this,arguments)},a.extend(n,i,t);var o=function(){this.constructor=n};return o.prototype=i.prototype,n.prototype=new o,e&&a.extend(n.prototype,e),n.__super__=i.prototype,n};p.extend=g.extend=E.extend=_.extend=D.extend=N;var O=function(){throw new Error('A "url" property or function must be specified')},R=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}}}.call(this),_wAMD.define("backbone",["jquery","underscore"],function(e){return function(){var t;return t||e.Backbone}}(this)),jsonrpc={},jsonrpc.CallStack=function(e,t,n,i){this._counter=0,this._enterFn=e,this._exitFn=n,this._enterScope=t,this._exitScope=i},jsonrpc.CallStack.prototype={enter:function(){this._counter=this._counter<0?1:this._counter+1,1===this._counter&&this._enterFn.apply(this._enterScope,arguments)},exit:function(){this._counter-=1,0===this._counter&&this._exitFn.apply(this._exitScope,arguments)}},jsonrpc.DelayedTask=function(e,t,n){this._fn=e||function(){},this._scope=t||void 0,this._args=n||[],this._id=null},jsonrpc.Observable=function(){this._listeners=[]},jsonrpc.Observable.prototype={bind:function(e,t){var n={fn:e,scope:t||this};return this._listeners.push(n),n},unbind:function(e){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)},trigger:function(){var e;for(e=0;e<this._listeners.length;e+=1)this._listeners[e].fn.apply(this._listeners[e].scope,arguments)}},jsonrpc.DelayedTask.prototype={delay:function(e,t,n,i){var o=this;this._fn=t||this._fn,this._scope=n||this._scope,this._args=i||this._args,this.cancel(),this._id=window.setInterval(function(){window.clearInterval(o._id),o._id=null,o._fn.apply(o._scope,o._args)},e)},cancel:function(){this._id&&(window.clearInterval(this._id),this._id=null)}},jsonrpc.JsonRpc=function(e){this._url=e,this.loading=new jsonrpc.Observable,this.loaded=new jsonrpc.Observable,this.unhandledFailure=new jsonrpc.Observable,this._loadingState=new jsonrpc.CallStack(this.loading.trigger,this.loading,this.loaded.trigger,this.loaded),this._requests=[],this._batchingMilliseconds=10,this._delayedTask=new jsonrpc.DelayedTask},jsonrpc.JsonRpc.prototype={setBatchingMilliseconds:function(e){this._batchingMilliseconds=e},call:function(){var e=this._getParams.apply(this,arguments);this._loadingState.enter(),this._requests.push(e),this._batchingMilliseconds?this._delayedTask.delay(this._batchingMilliseconds,this._sendRequests,this):this._sendRequests()},_sendRequests:function(){var e,t=this,n=this._requests,i=[];for(this._requests=[],e=0;e<n.length;e+=1)n[e].request.id=e,i.push(n[e].request);1===i.length&&(i=i[0]),t._doJsonPost(t._url,i,function(i,o){var r;if(i)r=t._isArray(o)?o:[o];else for(r=[],e=0;e<n.length;e+=1)r[e]={id:e,error:{message:o}};t._handleResponses(n,r)})},_handleResponses:function(e,t){var n,i,o;for(n=0;n<t.length;n+=1)i=t[n],o=e[i.id],this._handleResponse(o,i)},_handleResponse:function(e,t){var n=!t.error,i=n?t.result:t.error.message;this._loadingState.exit(),n?e.success.call(e.scope,i):e.failure.call(e.scope,i),e.callback.call(e.scope,n,i)},_getParams:function(){var e=this,t=Array.prototype.slice.call(arguments),n={request:{jsonrpc:"2.0",method:t.shift()}};for(n.request.params=[];t.length>1&&!this._isFunction(t[0]);)n.request.params.push(t.shift());return this._isFunction(t[0])?(n.success=t[0],n.scope=t[1]):(n.success=t[0].success,n.failure=t[0].failure,n.callback=t[0].callback,n.scope=t[0].scope),n.success=n.success||function(){},n.failure=n.failure||function(){e.unhandledFailure.trigger.apply(e.unhandledFailure,arguments)},n.callback=n.callback||function(){},n},_isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},_isFunction:function(e){return"[object Function]"===Object.prototype.toString.apply(e)},_beforeSend:function(){},_doJsonPost:function(e,t,n){var i=Weebly.jQuery.ajax({type:"POST",url:e,cache:!1,contentType:"application/json; charset=UTF-8",dataType:"json",beforeSend:this._beforeSend,data:JSON.stringify(t),headers:{"x-wtok":Weebly.RequestToken}}).done(function(e){var t=i.getResponseHeader("Content-Type");200!==i.status?n(!1,'Expected HTTP response "200 OK", found "'+i.status+" "+i.statusText+'"'):0!==t.indexOf("application/json")?n(!1,'Expected JSON encoded response, found "'+t+'"'):n(!0,e)})}},_wAMD.define("vendor/jsonrpc",function(){}),function(e){var t,n,i;"undefined"==typeof window?(t=require("underscore"),n=require("backbone"),i=n,"undefined"==typeof module||(module.exports=i)):(t=window._,n=window.Backbone,i=window),n.Relational={showWarnings:!0},n.Semaphore={_class:"Backbone.Semaphore",_permitsAvailable:null,_permitsUsed:0,acquire:function(){if(this._permitsAvailable&&this._permitsUsed>=this._permitsAvailable)throw new Error("Max permits acquired");this._permitsUsed++},release:function(){if(0===this._permitsUsed)throw new Error("All permits released");this._permitsUsed--},isLocked:function(){return this._permitsUsed>0},setAvailablePermits:function(e){if(this._permitsUsed>e)throw new Error("Available permits cannot be less than used permits");this._permitsAvailable=e}},n.BlockingQueue=function(){this._queue=[]},t.extend(n.BlockingQueue.prototype,n.Semaphore,{_class:"Backbone.BlockingQueue",_queue:null,add:function(e){this.isBlocked()?this._queue.push(e):e()},process:function(){var e=this._queue;for(this._queue=[];e&&e.length;)e.shift()()},block:function(){this.acquire()},unblock:function(){this.release(),this.isBlocked()||this.process()},isBlocked:function(){return this.isLocked()}}),n.Relational.eventQueue=new n.BlockingQueue,n.Store=function(){this._collections=[],this._reverseRelations=[],this._orphanRelations=[],this._subModels=[],this._modelScopes=[i]},t.extend(n.Store.prototype,n.Events,{_class:"Backbone.Store",initializeRelation:function(e,i,o){var r=t.isString(i.type)?n[i.type]||this.getObjectByName(i.type):i.type;r&&r.prototype instanceof n.Relation?new r(e,i,o):n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; missing or invalid relation type!",i)},addModelScope:function(e){this._modelScopes.push(e)},removeModelScope:function(e){this._modelScopes=t.without(this._modelScopes,e)},addSubModels:function(e,t){this._subModels.push({superModelType:t,subModels:e})},setupSuperModel:function(e){t.find(this._subModels,function(n){return t.find(n.subModels||[],function(t,i){var o=this.getObjectByName(t);return e===o?(n.superModelType._subModels[i]=e,e._superModel=n.superModelType,e._subModelTypeValue=i,e._subModelTypeAttribute=n.superModelType.prototype.subModelTypeAttribute,!0):void 0},this)},this)},addReverseRelation:function(e){var n=t.any(this._reverseRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&(this._reverseRelations.push(e),this._addRelation(e.model,e),this.retroFitRelation(e))},addOrphanRelation:function(e){var n=t.any(this._orphanRelations,function(n){return t.all(e||[],function(e,t){return e===n[t]})});!n&&e.model&&e.type&&this._orphanRelations.push(e)},processOrphanRelations:function(){t.each(this._orphanRelations.slice(0),function(e){var i=n.Relational.store.getObjectByName(e.relatedModel);i&&(this.initializeRelation(null,e),this._orphanRelations=t.without(this._orphanRelations,e))},this)},_addRelation:function(e,n){e.prototype.relations||(e.prototype.relations=[]),e.prototype.relations.push(n),t.each(e._subModels||[],function(e){this._addRelation(e,n)},this)},retroFitRelation:function(e){var t=this.getCollection(e.model,!1);t&&t.each(function(t){t instanceof e.model&&new e.type(t,e)},this)},getCollection:function(e,i){e instanceof n.RelationalModel&&(e=e.constructor);for(var o=e;o._superModel;)o=o._superModel;var r=t.find(this._collections,function(e){return e.model===o});return r||i===!1||(r=this._createCollection(o)),r},getObjectByName:function(n){var i=n.split("."),o=null;return t.find(this._modelScopes,function(n){return o=t.reduce(i||[],function(t,n){return t?t[n]:e},n),o&&o!==n?!0:void 0},this),o},_createCollection:function(e){var t;return e instanceof n.RelationalModel&&(e=e.constructor),e.prototype instanceof n.RelationalModel&&(t=new n.Collection,t.model=e,this._collections.push(t)),t},resolveIdForItem:function(e,i){var o=t.isString(i)||t.isNumber(i)?i:null;return null===o&&(i instanceof n.RelationalModel?o=i.id:t.isObject(i)&&(o=e.prototype._getNewId(i))),o||0===o||(o=null),o},find:function(e,t){var n=this.resolveIdForItem(e,t),i=this.getCollection(e);if(i){var o=i.get(n);if(o instanceof e)return o}return null},register:function(e){var t=this.getCollection(e);if(t){var n=e.collection;t.add(e),this.listenTo(e,"destroy",this.unregister,this),this.listenTo(e,"relational:unregister",this.unregister,this),e.collection=n}},checkId:function(e,t){var i=this.getCollection(e),o=i&&i.get(t);if(o&&e!==o)throw n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Duplicate id! Old RelationalModel=%o, new RelationalModel=%o",o,e),new Error("Cannot instantiate more than one Backbone.RelationalModel with the same id per type!")},update:function(e){var t=this.getCollection(e);t._onModelEvent("change:"+e.idAttribute,e,t),e.trigger("relational:change:id",e,t)},unregister:function(e,t,n){this.stopListening(e);var i=this.getCollection(e);i&&i.remove(e,n)},reset:function(){this.stopListening(),this._collections=[],this._subModels=[],this._modelScopes=[i]}}),n.Relational.store=new n.Store,n.Relation=function(e,i,o){if(this.instance=e,i=t.isObject(i)?i:{},this.reverseRelation=t.defaults(i.reverseRelation||{},this.options.reverseRelation),this.options=t.defaults(i,this.options,n.Relation.prototype.options),this.reverseRelation.type=t.isString(this.reverseRelation.type)?n[this.reverseRelation.type]||n.Relational.store.getObjectByName(this.reverseRelation.type):this.reverseRelation.type,this.key=this.options.key,this.keySource=this.options.keySource||this.key,this.keyDestination=this.options.keyDestination||this.keySource||this.key,this.model=this.options.model||this.instance.constructor,this.relatedModel=this.options.relatedModel,t.isString(this.relatedModel)&&(this.relatedModel=n.Relational.store.getObjectByName(this.relatedModel)),this.checkPreconditions()&&(!this.options.isAutoRelation&&this.reverseRelation.type&&this.reverseRelation.key&&n.Relational.store.addReverseRelation(t.defaults({isAutoRelation:!0,model:this.relatedModel,relatedModel:this.model,reverseRelation:this.options},this.reverseRelation)),e)){var r=this.keySource;r!==this.key&&"object"==typeof this.instance.get(this.key)&&(r=this.key),this.setKeyContents(this.instance.get(r)),this.relatedCollection=n.Relational.store.getCollection(this.relatedModel),this.keySource!==this.key&&delete this.instance.attributes[this.keySource],this.instance._relations[this.key]=this,this.initialize(o),this.options.autoFetch&&this.instance.fetchRelated(this.key,t.isObject(this.options.autoFetch)?this.options.autoFetch:{}),this.listenTo(this.instance,"destroy",this.destroy).listenTo(this.relatedCollection,"relational:add relational:change:id",this.tryAddRelated).listenTo(this.relatedCollection,"relational:remove",this.removeRelated)}},n.Relation.extend=n.Model.extend,t.extend(n.Relation.prototype,n.Events,n.Semaphore,{_class:"Backbone.Relation",options:{createModels:!0,includeInJSON:!0,isAutoRelation:!1,autoFetch:!1,parse:!1},instance:null,key:null,keyContents:null,relatedModel:null,relatedCollection:null,reverseRelation:null,related:null,checkPreconditions:function(){var e=this.instance,i=this.key,o=this.model,r=this.relatedModel,s=n.Relational.showWarnings&&"undefined"!=typeof console;if(!o||!i||!r)return s&&console.warn("Relation=%o: missing model, key or relatedModel (%o, %o, %o).",this,o,i,r),!1;if(!(o.prototype instanceof n.RelationalModel))return s&&console.warn("Relation=%o: model does not inherit from Backbone.RelationalModel (%o).",this,e),!1;if(!(r.prototype instanceof n.RelationalModel))return s&&console.warn("Relation=%o: relatedModel does not inherit from Backbone.RelationalModel (%o).",this,r),!1;if(this instanceof n.HasMany&&this.reverseRelation.type===n.HasMany)return s&&console.warn("Relation=%o: relation is a HasMany, and the reverseRelation is HasMany as well.",this),!1;if(e&&t.keys(e._relations).length){var a=t.find(e._relations,function(e){return e.key===i},this);if(a)return s&&console.warn("Cannot create relation=%o on %o for model=%o: already taken by relation=%o.",this,i,e,a),!1}return!0},setRelated:function(e){this.related=e,this.instance.acquire(),this.instance.attributes[this.key]=e,this.instance.release()},_isReverseRelation:function(e){return e.instance instanceof this.relatedModel&&this.reverseRelation.key===e.key&&this.key===e.reverseRelation.key
},getReverseRelations:function(e){var n=[],i=t.isUndefined(e)?this.related&&(this.related.models||[this.related]):[e];return t.each(i||[],function(e){t.each(e.getRelations()||[],function(e){this._isReverseRelation(e)&&n.push(e)},this)},this),n},destroy:function(){this.stopListening(),this instanceof n.HasOne?this.setRelated(null):this instanceof n.HasMany&&this.setRelated(this._prepareCollection()),t.each(this.getReverseRelations(),function(e){e.removeRelated(this.instance)},this)}}),n.HasOne=n.Relation.extend({_class:"Backbone.HasOne",options:{reverseRelation:{type:"HasMany"}},initialize:function(e){this.listenTo(this.instance,"relational:change:"+this.key,this.onChange);var n=this.findRelated(e);this.setRelated(n),t.each(this.getReverseRelations(),function(t){t.addRelated(this.instance,e)},this)},findRelated:function(e){var n=null;if(e=t.defaults({parse:this.options.parse},e),this.keyContents instanceof this.relatedModel)n=this.keyContents;else if(this.keyContents||0===this.keyContents){var i=t.defaults({create:this.options.createModels},e);n=this.relatedModel.findOrCreate(this.keyContents,i)}return this.related&&(this.keyId=null),n},setKeyContents:function(e){this.keyContents=e,this.keyId=n.Relational.store.resolveIdForItem(this.relatedModel,this.keyContents)},onChange:function(e,i,o){if(!this.isLocked()){this.acquire(),o=o?t.clone(o):{};var r=t.isUndefined(o.__related),s=r?this.related:o.__related;if(r){this.setKeyContents(i);var a=this.findRelated(o);this.setRelated(a)}if(s&&this.related!==s&&t.each(this.getReverseRelations(s),function(e){e.removeRelated(this.instance,null,o)},this),t.each(this.getReverseRelations(),function(e){e.addRelated(this.instance,o)},this),!o.silent&&this.related!==s){var l=this;this.changed=!0,n.Relational.eventQueue.add(function(){l.instance.trigger("change:"+l.key,l.instance,l.related,o,!0),l.changed=!1})}this.release()}},tryAddRelated:function(e,t,n){!this.keyId&&0!==this.keyId||e.id!==this.keyId||(this.addRelated(e,n),this.keyId=null)},addRelated:function(e,n){var i=this;e.queue(function(){if(e!==i.related){var o=i.related||null;i.setRelated(e),i.onChange(i.instance,e,t.defaults({__related:o},n))}})},removeRelated:function(e,n,i){if(this.related&&e===this.related){var o=this.related||null;this.setRelated(null),this.onChange(this.instance,e,t.defaults({__related:o},i))}}}),n.HasMany=n.Relation.extend({_class:"Backbone.HasMany",collectionType:null,options:{reverseRelation:{type:"HasOne"},collectionType:n.Collection,collectionKey:!0,collectionOptions:{}},initialize:function(e){if(this.listenTo(this.instance,"relational:change:"+this.key,this.onChange),this.collectionType=this.options.collectionType,t.isString(this.collectionType)&&(this.collectionType=n.Relational.store.getObjectByName(this.collectionType)),this.collectionType!==n.Collection&&!(this.collectionType.prototype instanceof n.Collection))throw new Error("`collectionType` must inherit from Backbone.Collection");var i=this.findRelated(e);this.setRelated(i)},_prepareCollection:function(e){if(this.related&&this.stopListening(this.related),!(e&&e instanceof n.Collection)){var i=t.isFunction(this.options.collectionOptions)?this.options.collectionOptions(this.instance):this.options.collectionOptions;e=new this.collectionType(null,i)}if(e.model=this.relatedModel,this.options.collectionKey){var o=this.options.collectionKey===!0?this.options.reverseRelation.key:this.options.collectionKey;e[o]&&e[o]!==this.instance?n.Relational.showWarnings&&"undefined"!=typeof console&&console.warn("Relation=%o; collectionKey=%s already exists on collection=%o",this,o,this.options.collectionKey):o&&(e[o]=this.instance)}return this.listenTo(e,"relational:add",this.handleAddition).listenTo(e,"relational:remove",this.handleRemoval).listenTo(e,"relational:reset",this.handleReset),e},findRelated:function(e){var i=null;if(e=t.defaults({parse:this.options.parse},e),this.keyContents instanceof n.Collection)this._prepareCollection(this.keyContents),i=this.keyContents;else{var o=[];t.each(this.keyContents,function(n){if(n instanceof this.relatedModel)var i=n;else i=this.relatedModel.findOrCreate(n,t.extend({merge:!0},e,{create:this.options.createModels}));i&&o.push(i)},this),i=this.related instanceof n.Collection?this.related:this._prepareCollection(),i.set(o,t.defaults({merge:!1,parse:!1},e))}return this.keyIds=t.difference(this.keyIds,t.pluck(i.models,"id")),i},setKeyContents:function(e){this.keyContents=e instanceof n.Collection?e:null,this.keyIds=[],this.keyContents||!e&&0!==e||(this.keyContents=t.isArray(e)?e:[e],t.each(this.keyContents,function(e){var t=n.Relational.store.resolveIdForItem(this.relatedModel,e);(t||0===t)&&this.keyIds.push(t)},this))},onChange:function(e,i,o){o=o?t.clone(o):{},this.setKeyContents(i),this.changed=!1;var r=this.findRelated(o);if(this.setRelated(r),!o.silent){var s=this;n.Relational.eventQueue.add(function(){s.changed&&(s.instance.trigger("change:"+s.key,s.instance,s.related,o,!0),s.changed=!1)})}},handleAddition:function(e,i,o){o=o?t.clone(o):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.addRelated(this.instance,o)},this);var r=this;!o.silent&&n.Relational.eventQueue.add(function(){r.instance.trigger("add:"+r.key,e,r.related,o)})},handleRemoval:function(e,i,o){o=o?t.clone(o):{},this.changed=!0,t.each(this.getReverseRelations(e),function(e){e.removeRelated(this.instance,null,o)},this);var r=this;!o.silent&&n.Relational.eventQueue.add(function(){r.instance.trigger("remove:"+r.key,e,r.related,o)})},handleReset:function(e,i){var o=this;i=i?t.clone(i):{},!i.silent&&n.Relational.eventQueue.add(function(){o.instance.trigger("reset:"+o.key,o.related,i)})},tryAddRelated:function(e,n,i){var o=t.contains(this.keyIds,e.id);o&&(this.addRelated(e,i),this.keyIds=t.without(this.keyIds,e.id))},addRelated:function(e,n){var i=this;e.queue(function(){i.related&&!i.related.get(e)&&i.related.add(e,t.defaults({parse:!1},n))})},removeRelated:function(e,t,n){this.related.get(e)&&this.related.remove(e,n)}}),n.RelationalModel=n.Model.extend({_class:"Backbone.RelationalModel",relations:null,_relations:null,_isInitialized:!1,_deferProcessing:!1,_queue:null,_attributeChangeFired:!1,subModelTypeAttribute:"type",subModelTypes:null,keydefs:{},compoundKeyDelim:"-",constructor:function(e,i){if(i&&i.collection){var o=this,r=this.collection=i.collection;delete i.collection,this._deferProcessing=!0;var s=function(e){e===o&&(o._deferProcessing=!1,o.processQueue(),r.off("relational:add",s))};r.on("relational:add",s),t.defer(function(){s(o)})}n.Relational.store.processOrphanRelations(),this._queue=new n.BlockingQueue,this._queue.block(),n.Relational.eventQueue.block();try{n.Model.apply(this,arguments)}finally{n.Relational.eventQueue.unblock()}this.createSavepoint(),this.on("sync",this.createSavepoint,this)},createSavepoint:function(){return this.savepoint=JSON.parse(JSON.stringify(this)),this},rollback:function(e){e=e||{},this.set(this.savepoint),this.changed=[],e.silent||this.trigger("rollback",this,e)},commit:function(e){e=e||{};var i=this,o=i.isNew(),r=[],s=[];return(o||i.hasChangedDeepSinceSavepoint())&&(o||i.relations.each(function(t){if(t.includeInJSON&&(r.push(t),t.includeInJSON=!1,!t.isAutoRelation)){var n=i.get(t.key);s.push(n.commit(e))}}),s.push(i.save(null,e)),t.each(r,function(e){e.includeInJSON=!0}),e.silent||i.trigger("commit",i,e)),n.$.when.apply(n.$,s)},hasChangedDeepSinceSavepoint:function(){return!t.isEqual(this.toJSON(),this.savepoint)},trigger:function(e){if(e.length>5&&0===e.indexOf("change")){var t=this,i=arguments;n.Relational.eventQueue.add(function(){if(t._isInitialized){var o=!0;if("change"===e)o=t.hasChanged()||t._attributeChangeFired,t._attributeChangeFired=!1;else{var r=e.slice(7),s=t.getRelation(r);s?(o=i[4]===!0,o?t.changed[r]=i[2]:s.changed||delete t.changed[r]):o&&(t._attributeChangeFired=!0)}o&&n.Model.prototype.trigger.apply(t,i)}})}else n.Model.prototype.trigger.apply(this,arguments);return this},initializeRelations:function(e){this.acquire(),this._relations={},t.each(this.relations||[],function(t){n.Relational.store.initializeRelation(this,t,e)},this),this._isInitialized=!0,this.release(),this.processQueue()},updateRelations:function(e){this._isInitialized&&!this.isLocked()&&t.each(this._relations,function(t){var n=this.attributes[t.keySource]||this.attributes[t.key];t.related!==n&&this.trigger("relational:change:"+t.key,this,n,e||{}),t.keySource!==t.key&&delete t.instance.attributes[t.keySource]},this)},queue:function(e){this._queue.add(e)},processQueue:function(){this._isInitialized&&!this._deferProcessing&&this._queue.isBlocked()&&this._queue.unblock()},getRelation:function(e){return this._relations[e]},getRelations:function(){return t.values(this._relations)},fetchRelated:function(e,i,o){i=t.extend({update:!0,remove:!1},i);var r,s=[],a=this.getRelation(e),l=a&&(a.keyIds&&a.keyIds.slice(0)||(a.keyId||0===a.keyId?[a.keyId]:[]));if(o){var c=a.related instanceof n.Collection?a.related.models:[a.related];t.each(c,function(e){(e.id||0===e.id)&&l.push(e.id)})}if(l&&l.length){var d=[],c=t.map(l,function(e){var t=n.Relational.store.find(a.relatedModel,e);if(!t){var o={};o[a.relatedModel.prototype.idAttribute]=e,t=a.relatedModel.findOrCreate(o,i),d.push(t)}return t},this);if(a.related instanceof n.Collection&&t.isFunction(a.related.url)&&(r=a.related.url(c)),r&&r!==a.related.url()){var u=t.defaults({error:function(){var e=arguments;t.each(d,function(t){t.trigger("destroy",t,t.collection,i),i.error&&i.error.apply(t,e)})},url:r},i);s=[a.related.fetch(u)]}else s=t.map(c,function(e){var n=t.defaults({error:function(){t.contains(d,e)&&(e.trigger("destroy",e,e.collection,i),i.error&&i.error.apply(e,arguments))}},i);return e.fetch(n)},this)}return s},get:function(i){var o=n.Model.prototype.get.call(this,i);if(!this.dotNotation||-1===i.indexOf("."))return o;var r=i.split("."),s=t.reduce(r,function(i,o){if(t.isNull(i)||t.isUndefined(i))return e;if(i instanceof n.Model)return n.Model.prototype.get.call(i,o);if(i instanceof n.Collection)return n.Collection.prototype.at.call(i,o);throw new Error("Attribute must be an instanceof Backbone.Model or Backbone.Collection. Is: "+i+", currentSplit: "+o)},this);if(o!==e&&s!==e)throw new Error("Ambiguous result for '"+i+"'. direct result: "+o+", dotNotation: "+s);return o||s},_getNewId:function(e){var t,n=this,i=null,o="",r=!1,s=n.keydefs.PRIMARY;return s&&(s.forEach(function(i){t=e[i]||n.attributes&&n.attributes[i],t||0===t?o+=(o?n.compoundKeyDelim:"")+(e[i]||n.attributes&&n.attributes[i]):r=!0}),r||(i=o)),i||(i=e&&n.idAttribute in e&&e[n.idAttribute]),i},set:function(e,i,o){n.Relational.eventQueue.block();var r;t.isObject(e)||null==e?(r=e,o=i):(r={},r[e]=i);try{var s=this.id,a=this._getNewId(r);n.Relational.store.checkId(this,a);var l=n.Model.prototype.set.apply(this,arguments);a&&(this.id=a),this._isInitialized||this.isLocked()?a&&a!==s&&n.Relational.store.update(this):(this.constructor.initializeModelHierarchy(),n.Relational.store.register(this),this.initializeRelations(o)),r&&this.updateRelations(o)}finally{n.Relational.eventQueue.unblock()}return l},clone:function(){var e=t.clone(this.attributes);return t.isUndefined(e[this.idAttribute])||(e[this.idAttribute]=null),t.each(this.getRelations(),function(t){delete e[t.key]}),new this.constructor(e)},toJSON:function(e){if(this.isLocked())return this.id;this.acquire();var i=n.Model.prototype.toJSON.call(this,e);return!this.constructor._superModel||this.constructor._subModelTypeAttribute in i||(i[this.constructor._subModelTypeAttribute]=this.constructor._subModelTypeValue),t.each(this._relations,function(o){var r=i[o.key],s=o.options.includeInJSON,a=null;s===!0?r&&t.isFunction(r.toJSON)&&(a=r.toJSON(e)):t.isString(s)?(r instanceof n.Collection?a=r.pluck(s):r instanceof n.Model&&(a=r.get(s)),s===o.relatedModel.prototype.idAttribute&&(o instanceof n.HasMany?a=a.concat(o.keyIds):o instanceof n.HasOne&&(a=a||o.keyId))):t.isArray(s)?r instanceof n.Collection?(a=[],r.each(function(e){var n={};t.each(s,function(t){n[t]=e.get(t)}),a.push(n)})):r instanceof n.Model&&(a={},t.each(s,function(e){a[e]=r.get(e)})):delete i[o.key],s&&(i[o.keyDestination]=a),o.keyDestination!==o.key&&delete i[o.key]}),this.release(),i}},{setup:function(){return this.prototype.relations=(this.prototype.relations||[]).slice(0),this._subModels={},this._superModel=null,this.prototype.hasOwnProperty("subModelTypes")?n.Relational.store.addSubModels(this.prototype.subModelTypes,this):this.prototype.subModelTypes=null,t.each(this.prototype.relations||[],function(e){if(e.model||(e.model=this),e.reverseRelation&&e.model===this){var i=!0;if(t.isString(e.relatedModel)){var o=n.Relational.store.getObjectByName(e.relatedModel);i=o&&o.prototype instanceof n.RelationalModel}i?n.Relational.store.initializeRelation(null,e):t.isString(e.relatedModel)&&n.Relational.store.addOrphanRelation(e)}},this),this},build:function(e,t){this.initializeModelHierarchy();var n=this._findSubModelType(this,e)||this;return new n(e,t)},_findSubModelType:function(e,t){if(e._subModels&&e.prototype.subModelTypeAttribute in t){var n=t[e.prototype.subModelTypeAttribute],i=e._subModels[n];if(i)return i;for(n in e._subModels)if(i=this._findSubModelType(e._subModels[n],t))return i}return null},initializeModelHierarchy:function(){if(this.inheritRelations(),this.prototype.subModelTypes){var e=t.keys(this._subModels),i=t.omit(this.prototype.subModelTypes,e);t.each(i,function(e){var t=n.Relational.store.getObjectByName(e);t&&t.initializeModelHierarchy()})}},inheritRelations:function(){if(t.isUndefined(this._superModel)||t.isNull(this._superModel))if(n.Relational.store.setupSuperModel(this),this._superModel){if(this._superModel.inheritRelations(),this._superModel.prototype.relations){var e=t.select(this._superModel.prototype.relations||[],function(e){return!t.any(this.prototype.relations||[],function(t){return e.relatedModel===t.relatedModel&&e.key===t.key},this)},this);this.prototype.relations=e.concat(this.prototype.relations)}}else this._superModel=!1},findOrCreate:function(e,i){i||(i={});var o=t.isObject(e)&&i.parse&&this.prototype.parse?this.prototype.parse(t.clone(e)):e,r=n.Relational.store.find(this,o);return t.isObject(e)&&(r&&i.merge!==!1?(delete i.collection,delete i.url,r.set(o,i)):r||i.create===!1||(r=this.build(e,i))),r},find:function(e,t){return t||(t={}),t.create=!1,this.findOrCreate(e,t)}}),t.extend(n.RelationalModel.prototype,n.Semaphore);var o=n.Collection.prototype.__initialize=n.Collection.prototype.initialize;n.Collection.prototype.initialize=function(){o.apply(this,arguments),this.createSavepoint(),this.on("sync",this.createSavepoint,this)},n.Collection.prototype.createSavepoint=function(){return this._added=[],this._removed=[],this},n.Collection.prototype.rollback=function(e){return e=e||{},this.add(this._removed,{silent:!0}),t.each(this.models,function(e){e.rollback()}),this.remove(this._added,{silent:!0}),this.createSavepoint(),e.silent||this.trigger("rollback",this,e),this},n.Collection.prototype.hasChangedDeepSinceSavepoint=function(){return this._removed.length||this._added.length?!0:!!t.find(this.models,function(e){return e.hasChangedDeepSinceSavepoint()})},n.Collection.prototype.commit=function(e){var i=[];return this.hasChangedDeepSinceSavepoint()&&(e=e||{},t.each(this._removed,function(e){i.push(e.destroy())}),t.each(this.models,function(e){i.push(e.commit())}),this.createSavepoint(),e.silent||this.trigger("commit",this,e)),n.$.when.apply(n.$,i)},n.Collection.prototype._class="Backbone.Collection",n.Collection.prototype.__prepareModel=n.Collection.prototype._prepareModel,n.Collection.prototype._prepareModel=function(e,t){var i;return e instanceof n.Model?(e.collection||(e.collection=this),i=e):(t||(t={}),t.collection=this,i="undefined"!=typeof this.model.findOrCreate?this.model.findOrCreate(e,t):new this.model(e,t),i&&i.isNew()&&!i._validate(e,t)&&(this.trigger("invalid",this,e,t),i=!1)),i};var r=n.Collection.prototype.__set=n.Collection.prototype.set;n.Collection.prototype.set=function(e,i){if(!(this.model.prototype instanceof n.RelationalModel))return r.apply(this,arguments);i&&i.parse&&(e=this.parse(e,i)),t.isArray(e)||(e=e?[e]:[]);var o=[],s=[];return t.each(e,function(e){e instanceof n.Model||(e=n.Collection.prototype._prepareModel.call(this,e,i)),e&&(s.push(e),this.get(e)||this.get(e.cid)?null!=e.id&&(this._byId[e.id]=e):o.push(e))},this),r.call(this,s,t.defaults({parse:!1},i)),t.each(o,function(e){(this.get(e)||this.get(e.cid))&&this.trigger("relational:add",e,this,i)},this),this};var s=n.Collection.prototype.__get=n.Collection.prototype.get;n.Collection.prototype.get=function(e){if(!(this.model.prototype instanceof n.RelationalModel))return s.apply(this,arguments);if(null==e)return void 0;var t=n.Relational.store.resolveIdForItem(this.model,e);return this._byId[null!=t?t:e.cid||e]};var a=n.Collection.prototype.__add=n.Collection.prototype.add;n.Collection.prototype.add=function(e,i){if(e=t.isArray(e)?e.slice(0):[e],!(this.model.prototype instanceof n.RelationalModel))return a.apply(this,arguments);var o=this.set(e,t.defaults(i||{},{add:!0,merge:!1,remove:!1}));return this._added=this._added.concat(e),o};var l=n.Collection.prototype.__remove=n.Collection.prototype.remove;n.Collection.prototype.remove=function(e,i){if(e=t.isArray(e)?e.slice(0):[e],!(this.model.prototype instanceof n.RelationalModel))return this._removed=this._removed.concat(e),l.apply(this,arguments);i||(i={});var o=[];return t.each(e,function(e){e=this.get(e)||e&&this.get(e.cid),e&&o.push(e)},this),o.length&&(l.call(this,o,i),t.each(o,function(e){this.trigger("relational:remove",e,this,i)},this),this._removed=this._removed.concat(o)),this};var c=n.Collection.prototype.__reset=n.Collection.prototype.reset;n.Collection.prototype.reset=function(e,i){return i=t.extend({merge:!0},i),c.call(this,e,i),this._added=[],this._removed=[],this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,i),this.createSavepoint(),this};var d=n.Collection.prototype.__sort=n.Collection.prototype.sort;n.Collection.prototype.sort=function(e){return d.call(this,e),this.model.prototype instanceof n.RelationalModel&&this.trigger("relational:reset",this,e),this};var u=n.Collection.prototype.__trigger=n.Collection.prototype.trigger;n.Collection.prototype.trigger=function(e){if(!(this.model.prototype instanceof n.RelationalModel))return u.apply(this,arguments);if("add"===e||"remove"===e||"reset"===e||"sort"===e){var i=this,o=arguments;t.isObject(o[3])&&(o=t.toArray(o),o[3]=t.clone(o[3])),n.Relational.eventQueue.add(function(){u.apply(i,o)})}else u.apply(this,arguments);return this},n.RelationalModel.extend=function(){var e=n.Model.extend.apply(this,arguments);return e.setup(this),e}}(),_wAMD.define("vendor/backbone-relational",["backbone"],function(){}),Backbone.Validation=function(e){var t={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},n={formatLabel:function(e,n){return l[t.labelFormatter](e,n)},format:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return t.replace(/\{(\d+)\}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})}},i=function(t,n,o){return n=n||{},o=o||"",e.each(t,function(e,r){t.hasOwnProperty(r)&&(!e||"object"!=typeof e||e instanceof Date||e instanceof RegExp||e instanceof Backbone.Model||e instanceof Backbone.Collection?n[o+r]=e:i(e,n,o+r+"."))}),n},o=function(){var o=function(t){return e.reduce(e.keys(t.validation||{}),function(e,t){return e[t]=void 0,e},{})},s=function(t,n){var i=t.validation?t.validation[n]||{}:{};return(e.isFunction(i)||e.isString(i))&&(i={fn:i}),e.isArray(i)||(i=[i]),e.reduce(i,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:c[e],val:n[e],msg:n.msg})}),t},[])},a=function(t,i,o,r){return e.reduce(s(t,i),function(s,a){var l=e.extend({},n,c),d=a.fn.call(l,o,i,a.val,t,r);return d===!1||s===!1?!1:d&&!s?a.msg||d:s},"")},l=function(t,n){var o,r={},s=!0,l=e.clone(n),c=i(n);return e.each(c,function(e,n){o=a(t,n,e,l),o&&(r[n]=o,s=!1)}),{invalidAttrs:r,isValid:s}},d=function(t,n){return{preValidate:function(t,n){return a(this,t,n,e.extend({},this.attributes))},isValid:function(t){var n=i(this.attributes);return e.isString(t)?!a(this,t,n[t],e.extend({},this.attributes)):e.isArray(t)?e.reduce(t,function(t,i){return t&&!a(this,i,n[i],e.extend({},this.attributes))},!0,this):(t===!0&&this.validate(),this.validation?this._isValid:!0)},validate:function(r,s){var a=this,c=!r,d=e.extend({},n,s),u=o(a),h=e.extend({},u,a.attributes,r),p=i(r||h),f=l(a,h);return a._isValid=f.isValid,e.each(u,function(e,n){var i=f.invalidAttrs.hasOwnProperty(n);i||d.valid(t,n,d.selector)}),e.each(u,function(e,n){var i=f.invalidAttrs.hasOwnProperty(n),o=p.hasOwnProperty(n);i&&(o||c)&&d.invalid(t,n,f.invalidAttrs[n],d.selector)}),e.defer(function(){a.trigger("validated",a._isValid,a,f.invalidAttrs),a.trigger("validated:"+(a._isValid?"valid":"invalid"),a,f.invalidAttrs)}),!d.forceUpdate&&e.intersection(e.keys(f.invalidAttrs),e.keys(p)).length>0?f.invalidAttrs:void 0}}},u=function(t,n,i){e.extend(n,d(t,i))},h=function(e){delete e.validate,delete e.preValidate,delete e.isValid},p=function(e){u(this.view,e,this.options)},f=function(e){h(e)};return{version:"0.8.0",configure:function(n){e.extend(t,n)},bind:function(n,i){var o=n.model,s=n.collection;if(i=e.extend({},t,r,i),"undefined"==typeof o&&"undefined"==typeof s)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";o?u(n,o,i):s&&(s.each(function(e){u(n,e,i)}),s.bind("add",p,{view:n,options:i}),s.bind("remove",f))},unbind:function(e){var t=e.model,n=e.collection;t&&h(e.model),n&&(n.each(function(e){h(e)}),n.unbind("add",p),n.unbind("remove",f))},mixin:d(null,t)}}(),r=o.callbacks={valid:function(e,t,n){e.$("["+n+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(e,t,n,i){e.$("["+i+'~="'+t+'"]').addClass("invalid").attr("data-error",n)}},s=o.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},a=o.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}"},l=o.labelFormatters={none:function(e){return e},sentenceCase:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toUpperCase():" "+e.toLowerCase()}).replace("_"," ")},label:function(e,t){return t.labels&&t.labels[e]||l.sentenceCase(e,t)}},c=o.validators=function(){var t=String.prototype.trim?function(e){return null===e?"":String.prototype.trim.call(e)}:function(e){var t=/^\s+/,n=/\s+$/;return null===e?"":e.toString().replace(t,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(s.number)},i=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n))};return{fn:function(t,n,i,o,r){return e.isString(i)&&(i=o[i]),i.call(o,t,n,r)},required:function(t,n,o,r,s){var l=e.isFunction(o)?o.call(r,t,n,s):o;return l||i(t)?l&&!i(t)?this.format(a.required,this.formatLabel(n,r)):void 0:!1},acceptance:function(t,n,i,o){return"true"===t||e.isBoolean(t)&&t!==!1?void 0:this.format(a.acceptance,this.formatLabel(n,o))},min:function(e,t,i,o){return!n(e)||i>e?this.format(a.min,this.formatLabel(t,o),i):void 0},max:function(e,t,i,o){return!n(e)||e>i?this.format(a.max,this.formatLabel(t,o),i):void 0},range:function(e,t,i,o){return!n(e)||e<i[0]||e>i[1]?this.format(a.range,this.formatLabel(t,o),i[0],i[1]):void 0},length:function(e,n,o,r){return i(e)&&t(e).length===o?void 0:this.format(a.length,this.formatLabel(n,r),o)},minLength:function(e,n,o,r){return!i(e)||t(e).length<o?this.format(a.minLength,this.formatLabel(n,r),o):void 0},maxLength:function(e,n,o,r){return!i(e)||t(e).length>o?this.format(a.maxLength,this.formatLabel(n,r),o):void 0},rangeLength:function(e,n,o,r){return!i(e)||t(e).length<o[0]||t(e).length>o[1]?this.format(a.rangeLength,this.formatLabel(n,r),o[0],o[1]):void 0},oneOf:function(t,n,i,o){return e.include(i,t)?void 0:this.format(a.oneOf,this.formatLabel(n,o),i.join(", "))},equalTo:function(e,t,n,i,o){return e!==o[n]?this.format(a.equalTo,this.formatLabel(t,i),this.formatLabel(n,i)):void 0},pattern:function(e,t,n,o){return i(e)&&e.toString().match(s[n]||n)?void 0:this.format(a.pattern,this.formatLabel(t,o),n)}}}();return o}(_),_wAMD.define("vendor/backbone-validation",["backbone"],function(){}),function(e){var t;return e.event.fix=function(e){return function(t){return t=e.apply(this,arguments),(0===t.type.indexOf("copy")||0===t.type.indexOf("paste"))&&(t.clipboardData=t.originalEvent.clipboardData),t}}(e.event.fix),t={callback:e.noop,matchType:/image.*/},e.fn.pasteImageReader=function(n){return"function"==typeof n&&(n={callback:n}),n=e.extend({},t,n),this.each(function(){var t,i;return i=this,t=e(this),t.bind("paste",function(e){var t,o;return o=!1,t=e.clipboardData?e.clipboardData:!1,t!==!1?Array.prototype.forEach.call(t.types,function(e,r){var s,a;if(!o)return e.match(n.matchType)||t.items[r].type.match(n.matchType)?(s=t.items[r].getAsFile(),a=new FileReader,a.onload=function(e){return n.callback.call(i,{dataURL:e.target.result,event:e,file:s,name:s.name})},a.readAsDataURL(s),o=!0):void 0}):void 0})})}}(jQuery),_wAMD.define("vendor/jquery.pasteImageReader",function(){}),function(e){function t(e){for(var t=1;t<arguments.length;t++)e=e.replace("%"+(t-1),arguments[t]);return e}function n(n,i){var o,r,s,a,l,c,d,u,h=e("img:first",n),p=h,f=null,m=null,g=null,v=null,y=null,b=null,w=0,_=0,C=0,x=0,S=0,E=0,k=0,T=this;setTimeout(function(){if(null===m){var e=n.width();n.parent().append(t('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center" class="cloud-zoom-loading" >Loading...</div>',e/3,e/2-e/6)).find(":last").css("opacity",.5)}},200);var P=function(){null!==b&&(b.remove(),b=null)};this.removeBits=function(){g&&(g.remove(),g=null),v&&(v.remove(),v=null),y&&(y.remove(),y=null),P(),e(".cloud-zoom-loading",n.parent()).remove()},this.destroy=function(){n.data("zoom",null),m&&(m.unbind(),m.remove(),m=null),f&&(f.remove(),f=null),this.removeBits()},this.fadedOut=function(){f&&(f.remove(),f=null),this.removeBits()},this.controlLoop=function(){if(g){var e=c-p.offset().left-.5*a>>0,t=d-p.offset().top-.5*l>>0;0>e?e=0:e>p.outerWidth()-a&&(e=p.outerWidth()-a),0>t?t=0:t>p.outerHeight()-l&&(t=p.outerHeight()-l),g.css({left:e,top:t}),g.css("background-position",-e+"px "+-t+"px"),C=e/p.outerWidth()*s.width>>0,x=t/p.outerHeight()*s.height>>0,E+=(C-E)/i.smoothMove,S+=(x-S)/i.smoothMove,f.css("background-position",-(E>>0)+"px "+(-(S>>0)+"px"))}w=setTimeout(function(){T.controlLoop()},30)},this.init2=function(e,t){k++,1===t&&(s=e),2===k&&this.init()},this.init=function(){e(".cloud-zoom-loading",n.parent()).remove(),m=e(".mousetrap",n.parent()),m&&(m.unbind(),m.remove()),m=n.parent().append(t("<div class='mousetrap' style='background-image:url(\"//"+ASSETS_BASE+"/images/blank.gif\");z-index:2;position:absolute;width:%0px;height:%1px;left:%2px;top:%3px;'></div>",p.outerWidth(),p.outerHeight(),0,0)).find(":last"),m.bind("mousemove",this,function(e){c=e.pageX,d=e.pageY}),m.bind("mouseleave",this,function(){return clearTimeout(w),clearTimeout(_),g&&g.fadeOut(299),v&&v.fadeOut(299),y&&y.fadeOut(299),f&&f.fadeOut(300,function(){T.fadedOut()}),!1});var o=n.attr("href"),r=n.find("img").attr("src");o!=r&&m.bind("mouseenter",this,function(o){_=setTimeout(function(){u=o.data,f&&(f.stop(!0,!1),f.remove());var r=i.adjustX,c=i.adjustY,d=p.outerWidth(),w=p.outerHeight(),_=i.zoomWidth,C=i.zoomHeight;"auto"==i.zoomWidth&&(_=d),"auto"==i.zoomHeight&&(C=w);var x=n.parent();switch(i.position){case"top":c-=C;break;case"right":r+=d;break;case"bottom":c+=w;break;case"left":r-=_;break;case"inside":_=d,C=w;break;default:x=e("#"+i.position),x.length?(_=x.innerWidth(),C=x.innerHeight()):(x=n,r+=d,c+=w)}f=x.append(t('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:1;"></div>',r,c,_,C,s.src)).find(":last"),h.attr("title")&&i.showTitle&&f.append(t('<div class="cloud-zoom-title">%0</div>',h.attr("title"))).find(":last").css("opacity",i.titleOpacity),e.browser.msie&&e.browser.version<7&&(b=e('<iframe frameborder="0" src="#"></iframe>').css({position:"absolute",left:r,top:c,zIndex:1,width:_,height:C}).insertBefore(f)),f.fadeIn(500),g&&(g.remove(),g=null),a=p.outerWidth()/s.width*f.width(),l=p.outerHeight()/s.height*f.height(),g=n.append(t("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'></div>",a,l)).find(":last"),m.css("cursor",g.css("cursor"));var S=!1;i.tint&&(g.css("background",'url("'+h.attr("src")+'")'),v=n.append(t('<div style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',p.outerWidth(),p.outerHeight(),i.tint)).find(":last"),v.css("opacity",i.tintOpacity),S=!0,v.fadeIn(500)),i.softFocus&&(g.css("background",'url("'+h.attr("src")+'")'),y=n.append(t('<div style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',p.outerWidth()-2,p.outerHeight()-2,i.tint)).find(":last"),y.css("background",'url("'+h.attr("src")+'")'),y.css("opacity",.5),S=!0,y.fadeIn(500)),S||g.css("opacity",i.lensOpacity),"inside"!==i.position&&g.fadeIn(500),u.controlLoop()},250)})},o=new Image,e(o).load(function(){T.init2(this,0)}),o.src=h.attr("src"),r=new Image,e(r).load(function(){T.init2(this,1)
}),r.src=n.attr("href")}e.fn.CloudZoom=function(t){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(i){}return this.each(function(){var i,o=e(this);if(o.is(".cloud-zoom")){o.css({position:"relative",display:"block"}),e("img",o).css({display:"block"}),"cloudzoom-wrap"!=e(this).parent().attr("id")&&e(this).wrap('<div id="cloudzoom-wrap" style="top:0px;position:relative;"></div>'),i=e.extend({},e.fn.CloudZoom.defaults,t);var r={adjustX:"int",adjustY:"int",zoomWidth:"int",zoomHeight:"int",position:"string",tint:"string",tintOpacity:"float",lensOpacity:"float",softFocus:"bool",smoothMove:"int",showTitle:"bool",titleOpacity:"float"};for(var s in r){var a=e(this).attr("data-"+s);if(a)switch(r[s]){case"int":case"float":i[s]=Number(a);break;case"bool":i[s]=Boolean(a);break;case"string":default:i[s]=a}}e(this).data("zoom",new n(e(this),i))}else e(this).is(".cloud-zoom-gallery")&&(i=e.extend({},{useZoom:e(this).attr("data-zoom-id"),smallImage:e(this).attr("data-small-image")},t),e(this).data("relOpts",i),e(this).bind("click",e(this),function(t){var n=t.data,o=n.data("relOpts");return e("#"+o.useZoom+" div.wsite-show").add("#"+o.useZoom+" div.wsite-show-init"),e("#"+o.useZoom).data("zoom").destroy(),e("#"+o.useZoom).attr("href",n.attr("href")),e("#"+o.useZoom+" img").attr("src",o.smallImage),e("#"+o.useZoom).CloudZoom(i),!1}))}),this},e.fn.CloudZoom.defaults={zoomWidth:"auto",zoomHeight:"auto",position:"right",tint:!1,tintOpacity:.5,lensOpacity:.5,softFocus:!1,smoothMove:3,showTitle:!0,titleOpacity:.5,adjustX:0,adjustY:0}}(jQuery),_wAMD.define("vendor/cloud-zoom.1.0.2",function(){}),function(){var e=Backbone.sync;_.extend(Backbone,{sync:function(t,n,i){var o,r;if(!n.rpc)return e.apply(Backbone,arguments);switch(o=n.rpc,t){case"delete":t="destroy";case"create":case"update":case"patch":r=i.attrs||n.toJSON(i);break;case"read":if(n.rpc&&"read"==t){r={page:i.page||1,start:i.start||0,limit:i.limit||5e3,filter:i.filter||[],single:i.single||!1},i.sort&&(r.sort=i.sort),i.group&&(r.group=i.group),void 0!==i.add&&(r.add=i.add),void 0!==i.remove&&(r.remove=i.remove),void 0!==i.merge&&(r.merge=i.merge);var s=n.keydefs||n.model.prototype.keydefs;if(s.PRIMARY)for(var a=0;a<s.PRIMARY.length;a++){var l=s.PRIMARY[a];void 0==n.get(l)||_.findWhere(r.filter,{property:l})||r.filter.push({property:l,value:n.get(l)})}}break;default:console.warn(t+" params not defined for this model ",n),r=i.attrs||n.toJSON()}return n.rpc[t]?n.rpc[t](r).then(function(e){return e.success===!1?i.error(e):i.success(e.data)},function(e){return i.error(e)}):(console.warn(t+" not defined for this model ",n),void 0)}}),_.extend(Backbone.Model.prototype,{sync:function(e,t,n){return Backbone.sync(e,t,n)}}),_.extend(Backbone.Collection.prototype,{sync:function(e,t,n){return Backbone.sync(e,t,n)}}),Weebly.setup_rpc=function(e){var t=Weebly.ns(e.namespace),n=new jsonrpc.JsonRpc(e.url);for(var i in e.actions)for(var o=Weebly.ns(i,t),r=e.actions[i]||[],s=0;s<r.length;s++){var a=r[s];o[a.name]=function(e,t){return function(){var i=Array.prototype.slice.call(arguments);if(i.length<t)return console.error("Wrong number of args for "+e),void 0;var o=Weebly.jQuery.Deferred();return i.push({success:o.resolve,failure:o.reject,scope:o}),i.unshift(e),n.call.apply(n,i),o}}(i+"::"+a.name,a.len,a.multiple)}},Weebly.setup_model_rpc=function(e){var t=Weebly.ns(e.rpc_namespace),n=Weebly.ns(e.model_namespace),i=Weebly.ns(e.collection_namespace),o=Weebly.ns(e.bootstrap_namespace);_.extend(n,e.models),_.extend(i,e.collections),_.extend(o,e.bootstrap);for(var r in n)t[r]&&(n[r].rpc=t[r]);for(var r in i)t[r]&&(i[r].rpc=t[r])}}(),_wAMD.define("util/backbone-rpc",["backbone","vendor/jsonrpc"],function(){}),_wAMD.define("util/backbone-validators",["vendor/backbone-validation"],function(){_.extend(Backbone.Validation.validators,{email:function(e,t,n){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(e)?void 0:this.format("{0} is not a valid E-mail address",this.formatLabel(t,n))},maxlength:Backbone.Validation.validators.maxLength,minlength:Backbone.Validation.validators.minLength})}),function(e){e.Event.prototype.stop=function(){this.preventDefault(),this.stopPropagation()},e.fn.extend({getValue:function(){var e=this;return"checkbox"===e.attr("type")||"radio"===e.attr("type")?e.prop("checked"):e.is(":input")?e.val():e.html()},setValue:function(e){var t=this;return"checkbox"===t.attr("type")||"radio"===t.attr("type")?t.prop("checked",!!e):t.is(":input")?t.val(null==e||void 0==e?"":e):t.html("string"==typeof e?e:""),t},getValues:function(t){t=t||"";var n={};return this.find(":input,.input").each(function(){var i=e(this),o=i.attr("name")||i.attr("id");o&&0===o.indexOf(t)&&(o=o.substring(t.length),n[o]=i.getValue())}),n},setValues:function(t,n){return n=n||"",this.find(":input,.input").each(function(){var i=e(this),o=i.attr("name")||i.attr("id");o&&0===o.indexOf(n)&&(o=o.substring(n.length),i.setValue(t[o]))}),this},equals:function(e){return this.data()===e.data()},padInput:function(t){var n,i="auto",o="auto";return t=t||"all",this.each(function(r,s){n=e(s),("ns"===t||"all"===t)&&(i=Math.floor((n.parent().height()-n.height())/2)),("ew"===t||"all"===t)&&(o=Math.floor((n.parent().width()-n.width())/2)),n.css({"padding-top":i,"padding-right":o,"padding-bottom":i,"padding-left":o})}),this}})}(Weebly.jQuery),"undefined"==typeof JSON&&(JSON={stringify:Object.toJSON,parse:function(e){return(e||"").evalJSON()}}),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){var i=Array.prototype.slice.call(arguments);return t.apply(e,n.concat(i))}}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){for(var n=0,i=this.length;i>n;++n)n in this&&e.call(t,this[n],n,this)}),Array.prototype.find||(Array.prototype.find=function(e,t){for(var n=0,i=this.length;i>n;++n){var o=this[n];if(e.call(t,o))return o}return null}),Array.prototype.push||(Array.prototype.push=function(e){this[this.length]=e}),Array.prototype.remove||(Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=0>e?this.length+e:e,this.push.apply(this,n)}),String.prototype.format=function(){var e=arguments;return this.replace(/{(\d+)}/g,function(t,n){return"undefined"!=typeof e[n]?e[n]:t})},_wAMD.define("util/misc",function(){}),function(e){"undefined"==typeof e.fn.spinner&&e.fn.extend({spinner:function(t){function n(){t.incrementElement||t.decrementElement?(d=e(t.incrementElement),u=e(t.decrementElement)):(l=e('<div class="'+t.className+'" />').addClass(t.theme),c=e('<div class="'+t.className+'-controls" />'),d=e('<a class="'+t.className+'-up" />'),u=e('<a class="'+t.className+'-down" />'),c.append(d,u),a.wrap(l).addClass(t.className+"-input").parent().append(c).css({height:t.height||"auto"})),a.on({keypress:function(e){var t=e.keyCode||e.which;return t>47&&58>t||8===t||9===t||37===t||39===t||e.metaKey?!0:!1},keydown:function(t){var n=e(t.currentTarget);38===t.which?o(n):40===t.which&&r(n)},blur:function(e){var t=e.currentTarget;t.getAttribute("data-max")&&parseInt(t.value)>parseInt(t.getAttribute("data-max"))?t.value=t.getAttribute("data-max"):""===t.value&&(t.value=1)},change:function(){s()}}),d.on({click:function(){clearInterval(h),o(a)},mousedown:function(t){e(t.currentTarget).addClass("wsite-active"),h=setInterval(function(){o(a)},250),t.preventDefault()},mouseup:function(e){i(e.currentTarget)},mouseout:function(e){i(e.currentTarget)}}),u.on({click:function(){clearInterval(h),r(a)},mousedown:function(t){e(t.currentTarget).addClass("wsite-active"),h=setInterval(function(){r(a)},250),t.preventDefault()},mouseup:function(e){i(e.currentTarget)},mouseout:function(e){i(e.currentTarget)}})}function i(t){e(t).removeClass("wsite-active"),clearInterval(h)}function o(e){if(!e.is(":disabled")){var n=parseInt(e.val());isNaN(n)&&t.defaultVal&&(n=t.defaultVal);var i=n+t.interval;e.val(Math.min(i,parseInt(e.attr("data-max"))||t.max)).focus(),s()}}function r(e){if(!e.is(":disabled")){var n=parseInt(e.val());isNaN(n)&&t.defaultVal&&(n=t.defaultVal);var i=n-t.interval;e.val(Math.max(i,parseInt(e.data("data-min"))||t.min)).focus(),s()}}function s(){t.onChange&&t.onChange.call(a[0])}var a,l,c,d,u,h,p={className:"wsite-spinner",height:void 0,min:1,max:1/0,theme:"light",interval:1};return t=e.extend(p,t),this.each(function(t,i){a=e(i),"INPUT"===i.nodeName&&n()}),this}})}(Weebly.jQuery),_wAMD.define("util/ui/Spinner",function(){}),function(e){"undefined"==typeof e.fn.each2&&e.fn.extend({each2:function(t){for(var n=e([0]),i=-1,o=this.length;++i<o&&(n.context=n[0]=this[i])&&t.call(n[0],i,n)!==!1;);return this}})}(jQuery),function(e,t){function n(e,t){for(var n=0,i=t.length;i>n;n+=1)if(o(e,t[n]))return n;return-1}function i(){var t=e(R);t.appendTo("body");var n={width:t.width()-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),n}function o(e,n){return e===n?!0:e===t||n===t?!1:null===e||null===n?!1:e.constructor===String?e+""==n+"":n.constructor===String?n+""==e+"":!1}function r(t,n){var i,o,r;if(null===t||t.length<1)return[];for(i=t.split(n),o=0,r=i.length;r>o;o+=1)i[o]=e.trim(i[o]);return i}function s(e){return e.outerWidth(!1)-e.width()}function a(n){var i="keyup-change-value";n.on("keydown",function(){e.data(n,i)===t&&e.data(n,i,n.val())}),n.on("keyup",function(){var o=e.data(n,i);o!==t&&n.val()!==o&&(e.removeData(n,i),n.trigger("keyup-change"))})}function l(n){n.on("mousemove",function(n){var i=O;(i===t||i.x!==n.pageX||i.y!==n.pageY)&&e(n.target).trigger("mousemove-filtered",n)})}function c(e,n,i){i=i||t;var o;return function(){var t=arguments;window.clearTimeout(o),o=window.setTimeout(function(){n.apply(i,t)},e)}}function d(e){var t,n=!1;return function(){return n===!1&&(t=e(),n=!0),t}}function u(e,t){var i=c(e,function(e){t.trigger("scroll-debounced",e)});t.on("scroll",function(e){n(e.target,t.get())>=0&&i(e)})}function h(e){e[0]!==document.activeElement&&window.setTimeout(function(){var t,n=e[0],i=e.val().length;e.focus(),e.is(":visible")&&n===document.activeElement&&(n.setSelectionRange?n.setSelectionRange(i,i):n.createTextRange&&(t=n.createTextRange(),t.collapse(!1),t.select()))},0)}function p(t){t=e(t)[0];var n=0,i=0;if("selectionStart"in t)n=t.selectionStart,i=t.selectionEnd-n;else if("selection"in document){t.focus();var o=document.selection.createRange();i=document.selection.createRange().text.length,o.moveStart("character",-t.value.length),n=o.text.length-i}return{offset:n,length:i}}function f(e){e.preventDefault(),e.stopPropagation()}function m(e){e.preventDefault(),e.stopImmediatePropagation()}function g(t){if(!F){var n=t[0].currentStyle||window.getComputedStyle(t[0],null);F=e(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,letterSpacing:n.letterSpacing,textTransform:n.textTransform,whiteSpace:"nowrap"}),F.attr("class","select2-sizer"),e("body").append(F)}return F.text(t.val()),F.width()}function v(t,n,i){var o,r,s=[];o=t.attr("class"),o&&(o=""+o,e(o.split(" ")).each2(function(){0===this.indexOf("select2-")&&s.push(this)})),o=n.attr("class"),o&&(o=""+o,e(o.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(r=i(this),r&&s.push(this))})),t.attr("class",s.join(" "))}function y(e,t,n,i){var o=e.toUpperCase().indexOf(t.toUpperCase()),r=t.length;return 0>o?(n.push(i(e)),void 0):(n.push(i(e.substring(0,o))),n.push("<span class='select2-match'>"),n.push(i(e.substring(o,o+r))),n.push("</span>"),n.push(i(e.substring(o+r,e.length))),void 0)}function b(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})}function w(n){var i,o=0,r=null,s=n.quietMillis||100,a=n.url,l=this;return function(c){window.clearTimeout(i),i=window.setTimeout(function(){o+=1;var i=o,s=n.data,d=a,u=n.transport||e.fn.select2.ajaxDefaults.transport,h={type:n.type||"GET",cache:n.cache||!1,jsonpCallback:n.jsonpCallback||t,dataType:n.dataType||"json"},p=e.extend({},e.fn.select2.ajaxDefaults.params,h);s=s?s.call(l,c.term,c.page,c.context):null,d="function"==typeof d?d.call(l,c.term,c.page,c.context):d,r&&r.abort(),n.params&&(e.isFunction(n.params)?e.extend(p,n.params.call(l)):e.extend(p,n.params)),e.extend(p,{url:d,dataType:n.dataType,data:s,success:function(e){if(!(o>i)){var t=n.results(e,c.page);c.callback(t)}}}),r=u.call(l,p)},s)}}function _(t){var n,i,o=t,r=function(e){return""+e.text};e.isArray(o)&&(i=o,o={results:i}),e.isFunction(o)===!1&&(i=o,o=function(){return i});var s=o();return s.text&&(r=s.text,e.isFunction(r)||(n=s.text,r=function(e){return e[n]})),function(t){var n,i=t.term,s={results:[]};return""===i?(t.callback(o()),void 0):(n=function(o,s){var a,l;if(o=o[0],o.children){a={};for(l in o)o.hasOwnProperty(l)&&(a[l]=o[l]);a.children=[],e(o.children).each2(function(e,t){n(t,a.children)}),(a.children.length||t.matcher(i,r(a),o))&&s.push(a)}else t.matcher(i,r(o),o)&&s.push(o)},e(o().results).each2(function(e,t){n(t,s.results)}),t.callback(s),void 0)}}function C(n){var i=e.isFunction(n);return function(o){var r=o.term,s={results:[]};e(i?n():n).each(function(){var e=this.text!==t,n=e?this.text:this;(""===r||o.matcher(r,n))&&s.results.push(e?this:{id:this,text:this})}),o.callback(s)}}function x(t,n){if(e.isFunction(t))return!0;if(!t)return!1;throw new Error(n+" must be a function or a falsy value")}function S(t){return e.isFunction(t)?t():t}function E(t){var n=0;return e.each(t,function(e,t){t.children?n+=E(t.children):n++}),n}function k(e,n,i,r){var s,a,l,c,d,u=e,h=!1;if(!r.createSearchChoice||!r.tokenSeparators||r.tokenSeparators.length<1)return t;for(;;){for(a=-1,l=0,c=r.tokenSeparators.length;c>l&&(d=r.tokenSeparators[l],a=e.indexOf(d),!(a>=0));l++);if(0>a)break;if(s=e.substring(0,a),e=e.substring(a+d.length),s.length>0&&(s=r.createSearchChoice.call(this,s,n),s!==t&&null!==s&&r.id(s)!==t&&null!==r.id(s))){for(h=!1,l=0,c=n.length;c>l;l++)if(o(r.id(s),r.id(n[l]))){h=!0;break}h||i(s)}}return u!==e?e:void 0}function T(t,n){var i=function(){};return i.prototype=new t,i.prototype.constructor=i,i.prototype.parent=t.prototype,i.prototype=e.extend(i.prototype,n),i}if(window.Select2===t){var P,A,D,M,I,F,W,N,O={x:0,y:0},P={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(e){switch(e=e.which?e.which:e){case P.LEFT:case P.RIGHT:case P.UP:case P.DOWN:return!0}return!1},isControl:function(e){var t=e.which;switch(t){case P.SHIFT:case P.CTRL:case P.ALT:return!0}return e.metaKey?!0:!1},isFunctionKey:function(e){return e=e.which?e.which:e,e>=112&&123>=e}},R="<div class='select2-measure-scrollbar'></div>";W=e(document),I=function(){var e=1;return function(){return e++}}(),W.on("mousemove",function(e){O.x=e.pageX,O.y=e.pageY}),A=T(Object,{bind:function(e){var t=this;return function(){e.apply(t,arguments)}},init:function(n){var o,r,s,c,h=".select2-results";this.opts=n=this.prepareOpts(n),this.id=n.id,n.element.data("select2")!==t&&null!==n.element.data("select2")&&n.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(n.element.attr("id")||"autogen"+I()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=d(function(){return n.element.closest("body")}),v(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.css(S(n.containerCss)),this.container.addClass(S(n.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(S(n.dropdownCssClass)),this.dropdown.data("select2",this),this.results=o=this.container.find(h),this.search=r=this.container.find("input.select2-input"),this.resultsPage=0,this.context=null,this.initContainer(),l(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",h,this.bind(this.highlightUnderEvent)),u(80,this.results),this.dropdown.on("scroll-debounced",h,this.bind(this.loadMoreIfNeeded)),e(this.container).on("change",".select2-input",function(e){e.stopPropagation()}),e(this.dropdown).on("change",".select2-input",function(e){e.stopPropagation()}),e.fn.mousewheel&&o.mousewheel(function(e,t,n,i){var r=o.scrollTop();i>0&&0>=r-i?(o.scrollTop(0),f(e)):0>i&&o.get(0).scrollHeight-o.scrollTop()+i<=o.height()&&(o.scrollTop(o.get(0).scrollHeight-o.height()),f(e))}),a(r),r.on("keyup-change input paste",this.bind(this.updateResults)),r.on("focus",function(){r.addClass("select2-focused")}),r.on("blur",function(){r.removeClass("select2-focused")}),this.dropdown.on("mouseup",h,this.bind(function(t){e(t.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(t),this.selectHighlighted(t))})),this.dropdown.on("click mouseup mousedown",function(e){e.stopPropagation()}),e.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==n.maximumInputLength&&this.search.attr("maxlength",n.maximumInputLength);var s=n.element.prop("disabled");s===t&&(s=!1),this.enable(!s);var c=n.element.prop("readonly");c===t&&(c=!1),this.readonly(c),N=N||i(),this.autofocus=n.element.prop("autofocus"),n.element.prop("autofocus",!1),this.autofocus&&this.focus()},destroy:function(){var e=this.opts.element,n=e.data("select2");this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),n!==t&&(n.container.remove(),n.dropdown.remove(),e.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?e.attr({tabindex:this.elementTabIndex}):e.removeAttr("tabindex"),e.show())},optionToData:function(e){return e.is("option")?{id:e.prop("value"),text:e.text(),element:e.get(),css:e.attr("class"),disabled:e.prop("disabled"),locked:o(e.attr("locked"),"locked")||o(e.data("locked"),!0)}:e.is("optgroup")?{text:e.attr("label"),children:[],element:e.get(),css:e.attr("class")}:void 0},prepareOpts:function(n){var i,s,a,l,c=this;if(i=n.element,"select"===i.get(0).tagName.toLowerCase()&&(this.select=s=n.element),s&&e.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in n)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),n=e.extend({},{populateResults:function(i,o,r){var s,a=this.opts.id;s=function(i,o,l){var d,u,h,p,f,m,g,v,y,b;for(i=n.sortResults(i,o,r),d=0,u=i.length;u>d;d+=1)h=i[d],f=h.disabled===!0,p=!f&&a(h)!==t,m=h.children&&h.children.length>0,g=e("<li></li>"),g.addClass("select2-results-dept-"+l),g.addClass("select2-result"),g.addClass(p?"select2-result-selectable":"select2-result-unselectable"),f&&g.addClass("select2-disabled"),m&&g.addClass("select2-result-with-children"),g.addClass(c.opts.formatResultCssClass(h)),v=e(document.createElement("div")),v.addClass("select2-result-label"),b=n.formatResult(h,v,r,c.opts.escapeMarkup),b!==t&&v.html(b),g.append(v),m&&(y=e("<ul></ul>"),y.addClass("select2-result-sub"),s(h.children,y,l+1),g.append(y)),g.data("select2-data",h),o.append(g)},s(o,i,0)}},e.fn.select2.defaults,n),"function"!=typeof n.id&&(a=n.id,n.id=function(e){return e[a]}),e.isArray(n.element.data("select2Tags"))){if("tags"in n)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+n.element.attr("id");n.tags=n.element.data("select2Tags")}if(s?(n.query=this.bind(function(e){var n,o,r,s={results:[],more:!1},a=e.term;r=function(t,n){var i;t.is("option")?e.matcher(a,t.text(),t)&&n.push(c.optionToData(t)):t.is("optgroup")&&(i=c.optionToData(t),t.children().each2(function(e,t){r(t,i.children)}),i.children.length>0&&n.push(i))},n=i.children(),this.getPlaceholder()!==t&&n.length>0&&(o=this.getPlaceholderOption(),o&&(n=n.not(o))),n.each2(function(e,t){r(t,s.results)}),e.callback(s)}),n.id=function(e){return e.id},n.formatResultCssClass=function(e){return e.css}):"query"in n||("ajax"in n?(l=n.element.data("ajax-url"),l&&l.length>0&&(n.ajax.url=l),n.query=w.call(n.element,n.ajax)):"data"in n?n.query=_(n.data):"tags"in n&&(n.query=C(n.tags),n.createSearchChoice===t&&(n.createSearchChoice=function(e){return{id:e,text:e}}),n.initSelection===t&&(n.initSelection=function(t,i){var s=[];e(r(t.val(),n.separator)).each(function(){var t=this,i=this,r=n.tags;e.isFunction(r)&&(r=r()),e(r).each(function(){return o(this.id,t)?(i=this.text,!1):void 0}),s.push({id:t,text:i})}),i(s)}))),"function"!=typeof n.query)throw"query function not defined for Select2 "+n.element.attr("id");return n},monitorSource:function(){var e,n=this.opts.element;n.on("change.select2",this.bind(function(){this.opts.element.data("select2-change-triggered")!==!0&&this.initSelection()})),e=this.bind(function(){var e,i=n.prop("disabled");i===t&&(i=!1),this.enable(!i);var e=n.prop("readonly");e===t&&(e=!1),this.readonly(e),v(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(S(this.opts.containerCssClass)),v(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(S(this.opts.dropdownCssClass))}),n.on("propertychange.select2 DOMAttrModified.select2",e),this.mutationCallback===t&&(this.mutationCallback=function(t){t.forEach(e)}),"undefined"!=typeof WebKitMutationObserver&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new WebKitMutationObserver(this.mutationCallback),this.propertyObserver.observe(n.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(t){var n=e.Event("select2-selecting",{val:this.id(t),object:t});return this.opts.element.trigger(n),!n.isDefaultPrevented()},triggerChange:function(t){t=t||{},t=e.extend({},t,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(t),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return this.enabledInterface===!0},enableInterface:function(){var e=this._enabled&&!this._readonly,t=!e;return e===this.enabledInterface?!1:(this.container.toggleClass("select2-container-disabled",t),this.close(),this.enabledInterface=e,!0)},enable:function(e){return e===t&&(e=!0),this._enabled===e?!1:(this._enabled=e,this.opts.element.prop("disabled",!e),this.enableInterface(),!0)},readonly:function(e){return e===t&&(e=!1),this._readonly===e?!1:(this._readonly=e,this.opts.element.prop("readonly",e),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var t,n,i,o,r=this.dropdown,s=this.container.offset(),a=this.container.outerHeight(!1),l=this.container.outerWidth(!1),c=r.outerHeight(!1),d=e(window).scrollLeft()+e(window).width(),u=e(window).scrollTop()+e(window).height(),h=s.top+a,p=s.left,f=u>=h+c,m=s.top-c>=this.body().scrollTop(),g=r.outerWidth(!1),v=d>=p+g,y=r.hasClass("select2-drop-above");this.opts.dropdownAutoWidth?(o=e(".select2-results",r)[0],r.addClass("select2-drop-auto-width"),r.css("width",""),g=r.outerWidth(!1)+(o.scrollHeight===o.clientHeight?0:N.width),g>l?l=g:g=l,v=d>=p+g):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(t=this.body().offset(),h-=t.top,p-=t.left),y?(n=!0,!m&&f&&(n=!1)):(n=!1,!f&&m&&(n=!0)),v||(p=s.left+l-g),n?(h=s.top-c,this.container.addClass("select2-drop-above"),r.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),r.removeClass("select2-drop-above")),i=e.extend({top:h,left:p,width:l},S(this.opts.dropdownCss)),r.css(i)},shouldOpen:function(){var t;return this.opened()?!1:this._enabled===!1||this._readonly===!0?!1:(t=e.Event("select2-opening"),this.opts.element.trigger(t),!t.isDefaultPrevented())},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return this.shouldOpen()?(this.opening(),!0):!1},opening:function(){function t(){return{width:Math.max(document.documentElement.scrollWidth,e(window).width()),height:Math.max(document.documentElement.scrollHeight,e(window).height())}}var n,i,o=this.containerId,r="scroll."+o,s="resize."+o,a="orientationchange."+o;this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]&&this.dropdown.detach().appendTo(this.body()),n=e("#select2-drop-mask"),0==n.length&&(n=e(document.createElement("div")),n.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),n.hide(),n.appendTo(this.body()),n.on("mousedown touchstart click",function(t){var n,i=e("#select2-drop");i.length>0&&(n=i.data("select2"),n.opts.selectOnBlur&&n.selectHighlighted({noFocus:!0}),n.close(),t.preventDefault(),t.stopPropagation())})),this.dropdown.prev()[0]!==n[0]&&this.dropdown.before(n),e("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),i=t(),n.css(i).show(),this.dropdown.show(),this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var l=this;this.container.parents().add(window).each(function(){e(this).on(s+" "+r+" "+a,function(){var n=t();e("#select2-drop-mask").css(n),l.positionDropdown()})})},close:function(){if(this.opened()){var t=this.containerId,n="scroll."+t,i="resize."+t,o="orientationchange."+t;this.container.parents().add(window).each(function(){e(this).off(n).off(i).off(o)}),this.clearDropdownAlignmentPreference(),e("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger(e.Event("select2-close"))}},externalSearch:function(e){this.open(),this.search.val(e),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return S(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var t,n,i,o,r,s,a,l=this.results;if(n=this.highlight(),!(0>n)){if(0==n)return l.scrollTop(0),void 0;t=this.findHighlightableChoices().find(".select2-result-label"),i=e(t[n]),o=i.offset().top+i.outerHeight(!0),n===t.length-1&&(a=l.find("li.select2-more-results"),a.length>0&&(o=a.offset().top+a.outerHeight(!0))),r=l.offset().top+l.outerHeight(!0),o>r&&l.scrollTop(l.scrollTop()+(o-r)),s=i.offset().top-l.offset().top,0>s&&"none"!=i.css("display")&&l.scrollTop(l.scrollTop()+s)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(t){for(var n=this.findHighlightableChoices(),i=this.highlight();i>-1&&i<n.length;){i+=t;var o=e(n[i]);if(o.hasClass("select2-result-selectable")&&!o.hasClass("select2-disabled")&&!o.hasClass("select2-selected")){this.highlight(i);break}}},highlight:function(t){var i,o,r=this.findHighlightableChoices();return 0===arguments.length?n(r.filter(".select2-highlighted")[0],r.get()):(t>=r.length&&(t=r.length-1),0>t&&(t=0),this.results.find(".select2-highlighted").removeClass("select2-highlighted"),i=e(r[t]),i.addClass("select2-highlighted"),this.ensureHighlightVisible(),o=i.data("select2-data"),o&&this.opts.element.trigger({type:"select2-highlight",val:this.id(o),choice:o}),void 0)},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(t){var n=e(t.target).closest(".select2-result-selectable");if(n.length>0&&!n.is(".select2-highlighted")){var i=this.findHighlightableChoices();this.highlight(i.index(n))}else 0==n.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var e,t=this.results,n=t.find("li.select2-more-results"),i=this.resultsPage+1,o=this,r=this.search.val(),s=this.context;0!==n.length&&(e=n.offset().top-t.offset().top-t.height(),e<=this.opts.loadMorePadding&&(n.addClass("select2-active"),this.opts.query({element:this.opts.element,term:r,page:i,context:s,matcher:this.opts.matcher,callback:this.bind(function(e){o.opened()&&(o.opts.populateResults.call(this,t,e.results,{term:r,page:i,context:s}),o.postprocessResults(e,!1,!1),e.more===!0?(n.detach().appendTo(t).text(o.opts.formatLoadMore(i+1)),window.setTimeout(function(){o.loadMoreIfNeeded()},10)):n.remove(),o.positionDropdown(),o.resultsPage=i,o.context=e.context)})})))},tokenize:function(){},updateResults:function(n){function i(){l.removeClass("select2-active"),u.positionDropdown()}function r(e){c.html(e),i()}var s,a,l=this.search,c=this.results,d=this.opts,u=this,h=l.val(),p=e.data(this.container,"select2-last-term");if((n===!0||!p||!o(h,p))&&(e.data(this.container,"select2-last-term",h),n===!0||this.showSearchInput!==!1&&this.opened())){var f=this.getMaximumSelectionSize();if(f>=1&&(s=this.data(),e.isArray(s)&&s.length>=f&&x(d.formatSelectionTooBig,"formatSelectionTooBig")))return r("<li class='select2-selection-limit'>"+d.formatSelectionTooBig(f)+"</li>"),void 0;if(l.val().length<d.minimumInputLength)return x(d.formatInputTooShort,"formatInputTooShort")?r("<li class='select2-no-results'>"+d.formatInputTooShort(l.val(),d.minimumInputLength)+"</li>"):r(""),n&&this.showSearch&&this.showSearch(!0),void 0;if(d.maximumInputLength&&l.val().length>d.maximumInputLength)return x(d.formatInputTooLong,"formatInputTooLong")?r("<li class='select2-no-results'>"+d.formatInputTooLong(l.val(),d.maximumInputLength)+"</li>"):r(""),void 0;d.formatSearching&&0===this.findHighlightableChoices().length&&r("<li class='select2-searching'>"+d.formatSearching()+"</li>"),l.addClass("select2-active"),a=this.tokenize(),a!=t&&null!=a&&l.val(a),this.resultsPage=1,d.query({element:d.element,term:l.val(),page:this.resultsPage,context:null,matcher:d.matcher,callback:this.bind(function(s){var a;return this.opened()?(this.context=s.context===t?null:s.context,this.opts.createSearchChoice&&""!==l.val()&&(a=this.opts.createSearchChoice.call(u,l.val(),s.results),a!==t&&null!==a&&u.id(a)!==t&&null!==u.id(a)&&0===e(s.results).filter(function(){return o(u.id(this),u.id(a))}).length&&s.results.unshift(a)),0===s.results.length&&x(d.formatNoMatches,"formatNoMatches")?(r("<li class='select2-no-results'>"+d.formatNoMatches(l.val())+"</li>"),void 0):(c.empty(),u.opts.populateResults.call(this,c,s.results,{term:l.val(),page:this.resultsPage,context:null}),s.more===!0&&x(d.formatLoadMore,"formatLoadMore")&&(c.append("<li class='select2-more-results'>"+u.opts.escapeMarkup(d.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){u.loadMoreIfNeeded()},10)),this.postprocessResults(s,n),i(),this.opts.element.trigger({type:"select2-loaded",items:s}),void 0)):(this.search.removeClass("select2-active"),void 0)})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")
},focusSearch:function(){h(this.search)},selectHighlighted:function(e){var t=this.highlight(),n=this.results.find(".select2-highlighted"),i=n.closest(".select2-result").data("select2-data");i?(this.highlight(t),this.onSelect(i,e)):e&&e.noFocus&&this.close()},getPlaceholder:function(){var e;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((e=this.getPlaceholderOption())!==t?e.text():t)},getPlaceholderOption:function(){if(this.select){var e=this.select.children().first();if(this.opts.placeholderOption!==t)return"first"===this.opts.placeholderOption&&e||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===e.text()&&""===e.val())return e}},initContainerWidth:function(){function n(){var n,i,o,r,s;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if(n=this.opts.element.attr("style"),n!==t)for(i=n.split(";"),r=0,s=i.length;s>r;r+=1)if(o=i[r].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i),null!==o&&o.length>=1)return o[1];return"resolve"===this.opts.width?(n=this.opts.element.css("width"),n.indexOf("%")>0?n:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return e.isFunction(this.opts.width)?this.opts.width():this.opts.width}var i=n.call(this);null!==i&&this.container.css("width",i)}}),D=T(A,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var t,n,i;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),this.showSearchInput!==!1&&this.search.val(this.focusser.val()),this.search.focus(),t=this.search.get(0),t.createTextRange?(n=t.createTextRange(),n.collapse(!1),n.select()):t.setSelectionRange&&(i=this.search.val().length,t.setSelectionRange(i,i)),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},initContainer:function(){var t,n=this.container,i=this.dropdown;this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=t=n.find(".select2-choice"),this.focusser=n.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+I()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){if(e.which===P.PAGE_UP||e.which===P.PAGE_DOWN)return f(e),void 0;switch(e.which){case P.UP:case P.DOWN:return this.moveHighlight(e.which===P.UP?-1:1),f(e),void 0;case P.ENTER:return this.selectHighlighted(),f(e),void 0;case P.TAB:return this.selectHighlighted({noFocus:!0}),void 0;case P.ESC:return this.cancel(e),f(e),void 0}}})),this.search.on("blur",this.bind(function(){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()&&e.which!==P.TAB&&!P.isControl(e)&&!P.isFunctionKey(e)&&e.which!==P.ESC){if(this.opts.openOnEnter===!1&&e.which===P.ENTER)return f(e),void 0;if(e.which==P.DOWN||e.which==P.UP||e.which==P.ENTER&&this.opts.openOnEnter){if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return;return this.open(),f(e),void 0}return e.which==P.DELETE||e.which==P.BACKSPACE?(this.opts.allowClear&&this.clear(),f(e),void 0):void 0}})),a(this.focusser),this.focusser.on("keyup-change input",this.bind(function(e){if(this.opts.minimumResultsForSearch>=0){if(e.stopPropagation(),this.opened())return;this.open()}})),t.on("mousedown","abbr",this.bind(function(e){this.isInterfaceEnabled()&&(this.clear(),m(e),this.close(),this.selection.focus())})),t.on("mousedown",this.bind(function(t){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),f(t)})),i.on("mousedown",this.bind(function(){this.search.focus()})),t.on("focus",this.bind(function(e){f(e)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger(e.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(e){var t=this.selection.data("select2-data");if(t){var n=this.getPlaceholderOption();this.opts.element.val(n?n.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),e!==!1&&(this.opts.element.trigger({type:"select2-removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection([]),this.close(),this.setPlaceholder();else{var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var e;return(e=this.getPlaceholderOption())!==t&&e.is(":selected")||""===this.opts.element.val()||this.opts.element.val()===t||null===this.opts.element.val()},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=e.find(":selected");t(n.optionToData(i))}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var r=n.val(),s=null;t.query({matcher:function(e,n,i){var a=o(r,t.id(i));return a&&(s=i),a},callback:e.isFunction(i)?function(){i(s)}:e.noop})}),t},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===t?t:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var e=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&e!==t){if(this.select&&this.getPlaceholderOption()===t)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(e)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(e,t,n){var i=0,r=this;if(this.findHighlightableChoices().each2(function(e,t){return o(r.id(t.data("select2-data")),r.opts.element.val())?(i=e,!1):void 0}),n!==!1&&(t===!0&&i>=0?this.highlight(i):this.highlight(0)),t===!0){var s=this.opts.minimumResultsForSearch;s>=0&&this.showSearch(E(e.results)>=s)}},showSearch:function(t){this.showSearchInput!==t&&(this.showSearchInput=t,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!t),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!t),e(this.dropdown,this.container).toggleClass("select2-with-searchbox",t))},onSelect:function(e,t){if(this.triggerSelect(e)){var n=this.opts.element.val(),i=this.data();this.opts.element.val(this.id(e)),this.updateSelection(e),this.opts.element.trigger({type:"select2-selected",val:this.id(e),choice:e}),this.close(),t&&t.noFocus||this.selection.focus(),o(n,this.id(e))||this.triggerChange({added:e,removed:i})}},updateSelection:function(e){var n,i,o=this.selection.find(".select2-chosen");this.selection.data("select2-data",e),o.empty(),n=this.opts.formatSelection(e,o,this.opts.escapeMarkup),n!==t&&o.append(n),i=this.opts.formatSelectionCssClass(e,o),i!==t&&o.addClass(i),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==t&&this.container.addClass("select2-allowclear")},val:function(){var e,n=!1,i=null,o=this,r=this.data();if(0===arguments.length)return this.opts.element.val();if(e=arguments[0],arguments.length>1&&(n=arguments[1]),this.select)this.select.val(e).find(":selected").each2(function(e,t){return i=o.optionToData(t),!1}),this.updateSelection(i),this.setPlaceholder(),n&&this.triggerChange({added:i,removed:r});else{if(!e&&0!==e)return this.clear(n),void 0;if(this.opts.initSelection===t)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(e),this.opts.initSelection(this.opts.element,function(e){o.opts.element.val(e?o.id(e):""),o.updateSelection(e),o.setPlaceholder(),n&&o.triggerChange({added:e,removed:r})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(e,n){var i;return 0===arguments.length?(i=this.selection.data("select2-data"),i==t&&(i=null),i):(e&&""!==e?(i=this.data(),this.opts.element.val(e?this.id(e):""),this.updateSelection(e),n&&this.triggerChange({added:e,removed:i})):this.clear(n),void 0)}}),M=T(A,{createContainer:function(){var t=e(document.createElement("div")).attr({"class":"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""));return t},prepareOpts:function(){var t=this.parent.prepareOpts.apply(this,arguments),n=this;return"select"===t.element.get(0).tagName.toLowerCase()?t.initSelection=function(e,t){var i=[];e.find(":selected").each2(function(e,t){i.push(n.optionToData(t))}),t(i)}:"data"in t&&(t.initSelection=t.initSelection||function(n,i){var s=r(n.val(),t.separator),a=[];t.query({matcher:function(n,i,r){var l=e.grep(s,function(e){return o(e,t.id(r))}).length;return l&&a.push(r),l},callback:e.isFunction(i)?function(){for(var e=[],n=0;n<s.length;n++)for(var r=s[n],l=0;l<a.length;l++){var c=a[l];if(o(r,t.id(c))){e.push(c),a.splice(l,1);break}}i(e)}:e.noop})}),t},selectChoice:function(e){var t=this.container.find(".select2-search-choice-focus");t.length&&e&&e[0]==t[0]||(t.length&&this.opts.element.trigger("choice-deselected",t),t.removeClass("select2-search-choice-focus"),e&&e.length&&(this.close(),e.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",e)))},initContainer:function(){var t,n=".select2-choices";this.searchContainer=this.container.find(".select2-search-field"),this.selection=t=this.container.find(n);var i=this;this.selection.on("mousedown",".select2-search-choice",function(){i.search[0].focus(),i.selectChoice(e(this))}),this.search.attr("id","s2id_autogen"+I()),e("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var n=t.find(".select2-search-choice-focus"),i=n.prev(".select2-search-choice:not(.select2-locked)"),o=n.next(".select2-search-choice:not(.select2-locked)"),r=p(this.search);if(n.length&&(e.which==P.LEFT||e.which==P.RIGHT||e.which==P.BACKSPACE||e.which==P.DELETE||e.which==P.ENTER)){var s=n;return e.which==P.LEFT&&i.length?s=i:e.which==P.RIGHT?s=o.length?o:null:e.which===P.BACKSPACE?(this.unselect(n.first()),this.search.width(10),s=i.length?i:o):e.which==P.DELETE?(this.unselect(n.first()),this.search.width(10),s=o.length?o:null):e.which==P.ENTER&&(s=null),this.selectChoice(s),f(e),s&&s.length||this.open(),void 0}if((e.which===P.BACKSPACE&&1==this.keydowns||e.which==P.LEFT)&&0==r.offset&&!r.length)return this.selectChoice(t.find(".select2-search-choice:not(.select2-locked)").last()),f(e),void 0;if(this.selectChoice(null),this.opened())switch(e.which){case P.UP:case P.DOWN:return this.moveHighlight(e.which===P.UP?-1:1),f(e),void 0;case P.ENTER:return this.selectHighlighted(),f(e),void 0;case P.TAB:return this.selectHighlighted({noFocus:!0}),this.close(),void 0;case P.ESC:return this.cancel(e),f(e),void 0}if(e.which!==P.TAB&&!P.isControl(e)&&!P.isFunctionKey(e)&&e.which!==P.BACKSPACE&&e.which!==P.ESC){if(e.which===P.ENTER){if(this.opts.openOnEnter===!1)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),(e.which===P.PAGE_UP||e.which===P.PAGE_DOWN)&&f(e),e.which===P.ENTER&&f(e)}}})),this.search.on("keyup",this.bind(function(){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(t){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),t.stopImmediatePropagation(),this.opts.element.trigger(e.Event("select2-blur"))})),this.container.on("click",n,this.bind(function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.open(),this.focusSearch(),t.preventDefault()))})),this.container.on("focus",n,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger(e.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var e=this;this.opts.initSelection.call(null,this.opts.element,function(n){n!==t&&null!==n&&(e.updateSelection(n),e.close(),e.clearSearch())})}},clearSearch:function(){var e=this.getPlaceholder(),n=this.getMaxSearchWidth();e!==t&&0===this.getVal().length&&this.search.hasClass("select2-focused")===!1?(this.search.val(e).addClass("select2-default"),this.search.width(n>0?n:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger(e.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(t){var i=[],o=[],r=this;e(t).each(function(){n(r.id(this),i)<0&&(i.push(r.id(this)),o.push(this))}),t=o,this.selection.find(".select2-search-choice").remove(),e(t).each(function(){r.addSelectedChoice(this)}),r.postprocessResults()},tokenize:function(){var e=this.search.val();e=this.opts.tokenizer.call(this,e,this.data(),this.bind(this.onSelect),this.opts),null!=e&&e!=t&&(this.search.val(e),e.length>0&&this.open())},onSelect:function(e,t){this.triggerSelect(e)&&(this.addSelectedChoice(e),this.opts.element.trigger({type:"selected",val:this.id(e),choice:e}),(this.select||!this.opts.closeOnSelect)&&this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10)):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:e}),t&&t.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(n){var i,o,r=!n.locked,s=e("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),a=e("<li class='select2-search-choice select2-locked'><div></div></li>"),l=r?s:a,c=this.id(n),d=this.getVal();i=this.opts.formatSelection(n,l.find("div"),this.opts.escapeMarkup),i!=t&&l.find("div").replaceWith("<div>"+i+"</div>"),o=this.opts.formatSelectionCssClass(n,l.find("div")),o!=t&&l.addClass(o),r&&l.find(".select2-search-choice-close").on("mousedown",f).on("click dblclick",this.bind(function(t){this.isInterfaceEnabled()&&(e(t.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect(e(t.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),f(t))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),l.data("select2-data",n),l.insertBefore(this.searchContainer),d.push(c),this.setVal(d)},unselect:function(e){var t,i,o=this.getVal();if(e=e.closest(".select2-search-choice"),0===e.length)throw"Invalid argument: "+e+". Must be .select2-search-choice";t=e.data("select2-data"),t&&(i=n(this.id(t),o),i>=0&&(o.splice(i,1),this.setVal(o),this.select&&this.postprocessResults()),e.remove(),this.opts.element.trigger({type:"removed",val:this.id(t),choice:t}),this.triggerChange({removed:t}))},postprocessResults:function(e,t,i){var o=this.getVal(),r=this.results.find(".select2-result"),s=this.results.find(".select2-result-with-children"),a=this;r.each2(function(e,t){var i=a.id(t.data("select2-data"));n(i,o)>=0&&(t.addClass("select2-selected"),t.find(".select2-result-selectable").addClass("select2-selected"))}),s.each2(function(e,t){t.is(".select2-result-selectable")||0!==t.find(".select2-result-selectable:not(.select2-selected)").length||t.addClass("select2-selected")}),-1==this.highlight()&&i!==!1&&a.highlight(0),!this.opts.createSearchChoice&&!r.filter(".select2-result:not(.select2-selected)").length>0&&(!e||e&&!e.more&&0===this.results.find(".select2-no-results").length)&&x(a.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+a.opts.formatNoMatches(a.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-s(this.search)},resizeSearch:function(){var e,t,n,i,o,r=s(this.search);e=g(this.search)+10,t=this.search.offset().left,n=this.selection.width(),i=this.selection.offset().left,o=n-(t-i)-r,e>o&&(o=n-r),40>o&&(o=n-r),0>=o&&(o=e),this.search.width(o)},getVal:function(){var e;return this.select?(e=this.select.val(),null===e?[]:e):(e=this.opts.element.val(),r(e,this.opts.separator))},setVal:function(t){var i;this.select?this.select.val(t):(i=[],e(t).each(function(){n(this,i)<0&&i.push(this)}),this.opts.element.val(0===i.length?"":i.join(this.opts.separator)))},buildChangeDetails:function(e,t){for(var t=t.slice(0),e=e.slice(0),n=0;n<t.length;n++)for(var i=0;i<e.length;i++)o(this.opts.id(t[n]),this.opts.id(e[i]))&&(t.splice(n,1),n--,e.splice(i,1),i--);return{added:t,removed:e}},val:function(n,i){var o,r=this;if(0===arguments.length)return this.getVal();if(o=this.data(),o.length||(o=[]),!n&&0!==n)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),i&&this.triggerChange({added:this.data(),removed:o}),void 0;if(this.setVal(n),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),i&&this.triggerChange(this.buildChangeDetails(o,this.data()));else{if(this.opts.initSelection===t)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(t){var n=e.map(t,r.id);r.setVal(n),r.updateSelection(t),r.clearSearch(),i&&r.triggerChange(this.buildChangeDetails(o,this.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var t=[],n=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){t.push(n.opts.id(e(this).data("select2-data")))}),this.setVal(t),this.triggerChange()},data:function(t,n){var i,o,r=this;return 0===arguments.length?this.selection.find(".select2-search-choice").map(function(){return e(this).data("select2-data")}).get():(o=this.data(),t||(t=[]),i=e.map(t,function(e){return r.opts.id(e)}),this.setVal(i),this.updateSelection(t),this.clearSearch(),n&&this.triggerChange(this.buildChangeDetails(o,this.data())),void 0)}}),e.fn.select2=function(){var i,o,r,s,a,l=Array.prototype.slice.call(arguments,0),c=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","readonly","positionDropdown","data","search"],d=["val","opened","isFocused","container","data"],u={search:"externalSearch"};return this.each(function(){if(0===l.length||"object"==typeof l[0])i=0===l.length?{}:e.extend({},l[0]),i.element=e(this),"select"===i.element.get(0).tagName.toLowerCase()?a=i.element.prop("multiple"):(a=i.multiple||!1,"tags"in i&&(i.multiple=a=!0)),o=a?new M:new D,o.init(i);else{if("string"!=typeof l[0])throw"Invalid arguments to select2 plugin: "+l;if(n(l[0],c)<0)throw"Unknown method: "+l[0];if(s=t,o=e(this).data("select2"),o===t)return;if(r=l[0],"container"===r?s=o.container:"dropdown"===r?s=o.dropdown:(u[r]&&(r=u[r]),s=o[r].apply(o,l.slice(1))),n(l[0],d)>=0)return!1}}),s===t?this:s},e.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(e,t,n,i){var o=[];return y(e.text,n.term,o,i),o.join("")},formatSelection:function(e,n,i){return e?i(e.text):t},sortResults:function(e){return e},formatResultCssClass:function(){return t},formatSelectionCssClass:function(){return t},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(e,t){var n=t-e.length;return"Please enter "+n+" more character"+(1==n?"":"s")},formatInputTooLong:function(e,t){var n=e.length-t;return"Please delete "+n+" character"+(1==n?"":"s")},formatSelectionTooBig:function(e){return"You can only select "+e+" item"+(1==e?"":"s")},formatLoadMore:function(){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(e){return e.id},matcher:function(e,t){return(""+t).toUpperCase().indexOf((""+e).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:k,escapeMarkup:b,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(e){return e},adaptDropdownCssClass:function(){return null}},e.fn.select2.ajaxDefaults={transport:e.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:w,local:_,tags:C},util:{debounce:c,markMatch:y,escapeMarkup:b},"class":{"abstract":A,single:D,multi:M}}}}(jQuery),_wAMD.define("util/ui/Select2",function(){}),Weebly.Commerce=Weebly.Commerce||{},Weebly.Commerce.Site=Weebly.Commerce.Site||{},window.initCommerceModels&&initCommerceModels(),_wAMD.define("site/commerce-init",["util/backbone-rpc"],function(){}),_wAMD.define("site/commerce-core",["jquery","underscore","backbone","vendor/jsonrpc","vendor/backbone-relational","vendor/backbone-validation","vendor/jquery.pasteImageReader","vendor/cloud-zoom.1.0.2","util/backbone-rpc","util/backbone-validators","util/misc","util/ui/Spinner","util/ui/Select2","site/commerce-init"],function(){});